!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoLayout=e():t.AutoLayout=e()}(self,()=>(()=>{"use strict";var t,e,o={d:(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};o.r(n),o.d(n,{Main:()=>ot});class i{}i.framework="Framework",i.intelligentLayout="IntelligentLayout",i.observerHandler="ObserverHandler",i.resizeObserver="ResizeObserver",i.modifyObserver="ModifyObserver",i.pageContentObserver="PageContentObserver",i.throttle="Throttle",i.popupDecisionTree="PopupDecisionTree",i.popupRecog="PopupRecog",i.popupDetector="PopupDetector",i.popupRelayout="PopupRelayout",i.popupStateManager="PopupStateManager",i.layoutConstraintDetector="LayoutConstraintDetector",i.layoutUtils="LayoutUtils",i.util="Utils",i.ccmConfig="CCMConfig",i.styleSetter="StyleSetter",i.styleGetter="StyleGetter",i.styleCleaner="StyleCleaner",i.cssSheetManage="CSSSheetManage",i.domReader="DomReader",i.originStyleCache="OriginStyleCache",i.store="Store",i.record="Record",i.diffRecorder="DiffRecorder",i.zoomFont="ZoomFont",i.performance="Performance",i.visual="Visual",i.state="State",i.cache="Cache",i.debug="Debug",i.component="Component",i.node="Node",function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR"}(t||(t={}));class s{static formatTimestamp(){const t=new Date;return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}.${String(t.getMilliseconds()).padStart(3,"0")}`}static setLevel(t){s.currentLevel=t}static getLevel(){return s.currentLevel}static d(t,e){0}static debug(t,e,o){0}static i(t,e,o){0}static info(t,e){0}static w(e,o){if(s.currentLevel<=t.WARN){const t=s.formatTimestamp(),n=o?`[${o}]`:"[WARN]";console.warn(`[${t}] ${n} ${e}`)}}static warn(e,o,n){if(s.currentLevel<=t.WARN){const t=s.formatTimestamp(),i=n?`[${n}]`:"[WARN]",a=e?`${e.tagName}.${e.className||"no-class"}`:"null";console.warn(`[${t}] ${i} [${a}] ${o}`)}}static e(e,o,n){if(s.currentLevel<=t.ERROR){const t=s.formatTimestamp(),i=o?`[${o}]`:"[ERROR]";console.error(`[${t}] ${i} ${e}`,n||"")}}static error(e,o,n,i){if(s.currentLevel<=t.ERROR){const t=s.formatTimestamp(),a=n?`[${n}]`:"[ERROR]",r=e?`${e.tagName}.${e.className||"no-class"}`:"null";console.error(`[${t}] ${a} [${r}] ${o}`,i||"")}}static taskTimes(){0}static showValue(t,e,o){0}static deleteValue(t,e){0}static clearTag(t,e){0}static logCaller(t){0}static checkState(t){0}}s.currentLevel=t.WARN,function(t){t[t.initial=1]="initial",t[t.inWhiteList=2]="inWhiteList",t[t.outOfWhiteList=3]="outOfWhiteList"}(e||(e={}));const a={minMaskAreaRatioThreshold:1,opacityFilter:[0,100],minContentAreaRatioThreshold:15,scrollNodePattern:["srcoll","List","swiper"],closeButtonPattern:["close","guanbi","dele"],buttonPattern:["button","btn"],scaleAnimationDuration:100,minScaleFactor:55,breakpoints:[{widthRange:{min:320,max:500},aspectRatioRange:{min:.61,max:1.63}},{widthRange:{min:580,max:900},aspectRatioRange:{min:.7,max:2}},{widthRange:{min:1e3,max:1150},aspectRatioRange:{min:1.3,max:1.45}}],appRuleInfos:[{id:"000",pg:["home"]}],minSARTofStickyComponent:5,maxSARTofStickyComponent:45};class r{constructor(t){this._minMaskAreaRatioThreshold=t.minMaskAreaRatioThreshold,this._opacityFilter=t.opacityFilter,this._minContentAreaRatioThreshold=t.minContentAreaRatioThreshold,this._scrollNodePattern=t.scrollNodePattern,this._closeButtonPattern=t.closeButtonPattern,this._buttonPattern=t.buttonPattern,this._scaleAnimationDuration=t.scaleAnimationDuration,this._minScaleFactor=t.minScaleFactor,this._breakpoints=t.breakpoints,this._appRuleInfos=t.appRuleInfos,this.appId="",this.page="",this.checkRuleStateResult=e.initial,this._minSARTofStickyComponent=t.minSARTofStickyComponent,this._maxSARTofStickyComponent=t.maxSARTofStickyComponent}getMinMaskAreaRatioThreshold(){return this._minMaskAreaRatioThreshold}getMinSARTofStickyComponent(){return this._minSARTofStickyComponent}getMaxSARTofStickyComponent(){return this._maxSARTofStickyComponent}getOpacityFilter(){return this._opacityFilter}getMinContentAreaRatioThreshold(){return this._minContentAreaRatioThreshold}setMinContentAreaRatioThreshold(t){this._minContentAreaRatioThreshold=t}getscrollNodePattern(){return this._scrollNodePattern}getcloseButtonPattern(){return this._closeButtonPattern}getButtonPattern(){return this._buttonPattern}getScaleAnimationDuration(){return this._scaleAnimationDuration}getMinScaleFactor(){return this._minScaleFactor}getAppID(){return this.appId}getPage(){return this.page}findAspectRatioRange(t){for(const e of this._breakpoints)if(t>=e.widthRange.min&&t<=e.widthRange.max)return e.aspectRatioRange}update(t){this._minMaskAreaRatioThreshold=t.minMaskAreaRatioThreshold,this._opacityFilter=t.opacityFilter,this._minContentAreaRatioThreshold=t.minContentAreaRatioThreshold,this._scaleAnimationDuration=t.scaleAnimationDuration,this._minScaleFactor=t.minScaleFactor,this._appRuleInfos="string"==typeof t.appRuleInfos?JSON.parse(t.appRuleInfos):t.appRuleInfos}fromJson(t){try{const e=JSON.parse(t);this.update(e)}catch(e){return s.e("Failed to parse ProductConfig from JSON",i.ccmConfig,e),!1}return!0}static getInstance(){return r.instance||(r.instance=new r(a)),r.instance}checkRule(){if(this.checkRuleStateResult!==e.initial)return this.checkRuleStateResult;const t=String("function"==typeof window._getAppId_?window._getAppId_():""),o=String("function"==typeof window._getPage_?window._getPage_():"");if(!t||""===t||!o||""===o)return i.ccmConfig,e.initial;this.appId=t,this.page=o;for(const n of this._appRuleInfos){const i="*"===n.id||n.id===t,s=n.pg.includes("*")||n.pg.includes(o);if(i&&s)return this.checkRuleStateResult=e.inWhiteList,this.checkRuleStateResult}return this.checkRuleStateResult=e.outOfWhiteList,this.checkRuleStateResult}}class l{static init(){this.offsetHeightCache||(this.offsetHeightCache=this.createSpecStyleCache(t=>t.offsetHeight),this.offsetWidthCache=this.createSpecStyleCache(t=>t.offsetWidth),this.offsetTopCache=this.createSpecStyleCache(t=>t.offsetTop),this.offsetLeftCache=this.createSpecStyleCache(t=>t.offsetLeft),this.scrollHeightCache=this.createSpecStyleCache(t=>t.scrollHeight),this.scrollWidthCache=this.createSpecStyleCache(t=>t.scrollWidth),this.childCountCache=this.createSpecStyleCache(t=>t.childElementCount),this.getRectCache=this.createSpecStyleCache(t=>t.getBoundingClientRect()),this.getComputedStyleCache=this.createSpecStyleCache(getComputedStyle),this.localNameCache=this.createSpecStyleCache(t=>t.localName))}static createSpecStyleCache(t){const e=new Map;return this.clearMap.set(e,()=>e.clear()),function(o,...n){if(!o)return void s.e("input null to CacheStyleGetter");const i=e.get(o);if(i)return i;const a=t.call(null,o,...n);return e.set(o,a),a}}}l.clearMap=new Map,l.specStyleCache=new Map;class c{static visibleOffsetH(t){return 0}static offsetW(t){return l.offsetWidthCache(t)||0}static offsetH(t){return l.offsetHeightCache(t)||0}static computedStyleDec(t){return l.getComputedStyleCache(t)}static computedStyle(t,e){let o,n=l.specStyleCache.get(t);if(n){if(o=n.get(e),o)return o}else n=new Map;return c.computedStyleDec&&l.getComputedStyleCache?(o=c.computedStyleDec(t).getPropertyValue(e),n.set(e,o),l.specStyleCache.set(t,n),o):o}static localName(t){return l.localNameCache?l.localNameCache(t):""}static clearSpecCache(){for(const t of l.clearMap.values())t.call(null);l.specStyleCache.clear()}}class u{}u.minMargin=5,u.ATTR_NUM=5,u.display="display",u.width="width",u.minHeight="min-height",u.transform="transform",u.transition="transition",u.transform_origin="transform-origin",u.translate="translate",u.perspective="perspective",u.flex="flex",u.position="position",u.top="top",u.left="left",u.bottom="bottom",u.float="float",u.vertical_align="vertical-align",u.justify_content="justify-content",u.margin_top="margin-top",u.margin_left="margin-left",u.margin_right="margin-right",u.flex_direction="flex-direction",u.align_items="align-items",u.margin_bottom="margin-bottom",u.padding_top="padding-top",u.padding_bottom="padding-bottom",u.padding_right="padding-right",u.padding_left="padding-left",u.right="right",u.overflow="overflow",u.overflow_x="overflow-x",u.overflow_y="overflow-y",u.zoom="zoom",u.z_index="z-index",u.line_height="line-height",u.computedWidth="computedWidth",u.box_sizing="box-sizing",u.background_size="background-size",u.border_bottom_width="border-bottom-width",u.border_top_width="border-top-width",u.border_left_width="border-left-width",u.border_right_width="border-right-width",u.border_left="border-left",u.border_right="border-right",u.border_top="border-top",u.white_space="white-space",u.text_align="text-align",u.max_height="max-height",u.flex_grow="flex-grow",u.row="row",u.flex_shrink="flex-shrink",u.filter="filter",u.flex_wrap="flex-wrap",u.content="content",u.name_="name",u.meta="meta",u.viewport="viewport",u.resize="resize",u.load="load",u.childList="childList",u.border_radius="border-radius",u.border="border",u.border_width="border-width",u.max_width="max-width",u.transition_duration="transition-duration",u.visibility="visibility",u.opacity="opacity",u.rel="rel",u.href="href",u._webkit_box_flex="-webkit-box-flex",u.scale="scale",u.flex_basis="flex-basis",u.box_shadow="box-shadow",u.pointer_events="pointer-events",u.px="px",u.style="style",u.media_="media",u.WIDE_SCREEN_MEDIA_EN_DEFAULT="only screen and (max-height : 500px), screen and (min-width : 500px)",u.WIDE_SCREEN_MEDIA_DIS="only screen and (max-height : -10px)",u.none="none",u.stylesheet="stylesheet",u.link="link",u.delete="delete",u.fixed="fixed",u.sticky="sticky",u.absolute="absolute",u.static="static",u.relative="relative",u.wrap="wrap",u.column="column",u.space_between="space-between",u.space_evenly="space-evenly",u.space_around="space-around",u.true="true",u.false="false",u.grid_template_columns="grid-template-columns",u.gap="gap",u.grid_auto_flow="grid-auto-flow",u.dense="dense",u.start="start",u.fit_content="fit-content",u.break_inside="break-inside",u.avoid="avoid",u.grid="grid",u.border_box="border-box",u.tag_truncate="truncate-tag",u.discrepancy=1,u.maxCloseButtonSizeRatio=.15,u.bottomCloseButtonRatio=.6,u.flexDelHeightThreshold=2,u.truncateThreshold=2,u.centerCloseButtonThreshold=5,u.ERR_CODE_GAPS=100,u.ERR_CODE_OVERFLOW=50,u.ERR_CODE_OFFSET=10,u.ERR_CODE_CLOSE_BTN_OVERLAP=2,u.ERR_CODE_INTERACTIVE=1,u.paddingTop="padding-top",u.paddingBottom="padding-bottom",u.transitionend="transitionend",u.script="script",u.noscript="noscript",u.back="back",u.swiperBox="swiper-box",u.num0px="0px",u.hidden="hidden",u.num100percent="100%",u.important="!important",u.hw_="hw_",u.a_="a",u.hwA=u.hw_+u.a_;const d={DISABLE:"disable",VERTICAL_GRID:"vertical_grid",ASIDE_BAR:"asideBar",BACK_IMG:"backImg",ONE_LINE:"oneLine",ZOOM_PARENT:"zoomParent",IS_IMG:"isImg",HAS_TEXT_CHILD:"hasTextChild",WATERFALL:"waterfall",SWIPER:"swiper",SCROLL_LIST:"scrollList",COMMENT:"comment",HEADER:"header",ACROSS_COLUMN:"across_column",NEXT_ROUND:"next_round",BOTTOM:"bottom",EMPTY:"empty"},p="hwLayout",h="thirdLayout",m="diffEle",g="insertRule",f="insertSwiper",y="multi_items",T="ele_num",C="origin_width",S="height0",A="force_css",N="origin_height";class R{static setValue(t,e,o){if(!t)return;i.store;let n=this.valueMap.get(e);n||(n=new Map,this.valueMap.set(e,n)),n.set(t,o),s.showValue(t,e,o),R.saveOriginHeight(t,e)}static removeValue(t,e){if(!t)return;i.store;const o=this.valueMap.get(e);o&&(o.delete(t),s.deleteValue(t,e))}static getValue(t,e){if(!t)return null;const o=this.valueMap.get(e);if(!o)return null;const n=o.get(t);return n||null}static clearTag(t){s.clearTag(this.valueMap,t),this.valueMap.delete(t)}static clearAllTag(t,e){const o=[C,T,S,y,S,d.HAS_TEXT_CHILD,d.IS_IMG,m],n=(new Map).set(h,d.DISABLE);for(let[i,a]of this.valueMap){if(!e&&o.includes(i))continue;const r=n.get(i);!e&&r&&R.getValue(t,i)===r||(a.delete(t),s.deleteValue(t,i))}}static removeNextRoundTags(){R.nextRoundCache.forEach(t=>{R.removeValue(t,p)}),R.nextRoundCache=[]}static saveOriginHeight(t,e){e===p&&R.getValue(t,N)&&R.setValue(t,N,c.offsetH(t).toString())}}R.valueMap=new Map,R.nextRoundCache=[];class E{static getHTMLElement(t){return t instanceof HTMLElement?t:t.parentElement}static isWideScreen(){const t=screen.availHeight,e=screen.availWidth;if(0===t)return!1;const o=r.getInstance().findAspectRatioRange(e);if(void 0===o)return!1;const n=e/t;return n>o.min&&n<o.max}static setParentTag(t,e=p,o=d.ZOOM_PARENT){t&&(R.getValue(t,e)||(R.setValue(t,e,o),this.setParentTag(t.parentElement,e,o)))}static hadRelayOut(t){return null!=R.getValue(t,p)}static hadZoomRelayout(t){return![null,d.ZOOM_PARENT].includes(R.getValue(t,p))}static hadConfig(t){return null!=R.getValue(t,h)}static timesBetween(t,e,o){return t/e<o&&e/t<o}static getInterval(t,e){return t[0]>t[1]||e[0]>e[1]?null:t[1]<e[0]||t[0]>e[1]?0:Math.min(t[1],e[1])-Math.max(t[0],e[0])}static MapAContainsMapB(t,e){for(const[o,n]of e.entries()){let e=t.get(o);if(e!==n&&(n!==u.delete||e))return!1}return!0}static isZoomParent(t){return R.getValue(t,p)===d.ZOOM_PARENT}static hadZoomLayout(t){const e=R.getValue(t,p);return null!=e&&e!==d.ZOOM_PARENT}static hadStretchedWidth(t){const e=R.getValue(t,p);return[d.ACROSS_COLUMN,d.ONE_LINE,d.EMPTY,d.COMMENT,d.SCROLL_LIST].includes(e)}static hadZoomConfig(t){const e=R.getValue(t,h);return null!=e&&e!==d.ZOOM_PARENT}static isInvisibleElement(t){if(c.computedStyle(t,u.display)===u.none)return!0;if(c.computedStyle(t,u.visibility)===u.hidden)return!0;return"0"===c.computedStyle(t,u.opacity)}static getAvailWidth(){return screen.availWidth}static ignoreEle(t){const e=[];if(!e.length)return!1;if(!t.className)return!1;for(let o=0;o<t.classList.length;o++)if(e.includes(t.classList[o]))return!0;return!1}static ignoreLocalName(t,e=[]){const o=[u.script,u.style,u.swiperBox,u.noscript].concat(e),n=c.localName(t);return o.includes(n)||n.startsWith(u.back)}static callRelayoutHappen(){E.hadCalledRelayoutHappen||(E.hadCalledRelayoutHappen=!0)}static isEmptyText(t){return!t||!/[^\t\n\r ]/.test(t)}static paddingFillHeight(t){const e=parseFloat(c.computedStyle(t,u.paddingTop)),o=parseFloat(c.computedStyle(t,u.paddingBottom));if(0===e&&0===o)return!1;if(e&&o)return!1;const n=Math.round(e||o);return c.offsetH(t)===n}static restoreLeftMarginSpace(t,e){}static getNumBetween(t,e,o){const n=Math.max(e,o),i=Math.min(e,o);return Math.min(Math.max(t,i),n)}static isImgCompleted(t){return!0}static hasSameSize(t,e){return!1}}E.TAG=i.util,E.hadCalledRelayoutHappen=!1;class w{static clearAllCache(){R.removeNextRoundTags(),this.bodyCache=void 0,this.documentCache=void 0}static clearStyleCache(){c.clearSpecCache()}static body_(){return this.bodyCache||(this.bodyCache=document.body),this.bodyCache}static documentElement_(){return this.documentCache||(this.documentCache=document.documentElement),this.documentCache}}w.bodyCache=void 0,w.documentCache=void 0;class I{}I.INDEX_IDX=0,I.STYLE_MAP_IDX=1,I.styleCache=new Map,I.styleFlushed=new Map,I.uniqueVirIdx=0,I.indexMappingList=[],I.styleDiv=null;class _{static reInit(){_.initFlag||(I.styleDiv=this.creatStyleDiv(),_.initFlag=!0)}static creatStyleDiv(){const t=document.createElement(u.style),e=document.head.appendChild(t);return _.styleNodeList.push(e),_.updateState(),e}static enableMedia(){if(!this.styleNodeList.length)return;let t;t=window.matchMedia(u.WIDE_SCREEN_MEDIA_EN_DEFAULT).matches?u.WIDE_SCREEN_MEDIA_EN_DEFAULT:"",i.cssSheetManage;for(let e=0;e<this.styleNodeList.length;e++)this.styleNodeList[e].setAttribute(u.media_,t)}static disableMedia(t=!1){if(!this.styleNodeList.length)return;const e=_.styleNodeList.some(t=>""===t.getAttribute(u.media_)),o=window.matchMedia(u.WIDE_SCREEN_MEDIA_EN_DEFAULT).matches;if(t||e||o)for(let n=0;n<this.styleNodeList.length;n++)this.styleNodeList[n].setAttribute(u.media_,u.WIDE_SCREEN_MEDIA_DIS)}static updateState(){E.isWideScreen()?_.enableMedia():_.disableMedia()}}_.initFlag=!1,_.styleNodeList=[];class b{static queryInsertRuleEle(){for(let[t,e]of this.insertRuleSelectorArr){const o=document.querySelectorAll(t);for(let t=0;t<o.length;t++){o[t];for(let t=0;t<e.length;t++){e[t]}}}}static appendRule(t,e){this.forceCSSAppendStyle;let o="",n=[];for(let s=0;s<e.length;s++){const t=e[s];n.push(t[0]),o+=`${t[0]}: ${t[1]}!important;`}const i=this.insertRuleSelectorArr.findIndex(e=>{const[o]=e;return o===t});-1!==i&&(this.forceCSSAppendStyle.sheet.deleteRule(i),this.insertRuleSelectorArr.splice(i,1)),this.insertRuleSelectorArr.push([t,n,o]),this.forceCSSAppendStyle.sheet.insertRule(`${t}{${o}} `,this.insertRuleSelectorArr.length-1)}static setStyle(t,e,o){if(this.hasForceCSS(t,e))return void i.styleSetter;i.styleSetter;const n=I.styleCache.get(t);n?n.set(e,o):I.styleCache.set(t,(new Map).set(e,o))}static setStyleByInsertRule(t,e,o){if(this.hasForceCSS(t,e))return void i.styleSetter;let n,s=`[class='${t.className}']`;t.style.position===u.fixed&&(s+='[style*="position: fixed;"]'),t.style.top&&(s+=`[style*='top: ${t.style.top};']`),t.id&&(s=`#${t.id}`+s),n=t.getAttribute(g)?t.getAttribute(g):"LayoutKey.INSERT_RULE"+I.uniqueVirIdx++,t.setAttribute(g,n),s+=`[${g}='${n}']`,t.setAttribute(g,n),this.appendRule(s,[[e,o]])}static hasForceCSS(t,e){const o=R.getValue(t,A);if(!o)return!1;return o.split(",").includes(e)}static flushAllStyles(){I.styleDiv.parentElement!==document.head&&(I.styleDiv=document.head.appendChild(I.styleDiv)),this.queryInsertRuleEle(),this.flushRemove(),this.flushCacheToCSSSheet(),this.checkAttr(),I.styleCache.clear()}static flushRemove(){for(let t=0;t<b.deleteList.length;t++)b.deleteList[t].remove();b.deleteList=[]}static removeEle(t){t&&b.deleteList.push(t)}static flushCacheToCSSSheet(){for(const[t,e]of I.styleCache.entries()){if(!t)continue;let o=I.styleFlushed.get(t);if(e.delete(u.delete)){if(o){const e=o[I.INDEX_IDX];this.deleteOldStyle(t,e),o=void 0}if(!e.size)continue}if(o||(o=[I.uniqueVirIdx,new Map],I.styleFlushed.set(t,o),I.uniqueVirIdx++),E.MapAContainsMapB(o[I.STYLE_MAP_IDX],e)){i.styleSetter;continue}const n=b.mergeStyle(e,o[I.STYLE_MAP_IDX]),s=o[I.INDEX_IDX];I.styleFlushed.set(t,[s,n]),this.setStoreStyleToCSSSheet(t,s,n)}}static mergeStyle(t,e){for(let[o,n]of t.entries())n===u.delete?e.delete(o):e.set(o,n);return e}static deleteOldStyle(t,e){I.styleFlushed.delete(t),b.delAttr(t);const o=b.findRuleIdxInList(e);-1!==o&&(I.styleDiv.sheet.deleteRule(o),b.delRuleIdxInList(o))}static setStoreStyleToCSSSheet(t,e,o){const n=b.getRulesStr(o),s=b.getSelectStr(t,e);b.setAttr(t,e);let a=b.findRuleIdxInList(e);-1!==a?I.styleDiv.sheet.deleteRule(a):a=b.addRuleIdxInList(e),I.styleDiv.sheet.insertRule(s+"{"+n+"}",a),i.styleSetter}static getRulesStr(t){let e="";for(const[o,n]of t)e+=o+":"+n+" "+u.important+";\n";return e}static getSelectStr(t,e){const o=b.getAttrSelectStr(e);return b.getIdSelect(t,o)+o}static getAttrSelectStr(t){let e="";const o=u.a_+t;for(let n=0;n<u.ATTR_NUM;n++){e+=`[${b.generateAttrKey(n)}=${o}]`}return e}static getIdSelect(t,e){let o="";const n=/^[a-zA-Z_.-][0-9a-zA-Z_.-]*$/g;for(n.test(t.id)&&(o+=`#${t.id}`.replace(/\./g,"\\.")),t=t.parentElement;t&&t!==w.body_();)n.test(t.id)&&(o=`#${t.id}`.replace(/\./g,"\\.")+" "+o),t=t.parentElement;return o&&(o+=e+","),o}static setAttr(t,e){const o=u.a_+e;for(let n=0;n<u.ATTR_NUM;n++){const e=b.generateAttrKey(n);t.setAttribute(e,o)}}static delAttr(t){for(let e=0;e<u.ATTR_NUM;e++){const o=b.generateAttrKey(e);t.removeAttribute(o)}}static checkAttr(){for(let t=0;t<this.observeList.length;t++){const e=this.observeList[t],o=I.styleFlushed.get(e);o&&this.setAttr(e,o[I.INDEX_IDX])}this.observeList=[]}static addRuleIdxInList(t){return I.indexMappingList.push(t),I.indexMappingList.length-1}static findRuleIdxInList(t){return I.indexMappingList.findIndex(e=>e===t)}static delRuleIdxInList(t){t<0||t>=I.indexMappingList.length||I.indexMappingList.splice(t,1)}static disableHandle(t){R.setValue(t,h,d.DISABLE),E.setParentTag(t.parentElement,p,d.ZOOM_PARENT),E.setParentTag(t.parentElement,h,d.ZOOM_PARENT)}static checkAndSetStyle(t,e,o){if(!t)return;const n=c.computedStyle(t,e);null!==n&&n!==u.num0px||b.setStyle(t,e,o)}static generateAttrKey(t){return u.hw_+String.fromCharCode(t+u.a_.charCodeAt(0))}}b.insertRuleSelectorArr=[],b.deleteList=[],b.observeList=[];class v{constructor(t,e){if(this.taskCount=0,this.isLocked=!1,this.timerId=null,v.TAG,"function"!=typeof e)throw s.e("任务参数必须是函数",v.TAG),new TypeError("Throttle: task must be a function");"number"!=typeof t||t<v.MIN_TIMEOUT?(s.w(`⚠️ timeout参数无效 (${t}ms)，使用最小值 ${v.MIN_TIMEOUT}ms`,v.TAG),this.timeout=v.MIN_TIMEOUT):this.timeout=t,this.taskToRun=e,this.timeout,e.name,v.TAG}postTask(){this.taskCount++,this.isLocked?(this.taskCount,v.TAG):(this.taskCount,v.TAG,this.executeTask())}cancel(){const t=this.taskCount;v.TAG,this.taskCount=0,null!==this.timerId&&(v.TAG,clearTimeout(this.timerId),this.timerId=null),t>0&&v.TAG}destroy(){v.TAG,this.cancel(),this.isLocked=!1,v.TAG}executeTask(){const t=Date.now();this.taskCount;v.TAG,this.lock();try{v.TAG,this.taskToRun();Date.now();v.TAG,this.scheduleUnlock(t)}catch(e){const o=Date.now()-t;s.e(`❌ 任务执行失败 (耗时: ${o}ms): ${e}`,v.TAG,e),s.w("紧急解锁以避免死锁",v.TAG),this.unlock()}}lock(){this.taskCount;this.isLocked=!0,this.taskCount=0,Date.now(),v.TAG}scheduleUnlock(t){const e=t+this.timeout,o=Date.now(),n=Math.max(0,e-o);this.timeout,v.TAG,null!==this.timerId&&(v.TAG,clearTimeout(this.timerId)),this.timerId=window.setTimeout(()=>{this.timerId=null,v.TAG,this.unlock()},n)}unlock(){if(this.isLocked=!1,this.taskCount>0){this.taskCount;Date.now(),v.TAG,this.executeTask()}else Date.now(),v.TAG}getState(){const t={isLocked:this.isLocked,taskCount:this.taskCount,timeout:this.timeout};return v.TAG,t}}v.TAG=i.throttle,v.MIN_TIMEOUT=10;class D{static removeAllStyle(t){i.styleCleaner;const e=(new Map).set(u.delete,u.true);I.styleCache.set(t,e)}static removeSingleStyle(t,e){i.styleCleaner,b.setStyle(t,e,u.delete)}static resetEle(t,e=!1){i.styleCleaner,R.getValue(t,p),i.styleCleaner,R.getValue(t,h),i.styleCleaner,D.resetChild(t,e),D.resetParent(t.parentElement)}static resetChild(t,e){if(t){if(R.getValue(t,f))return t.parentElement,i.styleCleaner,void t.remove();D.removeAllStyle(t),R.clearAllTag(t,e),[...t.children].forEach(t=>{D.resetChild(t,e)})}}static resetParent(t){if(t&&t!==w.documentElement_()&&(R.getValue(t,p)===d.ZOOM_PARENT||R.getValue(t,h)===d.ZOOM_PARENT)){for(let e=0;e<t.children.length;e++){const o=t.children[e];if(o&&(R.getValue(o,p)||R.getValue(o,h)))return}this.removeAllStyle(t),R.clearAllTag(t,!1),this.resetParent(t.parentElement)}}static resetParentRelayout(t){return!(!t||E.isZoomParent(t))&&(R.getValue(t,p),i.styleCleaner,R.getValue(t,p)===d.NEXT_ROUND||(E.hadZoomLayout(t)?(i.styleCleaner,E.hadStretchedWidth(t)?(i.styleCleaner,D.resetEle(t),tt.nextRoundAndPost(t),!0):(D.resetEle(t),!1)):D.resetParentRelayout(t.parentElement)))}static removeWidth(t){D.removeSingleStyle(t,u.width),D.removeSingleStyle(t,u.max_width),D.removeSingleStyle(t,u.flex_basis)}}var x,M,k;!function(t){t[t.Center=1]="Center",t[t.Center_Button_Overlap=2]="Center_Button_Overlap",t[t.Bottom=3]="Bottom",t[t.Picker=4]="Picker"}(x||(x={}));class L{static hasExplicitlyDefinedStyle(t,e,o,n){i.layoutUtils,t.className||t.tagName,i.layoutUtils;const s=t.style[e];if(s&&this.convertToPxUnits(s)===o)return i.layoutUtils,!0;i.layoutUtils;const a=this.findStyleInSheets(t,e,o);if(a.isFound)return i.layoutUtils,!0;if(!a.crossDomainSheetEncountered)return i.layoutUtils,!1;i.layoutUtils;const r=t.getBoundingClientRect();if("top"===e){const t=Math.abs(r[e]-parseFloat(o))<u.discrepancy;return r.top,Math.abs(r[e]-parseFloat(o)),i.layoutUtils,t}const l=Math.abs(r[e]-window.innerHeight)<u.discrepancy;return r.bottom,Math.abs(r[e]-window.innerHeight),i.layoutUtils,l}static findStyleInSheets(t,e,o){let n=!1;document.styleSheets.length,i.layoutUtils;for(const s of document.styleSheets){const a=this._processSingleSheet(s,t,e,o);if(a.error&&(n=!0),a.isFound)return i.layoutUtils,{isFound:!0,crossDomainSheetEncountered:n}}return i.layoutUtils,{isFound:!1,crossDomainSheetEncountered:n}}static _processSingleSheet(t,e,o,n){try{return{isFound:Array.from(t.cssRules).some(t=>this._isRuleMatch(t,e,o,n)),error:!1}}catch(a){return s.w(`无法访问跨域样式表，某些样式检查可能不准确: ${t.href}`,i.layoutUtils),{isFound:!1,error:!0}}}static _isRuleMatch(t,e,o,n){if(!(t instanceof CSSStyleRule&&t.selectorText&&e.matches(t.selectorText)))return!1;const i=t.style.getPropertyValue(o);return i&&L.convertToPxUnits(i)===n}static hasTopStyle(t,e,o){return this.hasExplicitlyDefinedStyle(t,"top",o,e)}static hasBottomStyle(t,e,o){return this.hasExplicitlyDefinedStyle(t,"bottom",o,e)}static convertToPxUnits(t){return t.endsWith("rem")?parseFloat(t)*parseFloat(getComputedStyle(document.documentElement).fontSize)+"px":t.endsWith("vw")||t.endsWith("%")?window.innerHeight*parseFloat(t)/100+"px":t}static isNodeTruncated(t,e){if(!(t instanceof HTMLElement))return!1;i.layoutUtils,t.className||t.tagName,i.layoutUtils;const o=window.innerHeight,n=(null==e?void 0:e.stickyTop_height)||0,s=(null==e?void 0:e.stickyBottom_height)||0;i.layoutUtils,i.layoutUtils;const a=t.getBoundingClientRect(),r=window.getComputedStyle(t),l=parseFloat(r.borderTopWidth),c=parseFloat(r.borderBottomWidth),d=parseFloat(r.paddingTop),p=parseFloat(r.paddingBottom),h=a.top+l+d,m=a.bottom-c-p;if(i.layoutUtils,h>=m)return i.layoutUtils,!1;const g=Math.round(h)<n,f=Math.round(m)>o-s+u.truncateThreshold;g&&(t.className,i.layoutUtils),f&&(t.className,i.layoutUtils);const y=g||f;return i.layoutUtils,y}static isOverflowScroll(t){const e=this.hasScrollbar(t),o=t.scrollHeight>t.clientHeight;return e&&o}static isOverflowScrollChild(t,e){var o;(null===(o=t.className)||void 0===o?void 0:o.split(" ")[0])||t.tagName;e.length,i.layoutUtils;const n=e.some(e=>{var o;const n=t!==e,s=e.contains(t),a=n&&s;if(a){(null===(o=e.className)||void 0===o?void 0:o.split(" ")[0])||e.tagName;i.layoutUtils}return a});return i.layoutUtils,n}static checkIfBackgroundImgTruncated(t){if(!(t instanceof HTMLElement))return!1;let e=getComputedStyle(t);const o="none"!==e.backgroundImage&&"cover"===e.backgroundSize;return o&&(t.className||t.tagName,i.layoutUtils),o}static getWidthAsPx(t,e){return window.getComputedStyle(t).getPropertyValue(e)}static canBeRelayout(t){const e=R.getValue(t,p);return[null,d.ZOOM_PARENT,d.HEADER,d.BOTTOM,d.VERTICAL_GRID].includes(e)}static getVisibleChildren(t){return Array.from(t.children).filter(t=>{if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity})}static findParentWithEqualChildren(t,e=5){if(!t||t.nodeType!==Node.ELEMENT_NODE)return null;if("none"===window.getComputedStyle(t).display)return null;const o=Array.from(t.children).filter(t=>{const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity});if(o.length>=2){const n=new Map,s=t=>Math.round(t/e)*e;for(const t of o){const e=t.getBoundingClientRect(),o=`${s(e.width)}, ${s(e.height)}`;n.set(o,(n.get(o)||0)+1)}if([...n.values()].some(t=>t>=2))return t.className||t.tagName,o.length,i.layoutUtils,t}for(const n of o){const o=this.findParentWithEqualChildren(n,e);if((t===o||!t.contains(o))&&o)return o}return null}static analyzeComputedBoxShadow(t){var e,o,n,s;if(i.layoutUtils,!t||"string"!=typeof t||"none"===t||""===t)return i.layoutUtils,null;const a=t.match(/(rgba?\(.*?\)|hsla?\(.*?\)|#[\da-f]{3,8}|[a-z]+)/i);if(!a)return i.layoutUtils,null;const r=a[0],l=t.replace(r,"").trim().split(/\s+/).filter(Boolean);if(l.length<2)return l.length,i.layoutUtils,null;const c={offsetX:null!==(e=l[0])&&void 0!==e?e:"0px",offsetY:null!==(o=l[1])&&void 0!==o?o:"0px",blurRadius:null!==(n=l[2])&&void 0!==n?n:"0px",spreadRadius:null!==(s=l[3])&&void 0!==s?s:"0px",color:r};c.offsetX,c.offsetY,c.blurRadius,c.spreadRadius,i.layoutUtils;const u=parseFloat(c.spreadRadius),d=Math.max(window.innerWidth,window.innerHeight),p=u>=d,h=c.offsetX.trim().startsWith("0")&&c.offsetY.trim().startsWith("0")&&c.blurRadius.trim().startsWith("0")&&p;return i.layoutUtils,h}static isBottomCloseButtonOverlap(t){if(i.layoutUtils,!t||!t.root_node)return i.layoutUtils,!1;const e=t.root_node.querySelectorAll('[class*="close"]');if(e.length,i.layoutUtils,1!==e.length)return i.layoutUtils,!1;const o=e[0],n=getComputedStyle(o),s=o.getBoundingClientRect();if(n.position,n.bottom,i.layoutUtils,this.isCloseButton(o)&&"absolute"===n.position&&parseFloat(n.bottom)<0){const t=s.top,e=o.parentElement.getBoundingClientRect().top,n=o.parentElement.getBoundingClientRect().bottom;if(i.layoutUtils,t<n&&t>(e+n)/2)return i.layoutUtils,!0}return i.layoutUtils,!1}static isCloseButton(t){const e=getComputedStyle(t).background.includes("url"),o="button"===t.getAttribute("role");return!(!e&&!o)&&(i.layoutUtils,!0)}static isAbsoluteButtonInBottom(t){t.root_node.querySelectorAll('[class*="button"]');return!1}static hasElementSiblings(t){return null!==t.previousElementSibling||null!==t.nextElementSibling}static getVisualBoundingRectForAll(t){if(i.layoutUtils,!t||"function"!=typeof t.getBoundingClientRect)return i.layoutUtils,null;const e=t.getBoundingClientRect();let o=e.top,n=e.bottom;const s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode(t){if(!(t instanceof HTMLElement))return NodeFilter.FILTER_REJECT;const e=window.getComputedStyle(t.parentElement).overflowY,o="scroll"===e||"auto"===e,n=t.parentElement.scrollHeight>t.parentElement.clientHeight;return o&&n?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let a=s.nextNode();for(;a;){let t=a.getBoundingClientRect().top,e=a.getBoundingClientRect().bottom;o=Math.min(o,t),n=Math.max(n,e),a=s.nextNode()}return i.layoutUtils,{top:o,bottom:n}}static getVisualBoundingRect(t,e,o){if(i.layoutUtils,t.className||t.tagName,i.layoutUtils,!t||"function"!=typeof t.getBoundingClientRect)return i.layoutUtils,null;const n=t.getBoundingClientRect();let s=null,a=0,r=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;0!==n.height&&0!==n.width&&(r=n.left,l=n.top,c=n.right,u=n.bottom,i.layoutUtils);const d=(t,n)=>{if(this.hasScrollbar(t))return void(t=>{if(s=t,t.className||t.tagName,i.layoutUtils,!e)return;const n=t.scrollHeight-t.getBoundingClientRect().height;i.layoutUtils,o===x.Bottom?(a-=n,i.layoutUtils):o!==x.Center&&o!==x.Center_Button_Overlap||(a-=n/2,i.layoutUtils)})(t);const p=window.getComputedStyle(t);if(!(t!==n&&"hidden"===p.overflowY&&t.scrollHeight>t.clientHeight)){(t=>{const e=t.getBoundingClientRect(),o=window.getComputedStyle(t);if(!(e.width>0&&e.height>0&&"none"!==o.display&&"hidden"!==o.visibility&&parseFloat(o.opacity)>0))return;const n=e.height/e.width;n>.1&&n<10&&(r=Math.min(r,e.left),l=Math.min(l,e.top),c=Math.max(c,e.right),u=Math.max(u,e.bottom))})(t);for(const e of t.children)e instanceof HTMLElement&&d(e,n)}};d(t,t);const p=c-r,h=u-l;return 0!==n.height&&0!==n.width&&(a+=l-n.top+(h-n.height)/2),i.layoutUtils,i.layoutUtils,s&&(s.className||s.tagName),i.layoutUtils,{left:r,top:l,right:c,bottom:u,width:p,height:h,offsetY:a,scrollElement:s}}static hasScrollbar(t){const e=window.getComputedStyle(t).overflowY;return"scroll"===e||"auto"===e}static getStackingContextChain(t){const e=[];let o=t;for(;o&&o!==document.documentElement;)L.isStackingContext(o)&&e.push({element:o,zIndex:L.getEffectiveZIndex(o)}),o=o.parentElement;return e.push({element:document.documentElement,zIndex:0}),e.reverse()}static isStackingContext(t){if(t===document.documentElement)return!0;const e=window.getComputedStyle(t);return!!(this.isPositionedStackingContext(e)||this.isLayoutChildStackingContext(t,e)||this.isCssPropertyStackingContext(e)||this.isWillChangeStackingContext(e)||this.isContainStackingContext(e))||(t.className,i.layoutUtils,!1)}static isPositionedStackingContext(t){const e=t.position;return e===u.fixed||e===u.sticky||(e===u.absolute||e===u.relative)&&"auto"!==t.zIndex}static isLayoutChildStackingContext(t,e){return L.isFlexOrGridChildWithZIndex(t,e)}static isCssPropertyStackingContext(t){if(parseFloat(t.opacity)<1||"normal"!==t.mixBlendMode||"isolate"===t.isolation)return!0;return["transform","filter","backdropFilter","perspective","clipPath","mask","maskImage"].some(e=>"none"!==t[e])}static isWillChangeStackingContext(t){const e=t.willChange;return"z-index"===e||e.includes("transform")||e.includes("opacity")}static isContainStackingContext(t){const e=t.contain;return["layout","paint","strict","content"].some(t=>e.includes(t))}static isFlexOrGridChildWithZIndex(t,e){const o=t.parentElement;if(!o)return!1;const n=window.getComputedStyle(o);return("flex"===n.display||"inline-flex"===n.display||"grid"===n.display||"inline-grid"===n.display)&&"auto"!==e.zIndex}static getEffectiveZIndex(t){const e=window.getComputedStyle(t);return"auto"===e.zIndex?0:parseInt(e.zIndex,10)||0}static compareZIndex(t,e){if(i.layoutUtils,t===e)return i.layoutUtils,0;if(t.contains(e))return i.layoutUtils,-1;if(e.contains(t))return i.layoutUtils,1;const o=L.getStackingContextChain(t),n=L.getStackingContextChain(e);o.length,n.length,i.layoutUtils,i.layoutUtils;let s=0;for(;s<o.length&&s<n.length;){const t=o[s],e=n[s];if(t.element!==e.element)return this.compareSiblingContexts(t,e);s++}return L.handleByChainPost(t,e,o,n)}static compareSiblingContexts(t,e){if(t.zIndex>e.zIndex)return t.zIndex,e.zIndex,i.layoutUtils,1;if(t.zIndex<e.zIndex)return t.zIndex,e.zIndex,i.layoutUtils,-1;const o=t.element.compareDocumentPosition(e.element);return o===Node.DOCUMENT_POSITION_FOLLOWING?(i.layoutUtils,-1):o===Node.DOCUMENT_POSITION_PRECEDING?(i.layoutUtils,1):(i.layoutUtils,0)}static handleByChainPost(t,e,o,n){if(o.length<n.length){i.layoutUtils;const e=n[o.length].zIndex;if(e>0)return-1;if(e<0)return 1;{const e=t.compareDocumentPosition(n[o.length].element);return e===Node.DOCUMENT_POSITION_FOLLOWING?(i.layoutUtils,-1):e===Node.DOCUMENT_POSITION_PRECEDING?(i.layoutUtils,1):(i.layoutUtils,0)}}if(o.length>n.length){i.layoutUtils;const t=o[n.length].zIndex;if(t>0)return 1;if(t<0)return-1;{const t=o[n.length].element.compareDocumentPosition(e);return t===Node.DOCUMENT_POSITION_FOLLOWING?(i.layoutUtils,-1):t===Node.DOCUMENT_POSITION_PRECEDING?(i.layoutUtils,1):(i.layoutUtils,0)}}i.layoutUtils;const s=t.compareDocumentPosition(e);return s===Node.DOCUMENT_POSITION_FOLLOWING?(i.layoutUtils,-1):s===Node.DOCUMENT_POSITION_PRECEDING?(i.layoutUtils,1):(i.layoutUtils,0)}}class G{static isImageCanSafetyStrech(t){const e=getComputedStyle(t).backgroundImage;return!(!e||!e.includes("linear-gradient"))}static isPureText(t){return t.nodeType===Node.TEXT_NODE||1===t.childNodes.length&&t.firstChild.nodeType===Node.TEXT_NODE}static isImageContainer(t){var e;if("IMG"===t.tagName)return!0;if("img"===t.getAttribute("role"))return!0;const o=getComputedStyle(t).backgroundImage;if(o&&"none"!==o&&"initial"!==o)return!0;const n=getComputedStyle(t).webkitMaskImage;return!(!n||"none"===n||!n.includes("url"))||("SOURCE"===t.tagName&&"PICTURE"===(null===(e=t.parentElement)||void 0===e?void 0:e.tagName)||("image"===t.tagName&&"http://www.w3.org/2000/svg"===t.namespaceURI||("CANVAS"===t.tagName&&"container"===t.dataset.imageRole||(!!t.classList.contains("pseudo-image-container")||("IFRAME"===t.tagName&&"image-viewer"===t.dataset.role||!!t.classList.contains("a-lottie"))))))}static isObjectNode(t){return"object"===t.tagName}static copyEventListeners(t,e){const o=getEventListeners(t);for(const s in o)o[s].forEach(t=>{e.addEventListener(s,t.listener)});const n=t.children,i=e.children;for(let s=0;s<n.length;s++)G.copyEventListeners(n[s],i[s]);return e}static isOverFlowHidden(t,e){for(;t&&t!==e;){if("hidden"===getComputedStyle(t).overflow)return null==t||t.className,G.TAG,!0;t=t.parentElement}return!1}static pruneCommonAncestorsInTree(t,e){const o=new Set;o.add(e);for(const[n,i]of t){if(i)continue;let s=n.parentElement;for(;s&&s!==e;)t.has(s)&&o.add(s),s=s.parentElement}return o.forEach(e=>t.delete(e)),t}static getValidChildNodeLength(t){let e=0;return t&&t.childNodes&&t.childNodes.forEach(t=>{G.shouldSkip(t)||(e+=1)}),e}static getSwiperIndicator(t){if(t&&t.childNodes){const e=t.querySelectorAll('[class*="indicator"]');if(e&&1===e.length)return e[0]}return null}static findVisibleImageNode(t){for(;0!==G.getValidChildNodeLength(t);)for(const e of t.childNodes){const t=e;if(!G.shouldSkip(t))return G.isImageContainer(t)?t:G.findVisibleImageNode(t)}return null}static shouldSkip(t){return!t||t.nodeType!==Node.ELEMENT_NODE||(E.ignoreLocalName(t)?(null==t||t.className,G.TAG,!0):L.canBeRelayout(t)?!!E.isInvisibleElement(t)&&(null==t||t.className,G.TAG,!0):(null==t||t.className,G.TAG,!0))}static isElementVisible(t,e){if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const o=getComputedStyle(t);if("none"===o.display||"hidden"===o.visibility||"0"===o.opacity)return null==t||t.className,G.TAG,!1;const n=t.getBoundingClientRect();if(0===n.width||0===n.height)return null==t||t.className,G.TAG,!1;const i=t.parentElement;if("absolute"===o.position)if(G.isOverFlowHidden(i,e))return!1;return!0}static isElementInViewport(t){if(!t)return!1;const e=t.getBoundingClientRect();return e.width>0&&e.height>0&&e.top<window.innerHeight&&e.bottom>0&&e.left<window.innerWidth&&e.right>0}static getElementDepth(t){if(!t)return 0;let e=0,o=t;for(;o.parentElement;)e++,o=o.parentElement;return e}static zIndexToNumber(t){if(!t)return 0;if("auto"===t.toLowerCase())return 0;const e=parseInt(t,10);return isNaN(e)?0:e}static isColorTransparent(t){if(!t)return!1;if("transparent"===(t=t.toLowerCase().trim()))return!0;if(t.startsWith("rgba")||t.startsWith("hsla")){const e=parseFloat(t.split(",")[3]);return!isNaN(e)&&0===e}if(t.startsWith("#")&&(5===t.length||9===t.length)){const e=t.slice(1);if(4===e.length){return 0===parseInt(e[3]+e[3],16)/255}if(8===e.length){return 0===parseInt(e.slice(6,8),16)/255}}return!1}static isColorSemiTransparent(t){if(!t)return!1;t=t.toLowerCase().trim();const e=r.getInstance().getOpacityFilter();if("transparent"===t)return!1;if(t.startsWith("rgba")||t.startsWith("hsla")){const o=parseFloat(t.split(",")[3]);return!isNaN(o)&&o>e[0]/100&&o<e[1]/100}if(t.startsWith("#")&&(5===t.length||9===t.length)){const o=t.slice(1);if(4===o.length){const t=parseInt(o[3]+o[3],16)/255;return t>e[0]/100&&t<e[1]/100}if(8===o.length){const t=parseInt(o.slice(6,8),16)/255;return t>e[0]/100&&t<e[1]/100}}return!1}static hasSemiTransparentGradient(t){return!(!t||"none"===t)&&(!t.includes("transparent")&&!!/rgba$$.+?$$|hsla$$.+?$$/i.test(t))}static hasSemiTransparentFilter(t){if(!t)return!1;if(/opacity$$[^)]*$$/i.test(t)){const e=t.match(/opacity$$([^)]+)$$/),o=r.getInstance().getOpacityFilter();if(e){const t=parseFloat(e[1].trim());return t>o[0]/100&&t<o[1]/100}}return!1}static isBackgroundSemiTransparent(t){if(!t)return!1;if(G.isColorSemiTransparent(t.backgroundColor))return!0;const e=parseFloat(t.opacity),o=r.getInstance().getOpacityFilter();return e>o[0]/100&&e<o[1]/100||(!!G.hasSemiTransparentGradient(t.backgroundImage)||(!!G.hasSemiTransparentFilter(t.filter)||("none"!==t.backdropFilter||(!!/overlay|multiply|screen|soft-light/.test(t.mixBlendMode)||"none"!==t.mask))))}static isElementVisibleInViewPort(t){if(!t)return!1;const e=getComputedStyle(t);if("none"===e.display||"hidden"===e.visibility||0===parseFloat(e.opacity))return t.className,e.display,e.display,e.opacity,!1;const o=t.getBoundingClientRect();return o.width>0&&o.height>0}static getScreenAreaRatio(t){if(!t)return 0;const e=t.getBoundingClientRect(),o=window.innerWidth,n=window.innerHeight;return Math.max(0,Math.min(e.right,o)-Math.max(e.left,0))*Math.max(0,Math.min(e.bottom,n)-Math.max(e.top,0))/(o*n)*100}static hasCloseButton(t){var e;if(!t)return!1;try{const o=t.classList?Array.from(t.classList).join(" ").toLowerCase():"",n=window.getComputedStyle(t).backgroundImage.toLowerCase();if(null===(e=r.getInstance().getcloseButtonPattern())||void 0===e?void 0:e.some(t=>o.includes(t)||n.includes(t)))return!0;for(const e of Array.from(t.children))if(G.hasCloseButton(e))return!0}catch(o){}return!1}static hasButton(t){var e;if(!t)return!1;try{const o=t.classList?Array.from(t.classList).join(" ").toLowerCase():"";if(null===(e=r.getInstance().getButtonPattern())||void 0===e?void 0:e.some(t=>o.includes(t)))return!0}catch(o){}return!1}static getVisibleSiblings(t){if(G.TAG,t.className||t.tagName,G.TAG,!t||!t.parentNode)return G.TAG,[];const e=Array.from(t.parentNode.children);e.length,G.TAG;const o=e.filter(e=>{if(e===t)return!1;const o=getComputedStyle(e);if("none"!==o.display&&"hidden"!==o.visibility&&0===parseFloat(o.opacity)){const t=X.getDurationFromElement(e);t>0&&(e.className||e.tagName,o.display,o.visibility,o.opacity,G.TAG,tt.postTask())}return"none"!==o.display&&"hidden"!==o.visibility&&parseFloat(o.opacity)>0?(e.className||e.tagName,G.TAG,!0):(e.className||e.tagName,o.display,o.visibility,o.opacity,G.TAG,!1)});return G.TAG,o.length,o.length,G.TAG,o}static visualFilter(t){if(!t)return!1;const e=getComputedStyle(t);return 0!==t.offsetWidth&&0!==t.offsetHeight&&"none"!==e.display&&"hidden"!==e.visibility&&0!==parseFloat(e.opacity)}static findSiblingContent(t,e=3){const o=G.getVisibleSiblings(t);if(o.length>0)return o.length,[o,t.parentNode];if(t.children.length>0)return[[],null];let n=t.parentNode,i=1;for(;n&&n!==document.body&&i<=e;){const t=G.getVisibleSiblings(n);if(t.length>0)return t.length,[t,n.parentNode];n=n.parentNode,i++}return[[],null]}}G.TAG=i.util;class O{constructor(t){this.root=t,this.mDirty=!0,this.mComponent=t}static recognize(t){throw new Error("FATAL ERROR:Please Implement tis function in subclass")}isDirty(){return this.mDirty}setDirty(t){this.mDirty=t}contains(t){return this.mComponent.contains(t)}}class F{constructor(){this.originalLayoutState=null}static getInstance(){return F.instance||(F.instance=new F),F.instance}recordOriginalPosition(t){if(this.originalLayoutState&&this.originalLayoutState.metrics.has(t))return;const e=new Map;e.set(t,this.getLayoutMetrics(t));t.querySelectorAll("*").forEach(t=>{e.set(t,this.getLayoutMetrics(t))}),this.originalLayoutState={metrics:e,screenSize:{width:window.innerWidth,height:window.innerHeight}}}getLayoutMetrics(t){const e=t.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height,right:e.right,bottom:e.bottom}}}F.minGap=-1,F.minInterWH=Number((48/Math.max(window.devicePixelRatio,1)).toFixed(2)),F.empiricalCoefficient=.022,F.maxProportion=0,F.minAlignment=Number((20/Math.max(window.devicePixelRatio,1)).toFixed(2)),F.tolerance=Number((20/Math.max(window.devicePixelRatio,1)).toFixed(2)),F.relativeOffset=.05,F.maxOffset=.5;class P{static detectLayoutConstraintMetrics(t,e){if(i.layoutConstraintDetector,!e||0===e.size)return s.e("无效的根节点列表",i.layoutConstraintDetector),this.createErrorReport("无效的根节点列表");e.size,i.layoutConstraintDetector;const o=[],n=performance.now();let a=0,r="",l=!0,c=!0;for(const h of e){if(h.tagName,h.className,i.layoutConstraintDetector,!(h&&h instanceof HTMLElement)){s.e(`无效的根节点: ${h}`,i.layoutConstraintDetector);continue}const t=this.collectLayoutMetrics(h);t.size,i.layoutConstraintDetector,t.has(h)||(s.w("根节点布局数据缺失，重新获取",i.layoutConstraintDetector),this.addRootNodeMetrics(h,t)),i.layoutConstraintDetector;const e=this.detectSafeAreaGaps(h,t,o);Object.values(e).every(t=>t>=F.minGap)?i.layoutConstraintDetector:(s.w(`安全间隙检测失败: 左${e.left.toFixed(1)} 上${e.top.toFixed(1)} 右${e.right.toFixed(1)} 下${e.bottom.toFixed(1)}`,i.layoutConstraintDetector),a=Math.max(a,u.ERR_CODE_GAPS),l=!1),i.layoutConstraintDetector;const n=this.detectContainerOverflowRate(h,t,o);n>0?(s.w(`元素溢出率检测失败: ${n.toFixed(1)}%`,i.layoutConstraintDetector),a=Math.max(a,u.ERR_CODE_OVERFLOW),c=!1):i.layoutConstraintDetector}l||(r+="四边安全间隙检测 FAIL."),c||(r+="元素溢出率检测 FAIL."),i.layoutConstraintDetector,L.isBottomCloseButtonOverlap(t)?(s.w("关闭按钮重叠检测失败",i.layoutConstraintDetector),a=Math.max(a,u.ERR_CODE_CLOSE_BTN_OVERLAP),r+="关闭按钮重叠检测 FAIL."):i.layoutConstraintDetector;const d=this.generateFinalReport(o,a),p=performance.now()-n;return p.toFixed(2),i.layoutConstraintDetector,i.layoutConstraintDetector,i.layoutConstraintDetector,{resultCode:a,errorMsg:r,duration:p,report:d}}static generateFinalReport(t,e){return`# 布局约束指标检测报告\n\n## 总体状态: ${0===e?"✅ 通过":"❌ 未通过"}\n\n`+t.join("\n\n")+("\n\n---\n*检测标准:*\n- 安全间隙 ≥ "+F.minGap+"\n- 元素溢出率 ≤ "+F.maxProportion+".\n")}static createErrorReport(t){return{resultCode:-1,errorMsg:"",duration:0,report:`### 布局约束指标检测\n❌ 错误: ${t}`}}static addRootNodeMetrics(t,e){const o=t.getBoundingClientRect();e.set(t,{top:o.top,left:o.left,width:o.width,height:o.height,right:o.right,bottom:o.bottom})}static collectLayoutMetrics(t){t.tagName,t.className,i.layoutConstraintDetector;const e=new Map;this.addRootNodeMetrics(t,e);const o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});let n=o.nextNode();for(;n;){const i=n;if(i!==t){const t=i.getBoundingClientRect();e.set(i,{top:t.top,left:t.left,width:t.width,height:t.height,right:t.right,bottom:t.bottom})}n=o.nextNode()}return e.size,i.layoutConstraintDetector,e}static detectSafeAreaGaps(t,e,o){const n=e.get(t);if(!n)return s.e("无法获取根节点布局指标",i.layoutConstraintDetector),o.push("### 安全区域间隙检测\n❌ 错误: 无法获取根节点布局指标"),{left:0,top:0,right:0,bottom:0};n.left.toFixed(1),n.top.toFixed(1),n.right.toFixed(1),n.bottom.toFixed(1),i.layoutConstraintDetector,n.width.toFixed(1),n.height.toFixed(1),i.layoutConstraintDetector;const a=Object.assign({top:0,left:0,bottom:0,right:0},window.safeAreaInsets||{});a.left,a.top,a.right,a.bottom,i.layoutConstraintDetector;const r={left:a.left,top:a.top,right:window.innerWidth-a.right,bottom:window.innerHeight-a.bottom},l={left:n.left-a.left,top:n.top-a.top,right:r.right-n.right,bottom:r.bottom-n.bottom};F.minGap,l.left.toFixed(1),l.top.toFixed(1),l.right.toFixed(1),l.bottom.toFixed(1),i.layoutConstraintDetector;const c={left:l.left>=F.minGap,top:l.top>=F.minGap,right:l.right>=F.minGap,bottom:l.bottom>=F.minGap},u=Object.entries(c).filter(([t,e])=>!e).map(([t,e])=>t);u.length>0&&(u.join("、"),i.layoutConstraintDetector);const d=t=>t?"✅ 通过":"❌ 未通过",p=`### 1. 安全间隙检测(弹窗距离屏幕)\n- **要求**: 弹窗四边到安全区域边缘 ≥ ${F.minGap}\n- **屏幕尺寸**: ${window.innerWidth}×${window.innerHeight}\n- **安全区域**: [T:${a.top}, R:${a.right}, B:${a.bottom}, L:${a.left}]\n- **有效区域**: [L:${r.left.toFixed(1)}, T:${r.top.toFixed(1)}, R:${r.right.toFixed(1)}, B:${r.bottom.toFixed(1)}]\n- **弹窗位置**: [L:${n.left.toFixed(1)}, T:${n.top.toFixed(1)}, R:${n.right.toFixed(1)}, B:${n.bottom.toFixed(1)}]\n\n| 方向 | 要求 | 实际值 | 状态 |\n|------|------|--------|------|\n| 左侧 | ≥ ${F.minGap} | ${l.left.toFixed(1)} | ${d(c.left)} |\n| 顶部 | ≥ ${F.minGap} | ${l.top.toFixed(1)} | ${d(c.top)} |\n| 右侧 | ≥ ${F.minGap} | ${l.right.toFixed(1)} | ${d(c.right)} |\n| 底部 | ≥ ${F.minGap} | ${l.bottom.toFixed(1)} | ${d(c.bottom)} |\n\n- **整体状态**: ${Object.values(c).every(t=>t)?"✅ 全部通过":"⚠️ 部分未通过"}\n`;return o.push(p),l}static detectContainerOverflowRate(t,e,o){const n=Object.assign({top:0,left:0,bottom:0,right:0},window.safeAreaInsets||{}),s={left:n.left,top:n.top,right:window.innerWidth-n.right,bottom:window.innerHeight-n.bottom},a=this.collectInteractiveElements(t);a.length,i.layoutConstraintDetector;let r=0;const l=[];a.forEach((o,n)=>{if(o===t)return;const a=e.get(o);if(!a||0===a.width||0===a.height)return;const c=Math.round(a.left)<Math.round(s.left),u=Math.round(a.right)>Math.round(s.right),d=Math.round(a.top)<Math.round(s.top),p=Math.round(a.bottom)>Math.round(s.bottom);if(c||u||d||p){if(this.isScrollableList(o,t)||this.isSwiperComponent(o))return o.tagName,o.className,void i.layoutConstraintDetector;r++;const e=[];c&&e.push("左"),u&&e.push("右"),d&&e.push("上"),p&&e.push("下");const n=`${o.tagName}.${o.className}: ${e.join("、")}侧溢出`;i.layoutConstraintDetector,l.push(`  - ${n}`)}});const c=a.length>0?r/a.length*100:0,u=0===c?"✅ 通过":"❌ 未通过";a.length,c.toFixed(1),i.layoutConstraintDetector;const d=`### 3.  元素溢出率检测(弹窗内控件是否溢出弹窗)\n- **要求**: 元素溢出率 ≤ ${F.maxProportion}}\n- **实际值**: ${c.toFixed(1)}%\n- **状态**: ${u}\n- **详情**:\n  - 总元素数: ${a.length}\n  - 溢出元素数: ${r}\n`;return l.length>0?o.push(d+`  - **溢出元素**:\n${l.join("\n")}`):o.push(d),c}static collectInteractiveElements(t){t.tagName,t.className,i.layoutConstraintDetector;const e=new Set(["button:not([disabled])","a[href]:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[role="button"]:not([disabled])','[role="link"]:not([disabled])','[role="menuitem"]','[role="option"]','[role="img"]','[tabindex]:not([tabindex="-1"])',".a-text.iconfont",".a-view.iconfont",'.iconfont[data-action="close"]','.iconfont[data-role="button"]',".iconfont[onclick]",'.iconfont[role="button"]',".icon-close",".icon-close-circle",".icon-close_circle",".icon-guanbi",".icon-shutdown",'[class*="close"]','[class*="guanbi"]']),o=Array.from(e).join(","),n=Array.from(t.querySelectorAll(o));var s;return s=t,Array.from(e).some(t=>s.matches(t))&&(n.unshift(t),i.layoutConstraintDetector),n.length,i.layoutConstraintDetector,n}static isScrollableList(t,e){const o=t=>{const e=window.getComputedStyle(t),o=e.overflow,n=e.overflowY;return"auto"===o||"scroll"===o||"auto"===n||"scroll"===n};if(o(t))return!0;let n=t.parentElement;for(;n!==e.parentElement;){if(o(n))return!0;n=n.parentElement}return!1}static isSwiperComponent(t){const e=/swiper/,o=e.test(t.className);let n=t.parentElement;for(;n;){if(e.test(n.className))return!0;n=n.parentElement}return o}}!function(t){t[t.A=1]="A",t[t.B=2]="B",t[t.C=3]="C",t[t.Unknown=20]="Unknown"}(M||(M={}));class B{static hasOverlappingCloseButton(t,e,o){var n;const s=B.getCloseButtons(t,e);if(0===s.length)return i.popupDecisionTree,!1;const a=B.isCloseElementAbsolute(s,t,o);return s.some((t,e)=>a[e]&&B.hasOverlapWithSiblings(t))?(null===(n=null==o?void 0:o.root_node)||void 0===n||n.className,i.popupDecisionTree,!0):(i.popupDecisionTree,!1)}static judgePopupDecisionTreeType(t,e){const o=e.root_node;if(B.isTimePickerPopup(o))return x.Picker;return B.isModalWin(t,o,e)?(window.popWin="bottom",i.popupDecisionTree,x.Bottom):(window.popWin="center",i.popupDecisionTree,this.hasOverlappingCloseButton(o,t,e)?x.Center_Button_Overlap:x.Center)}static getCloseButtons(t,e){const o=e.filter(e=>{var o,n,i,s,a;if(!t.contains(e))return!1;const l=e.classList?Array.from(e.classList).join(" ").toLowerCase():"",c=window.getComputedStyle(e),u=null!==(i=null===(n=null===(o=c.backgroundImage)||void 0===o?void 0:o.toLowerCase)||void 0===n?void 0:n.call(o))&&void 0!==i?i:"",d=null!==(s=c.backgroundImage)&&void 0!==s?s:"",p=null!==(a=r.getInstance().getcloseButtonPattern())&&void 0!==a?a:[],h=p.some(t=>l.includes(t)||u.includes(t)),m=!h&&p.some(t=>d.includes(t)),g="IMG"===e.tagName&&p.some(t=>e.src.includes(t));return h||m||g});return this.filterContainedNodes(o)}static filterContainedNodes(t){const e=new Set(t),o=[];for(const n of t){let t=n.parentElement,i=!1;for(;null!==t;){if(e.has(t)){i=!0;break}t=t.parentElement}i||o.push(n)}return o}static isElementOrAncestorAbsolute(t,e){let o=window.getComputedStyle(t);if("absolute"===o.position)return!0;let n=t.parentElement;for(;n&&n!==e;){o=window.getComputedStyle(n);const t=n.getBoundingClientRect();if("absolute"===o.position&&t.height<50&&t.width<50)return!0;n=n.parentElement}return!1}static isCloseElementAbsolute(t,e,o){const{popup_type:n,mask_node:i}=o,s=n===M.B||n===M.C?e:i;return t.map(t=>this.isElementOrAncestorAbsolute(t,s))}static hasOverlapWithSiblings(t){if(!t||!t.parentElement)return!1;const e=Array.from(t.parentElement.children).indexOf(t),o=G.getVisibleSiblings(t);let n=[];return o.forEach(t=>{const o=Array.from(t.parentElement.children).indexOf(t);o!==e-1&&o!==e+1||n.push({index:o,element:t})}),0!==n.length&&n.some(o=>{if("absolute"===window.getComputedStyle(o.element).position){const e=this.calOverlapAreaRatio(o.element,t);return this.hasOverlap(o.element,t)&&e>.2&&e<1}if(o.index===e-1){const e=this.findLastChild(o.element),n=this.calOverlapAreaRatio(e,t);return this.hasOverlap(e,t)&&n>.2&&n<1}{const e=this.findFirstChild(o.element),n=this.calOverlapAreaRatio(e,t);return this.hasOverlap(e,t)&&n>.2&&n<1}})}static findFirstChild(t){if(!t||!t.lastElementChild)return null;let e=t.lastElementChild;for(;e.firstElementChild;)e=e.firstElementChild;return e}static findLastChild(t){if(!t||!t.lastElementChild)return null;let e=t.lastElementChild;for(;e.lastElementChild;)e=e.lastElementChild;return e}static hasOverlap(t,e){if(null===t)return!1;const o=t.getBoundingClientRect(),n=e.getBoundingClientRect();return!(n.right<o.left||n.left>o.right||n.bottom<o.top||n.top>o.bottom)}static calOverlapAreaRatio(t,e){if(null===t)return 0;const o=t.getBoundingClientRect(),n=e.getBoundingClientRect(),i=Math.max(o.left,n.left),s=Math.min(o.right,n.right),a=Math.max(o.top,n.top),r=Math.min(o.bottom,n.bottom),l=Math.max(0,s-i),c=Math.max(0,r-a),u=n.width*n.height;return u>0?l*c/u:0}static isTimePickerPopup(t){let e=!1,o=!1,n=!1;const s=t.querySelectorAll("*");for(const i of Array.from(s))if(i instanceof HTMLElement&&(e||(e=this.checkPickerClass(i)),o||(o=this.checkUniformHeight(i)),n||(n=this.checkLinearGradient(i)),e&&o&&n))break;return i.popupDecisionTree,e&&o&&n}static checkPickerClass(t){return"string"==typeof t.className&&t.className.includes("picker")}static checkUniformHeight(t){const e=t.children;if(e.length<2)return!1;const o=e[0].clientHeight;if(0===o)return!1;for(let n=1;n<e.length;n++){if(e[n].clientHeight!==o)return!1}return!0}static checkLinearGradient(t){const e=window.getComputedStyle(t),o=[e.backgroundImage,e.maskImage].filter(Boolean);for(const n of o){if(!n.includes("linear-gradient"))continue;const t=/(rgba?\(.*?\)|hsla?\(.*?\)|#\w{3,8}|transparent)/gi,e=n.match(t);if(!e)continue;if(e.some(t=>G.isColorSemiTransparent(t)))return!0}return!1}static isModalWin(t,e,o){const n=this.findMainContentNode(e,o);if(!n)return!1;if(this.CheckCenterCloseButton(n,t))return!1;switch(o.content_node=n,o.popup_type){case M.C:return B.isModalForTypeC(o);case M.B:return B.isModalForTypeB(o);default:return!1}}static CheckCenterCloseButton(t,e){const o=B.getCloseButtons(t,e);if(o.length<1)return!1;const n=o[0].getBoundingClientRect();return 1===o.length&&n.height<window.innerHeight*u.maxCloseButtonSizeRatio&&n.bottom>window.innerHeight*u.bottomCloseButtonRatio}static isModalForTypeC(t){const e=t.root_node,o=t.content_node;return this.judgeModalConditions(e,o)}static isModalForTypeB(t){const e=t.root_node,o=t.content_node,n=B.judgeModalConditions(e,o);return o.children.length>0?!!n||Array.from(o.children).some(t=>B.judgeModalConditions(e,t)):n}static findMainContentNode(t,e){let o=e.mask_node;if(e.popup_type===M.B)for(;o.parentElement!==t;)if(o=o.parentElement,!o)return null;const n=Array.from(t.children).filter(t=>t!==o);if(0===n.length)return null;if(1===n.length)return n[0];let i=null,s=-1/0,a=0;for(const r of n){const t=window.getComputedStyle(r),e="auto"===t.zIndex?0:parseFloat(t.zIndex);e>s?(s=e,i=r,a=1):e===s&&a++}return 1===a?i:null}static judgeModalConditions(t,e){if(B.specialCenterCondition(e))return!1;if(B.specialBottomCondition(t,e))return!0;const o=window.getComputedStyle(e),{position:n,bottom:i,top:s}=o,a=e.getBoundingClientRect(),r=B.equalToScreenWidth(e,u.discrepancy),l=Math.abs(a.bottom-window.innerHeight)<u.discrepancy,c=Math.abs(a.top)<u.discrepancy;if(!r)return!1;if(n===u.static&&"auto"===i)return l&&!c;if(0!==parseFloat(i))return!1;if(!L.hasBottomStyle(e,n,i))return!1;if(s.endsWith("px")){if(0!==parseFloat(s))return!0;if(L.hasTopStyle(e,n,s))return!1}return l}static specialBottomCondition(t,e){const o=window.getComputedStyle(e),n=window.getComputedStyle(t);return"column"===o.flexDirection&&("flex-end"===o.justifyContent||"end"===o.justifyContent)||"row"===o.flexDirection&&("flex-end"===o.alignItems||"end"===o.alignItems)||"column"===n.flexDirection&&("flex-end"===n.justifyContent||"end"===n.justifyContent)||"row"===n.flexDirection&&("flex-end"===n.alignItems||"end"===n.alignItems)}static specialCenterCondition(t){const e=window.getComputedStyle(t);return"row"===e.flexDirection&&"center"===e.alignItems||"column"===e.flexDirection&&"center"===e.justifyContent}static equalToScreenWidth(t,e){const o=window.getComputedStyle(t),{paddingLeft:n,paddingRight:i,width:s,boxSizing:a,borderLeft:r,borderRight:l}=o;return"border-box"===a?Math.abs(parseFloat(s)-window.innerWidth)<e:!(isNaN(parseFloat(n))||isNaN(parseFloat(i))||isNaN(parseFloat(r))||isNaN(parseFloat(l))||"content-box"!==a)&&Math.abs(parseFloat(s)+parseFloat(n)+parseFloat(i)-window.innerWidth)<e}}!function(t){t.IDLE="IDLE",t.WAITING_ANIMATION="WAITING_ANIMATION",t.PREPROCESSING="PREPROCESSING",t.LAYOUTING="LAYOUTING",t.WAITING_VALIDATION="WAITING_VALIDATION",t.VALIDATING="VALIDATING",t.COMPLETED="COMPLETED",t.RESTORED="RESTORED",t.FAILED="FAILED"}(k||(k={}));const W={[k.IDLE]:[k.WAITING_ANIMATION,k.PREPROCESSING,k.LAYOUTING,k.FAILED],[k.WAITING_ANIMATION]:[k.LAYOUTING,k.IDLE,k.FAILED],[k.PREPROCESSING]:[k.IDLE,k.LAYOUTING],[k.LAYOUTING]:[k.WAITING_VALIDATION,k.IDLE,k.COMPLETED,k.FAILED],[k.WAITING_VALIDATION]:[k.VALIDATING,k.IDLE,k.FAILED],[k.VALIDATING]:[k.COMPLETED,k.RESTORED,k.IDLE,k.FAILED],[k.COMPLETED]:[k.IDLE],[k.RESTORED]:[k.IDLE],[k.FAILED]:[k.IDLE]};function H(t){return{[k.IDLE]:"未布局",[k.WAITING_ANIMATION]:"等待动画完成",[k.PREPROCESSING]:"预处理",[k.LAYOUTING]:"布局中",[k.WAITING_VALIDATION]:"等待验证",[k.VALIDATING]:"验证中",[k.COMPLETED]:"已完成",[k.RESTORED]:"已恢复",[k.FAILED]:"失败"}[t]}function U(t){return{[k.IDLE]:"⚪",[k.WAITING_ANIMATION]:"⏳",[k.PREPROCESSING]:"🔄",[k.LAYOUTING]:"🔄",[k.WAITING_VALIDATION]:"⏰",[k.VALIDATING]:"🔍",[k.COMPLETED]:"✅",[k.RESTORED]:"↩️",[k.FAILED]:"❌"}[t]}class ${static getState(t){if(!t)return s.w("获取状态失败：弹窗根节点为空",$.TAG),k.IDLE;return this.stateMap.get(t)||k.IDLE}static setState(t,e,o){if(!t)return s.w("设置状态失败：弹窗根节点为空",$.TAG),!1;const n=this.getState(t);if(n===e)return U(e),H(e),$.TAG,!0;if(i=e,!W[n].includes(i))return s.e(`❌ 非法状态转换: ${U(n)} ${H(n)} -> ${U(e)} ${H(e)}`,$.TAG),!1;var i;this.stateMap.set(t,e),this.timestampMap.set(t,Date.now());return U(n),H(n),U(e),H(e),$.TAG,e!==k.COMPLETED&&e!==k.FAILED&&e!==k.RESTORED&&tt.postTask(),!0}static resetState(t,e){if(!t)return;const o=this.getState(t);U(o),H(o),U(k.IDLE),H(k.IDLE),$.TAG,this.stateMap.set(t,k.IDLE),this.timestampMap.set(t,Date.now())}static clearState(t){if(!t)return;const e=this.getState(t);U(e),H(e),$.TAG,this.stateMap.delete(t),this.timestampMap.delete(t)}static canStartLayout(t){const e=this.getState(t),o=e===k.IDLE||e===k.PREPROCESSING;return o||(U(e),H(e),$.TAG),o}static isProcessing(t){const e=this.getState(t);return e===k.WAITING_ANIMATION||e===k.PREPROCESSING||e===k.LAYOUTING||e===k.WAITING_VALIDATION||e===k.VALIDATING}static isCompleted(t){const e=this.getState(t);return e===k.COMPLETED||e===k.RESTORED}static getStateDuration(t){if(!t)return 0;const e=this.timestampMap.get(t);return e?Date.now()-e:0}static printState(t,e){if(!t)return;const o=this.getState(t);this.getStateDuration(t);U(o),H(o),$.TAG}}$.TAG=i.popupStateManager,$.stateMap=new WeakMap,$.timestampMap=new WeakMap;class V extends O{resetStyle(){throw new Error("Method not implemented.")}constructor(t){super(t.root_node),this.cancellationToken={cancelled:!1,generation:0},this.scale=1,this.minTop=1/0,this.maxBottom=-1/0,this.truncateNodes=[],this.bottomNode=null,this.needRestoreStyleNodes=new Set,this.needLayoutConstraintNodes=new Set,this.layoutConstraintResult=null,this.visualHeight=window.innerHeight,this.isCloseButtonTruncatedByScroll=!1,this.popupDecisionTreeType=x.Center,this.contentNodes=[],this.minScaleFactor=r.getInstance().getMinScaleFactor()/100,this.scaleAnimationDuration=r.getInstance().getScaleAnimationDuration(),this.scrollNodes=[],this.popupInfo=t}printTree(t=!1){}setDirty(t){this.mDirty=t}intelligenceLayout(){null!==this.mComponent?(this.visualHeight=window.innerHeight-this.popupInfo.stickyBottom_height-this.popupInfo.stickyTop_height,this.mComponent.className,window.innerWidth,window.innerHeight,this.visualHeight,i.popupRelayout,this.popupInfo.popup_type,this.popupInfo.stickyTop_height,this.popupInfo.stickyBottom_height,i.popupRelayout,this.relayout()):i.popupRelayout}cancelPendingValidation(){this.cancellationToken.cancelled=!0,this.cancellationToken.generation,i.popupRelayout}relayout(){i.popupRelayout,this.cancellationToken={cancelled:!1,generation:Date.now()};const t=this.cancellationToken;t.generation,i.popupRelayout,this.contentNodes=this.getContentNodes();const e=[];if(this.contentNodes.forEach(t=>{this.traverseTree(t,e)}),this.contentNodes.length,i.popupRelayout,$.getState(this.popupInfo.root_node)===k.IDLE&&this.tryToFixFlexShrink())$.setState(this.popupInfo.root_node,k.PREPROCESSING,"预处理，修复flex");else{if($.setState(this.popupInfo.root_node,k.LAYOUTING,"开始重布局"),this.findTruncateNodes(e),0===this.truncateNodes.length){i.popupRelayout,$.setState(this.popupInfo.root_node,k.IDLE,"无截断节点，恢复空闲状态");let t={resultCode:-1,errorMsg:"no truncateNodes found",duration:0,report:"no truncateNodes found"};return void(window.layoutConstraintResult=t)}this.truncateNodes.length,i.popupRelayout,this.popupDecisionTreeType=B.judgePopupDecisionTreeType(e,this.popupInfo),this.popupDecisionTreeType,i.popupRelayout,this.calScale(),this.scale.toFixed(3),i.popupRelayout,i.popupRelayout,this.resetByScale(),this.popupDecisionTreeType===x.Center_Button_Overlap&&(i.popupRelayout,this.fixButtonOverlap()),b.flushAllStyles(),i.popupRelayout,i.popupRelayout,this.getLayoutConstraintReport(t)}}getContentNodes(){M[this.popupInfo.popup_type],i.popupRelayout;let t=[];if(this.popupInfo.popup_type===M.C)t=this.getTopmostChildren(this.mComponent,this.popupInfo.popup_type),t.length,i.popupRelayout;else if(this.popupInfo.popup_type===M.B){this.equivalentMask=this.getEquivalentMask();t=this.getTopmostChildren(this.equivalentMask.parentElement,this.popupInfo.popup_type).filter(t=>t!==this.equivalentMask),t.length,i.popupRelayout}else this.popupInfo.popup_type===M.A&&(t=this.getTopmostChildren(this.popupInfo.mask_node,this.popupInfo.popup_type),t.length,i.popupRelayout);return t}getTopmostChildren(t,e){const o=Array.from(t.children).filter(t=>{const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&t instanceof HTMLElement&&1===parseFloat(e.opacity)&&!G.isBackgroundSemiTransparent(e)});if(e===M.C||e===M.A)return o.length,o;if(!L.isStackingContext(this.popupInfo.mask_node)){const t=o.filter(t=>L.compareZIndex(t,this.popupInfo.mask_node)>=0);return t.length,t}const n=this.traverseTree(t,[]).filter(e=>{const o=window.getComputedStyle(e);return e!==t&&!this.equivalentMask.contains(e)&&"none"!==o.display&&"hidden"!==o.visibility&&e instanceof HTMLElement&&1===parseFloat(o.opacity)&&!G.isBackgroundSemiTransparent(o)&&L.isStackingContext(e)}),i=this.filterContainedNodes(n).filter(t=>L.compareZIndex(t,this.popupInfo.mask_node)>=0);return i.length,i}getValidGrandChildren(t){return t.filter(t=>{const e=getComputedStyle(t).transform.match(/matrix\((.*?),(.*?),(.*?),(.*?),(.*?),(.*?)\)/),o=e?parseFloat(e[6]):0;return Math.abs(o)<=window.innerHeight})}calScale(){i.popupRelayout,this.truncateNodes.forEach(t=>{t.className,i.popupRelayout;let e=t.getBoundingClientRect();this.minTop=Math.min(this.minTop,e.top),e.bottom>this.maxBottom&&(this.bottomNode=t,this.maxBottom=e.bottom);let o=t;o=t===this.mComponent?t:t.parentElement;const n=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t instanceof HTMLElement?L.isOverflowScrollChild(t,this.scrollNodes)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let s=n.nextNode();for(;s;){let t=s.getBoundingClientRect().top,e=s.getBoundingClientRect().bottom;this.minTop=Math.min(this.minTop,t),e>this.maxBottom&&(this.bottomNode=s,this.maxBottom=e),s=n.nextNode()}});let t=this.maxBottom-this.minTop,e=this.visualHeight;this.scale=Math.min(1,Math.max(.7*e/t,this.minScaleFactor)),this.scale,this.bottomNode.className}resetByScale(){if(M[this.popupInfo.popup_type],i.popupRelayout,this.popupInfo.popup_type===M.C){i.popupRelayout;for(let t of this.contentNodes){const e=t.children.length>0?getComputedStyle(t.children[0]):null,o=t.getBoundingClientRect(),n=!!e&&("fixed"===e.position||"absolute"===e.position),i=0===o.width||0===o.height;this.scaleChildForTypeC(e,n,i,t,this.contentNodes)}}else if(this.popupInfo.popup_type===M.B){i.popupRelayout;for(let t of this.contentNodes){const e=t.children.length>0?getComputedStyle(t.children[0]):null,o=t.getBoundingClientRect(),n=!!e&&("fixed"===e.position||"absolute"===e.position),i=0===o.width||0===o.height;e&&n&&i?this.scaleGrandChildrenForTypeB(t,this.contentNodes):this.scaleChildForTypeB(t,this.contentNodes)}}else if(this.popupInfo.popup_type===M.A){i.popupRelayout;for(let t of this.contentNodes)this.scaleByTransform(t,this.scale,!1,this.contentNodes,!1,[]),t.className,i.popupRelayout}i.popupRelayout}scaleChildForTypeB(t,e){this.popupDecisionTreeType===x.Bottom?(t.className,i.popupRelayout,this.scaleByTransform(t,this.scale,!1,e,!1,[])):(t.className,e.length,i.popupRelayout,this.scaleByTransform(t,this.scale,e.length>1,e,!1,[]))}scaleGrandChildrenForTypeB(t,e){const o=this.getValidGrandChildren(Array.from(t.children));t.className,o.length,i.popupRelayout;for(let n=0;n<o.length;n++){const t=o[n];this.popupDecisionTreeType===x.Bottom?this.scaleByTransform(t,this.scale,!1,e,o.length>1,o):this.scaleByTransform(t,this.scale,e.length>1,e,o.length>1,o),t.className,i.popupRelayout}}scaleChildForTypeC(t,e,o,n,s){if(t&&e&&o){n.className,i.popupRelayout;const t=this.getValidGrandChildren(Array.from(n.children));t.length,i.popupRelayout;for(let e=0;e<t.length;e++){const o=t[e];this.scaleByTransform(o,this.scale,s.length>1,s,t.length>1,t),o.className,i.popupRelayout}}else n.className,i.popupRelayout,this.scaleByTransform(n,this.scale,s.length>1,s,!1,[])}getEquivalentMask(){let t=this.popupInfo.mask_node;if(this.popupInfo.popup_type!==M.B)return t;let e=t;if(t!==this.mComponent&&t.parentElement!==this.mComponent&&!L.hasElementSiblings(t)){let o=t.parentElement;for(;o!==this.mComponent&&!L.hasElementSiblings(o);)o=o.parentElement;e=o}return e}makeAllOverflowVisible(t){for(;t&&t!==document.documentElement;){"visible"!==window.getComputedStyle(t).overflow&&(b.setStyle(t,u.overflow,"visible"),this.needRestoreStyleNodes.add(t)),t=t.parentElement}}handleScrollbar(t){t.forEach(t=>{const e=window.getComputedStyle(t.parentElement).overflowY;!G.hasCloseButton(t)||"auto"!==e&&"scroll"!==e||(b.setStyle(t.parentElement,u.overflow,"visible"),this.isCloseButtonTruncatedByScroll=!0,this.makeAllOverflowVisible(t.parentElement),this.needRestoreStyleNodes.add(t.parentElement))})}findTruncateNodes(t){i.popupRelayout;const e=t.filter(t=>!L.isOverflowScrollChild(t,this.scrollNodes)&&L.isNodeTruncated(t,this.popupInfo));e.length,i.popupRelayout,this.handleScrollbar(e),this.truncateNodes=this.filterContainedNodes(e),this.truncateNodes.length,i.popupRelayout,this.truncateNodes.forEach(t=>{t.className,i.popupRelayout})}traverseTree(t,e){e.push(t),L.isOverflowScroll(t)&&this.scrollNodes.push(t);for(let o=0;o<t.childNodes.length;o++)t.childNodes[o]instanceof HTMLElement&&this.traverseTree(t.childNodes[o],e);return e}async getLayoutConstraintReport(t){if(0!==this.needLayoutConstraintNodes.size)try{if(!$.setState(this.popupInfo.root_node,k.WAITING_VALIDATION,"开始等待验证"))return void i.popupRelayout;this.needLayoutConstraintNodes.size,i.popupRelayout,setTimeout(()=>{this.runReport(t)},450)}catch(e){t.cancelled||(s.e("布局约束验证失败",i.popupRelayout,e),$.setState(this.popupInfo.root_node,k.FAILED,`验证异常: ${e}`),this.restoreStyles())}else i.popupRelayout}runReport(t){if(t.cancelled)return t.generation,void i.popupRelayout;const e=$.getState(this.popupInfo.root_node);e===k.WAITING_VALIDATION&&$.setState(this.popupInfo.root_node,k.VALIDATING,"开始验证")?(this.layoutConstraintResult=P.detectLayoutConstraintMetrics(this.popupInfo,this.needLayoutConstraintNodes),this.layoutConstraintResult.resultCode,i.popupRelayout,t.cancelled||(this.layoutConstraintResult.resultCode===u.ERR_CODE_GAPS||this.layoutConstraintResult.resultCode===u.ERR_CODE_OVERFLOW?(this.layoutConstraintResult.resultCode,i.popupRelayout,this.restoreStyles(),$.setState(this.popupInfo.root_node,k.RESTORED,"验证失败，已恢复")):(i.popupRelayout,$.setState(this.popupInfo.root_node,k.COMPLETED,"验证通过")),this.setDirty(!1),this.needLayoutConstraintNodes.clear(),window.layoutConstraintResult=this.layoutConstraintResult),i.popupRelayout):i.popupRelayout}filterContainedNodes(t){const e=new Set(t),o=[];for(const n of t){let t=n.parentElement,i=!1;for(;null!==t;){if(e.has(t)){i=!0;break}t=t.parentElement}i||o.push(n)}return o}calculateGroupCenter(t,e){if(!t)return{centerX:0,centerY:0};if(!t.parentNode)return{centerX:0,centerY:0};const o=e.filter(t=>{const e=t.getBoundingClientRect();return e.width>0&&e.height>0}).map(t=>t.getBoundingClientRect()),n=Math.min(...o.map(t=>t.top)),i=Math.max(...o.map(t=>t.bottom)),s=Math.min(...o.map(t=>t.left));return{centerX:s+(Math.max(...o.map(t=>t.right))-s)/2,centerY:n+(i-n)/2}}scaleByTransform(t,e,o,n,s,a){if(null==t||t.className,e.toFixed(3),i.popupRelayout,this._shouldSkipScaling(t))return null==t||t.className,void i.popupRelayout;const r=window.getComputedStyle(t),l=L.getVisualBoundingRect(t,this.isCloseButtonTruncatedByScroll,this.popupDecisionTreeType);this.needLayoutConstraintNodes.add(t);let c=this._calculateOffsetY(t,l,e,{hasBrother:o,brotherNodes:n,hasGrandChild:s,grandChildNodes:a});c.toFixed(2),t.className,i.popupRelayout,this._applyStyleFixes(t,r),this._applyTransform(t,r,c,e),t.className,i.popupRelayout}_shouldSkipScaling(t){const e=window.getComputedStyle(t),o=L.getVisualBoundingRect(t,this.isCloseButtonTruncatedByScroll,this.popupDecisionTreeType),n=e.transform.match(/matrix\((.*?),(.*?),(.*?),(.*?),(.*?),(.*?)\)/),i=n?parseFloat(n[6]):0;if(Math.abs(i)>window.innerHeight&&!this._isElementInViewport(o))return!0;if(this.popupDecisionTreeType===x.Bottom&&o.scrollElement){const t=o.scrollElement.getBoundingClientRect();if(!this._isElementInViewport(t))return!0;{const e=(window.innerHeight-t.top)/window.innerHeight*100;b.setStyle(o.scrollElement,u.max_height,`${e}vh`),this.needRestoreStyleNodes.add(o.scrollElement)}}return this.popupDecisionTreeType===x.Picker}_isElementInViewport(t){return t.top<window.innerHeight&&t.left<window.innerWidth&&t.bottom>0&&t.right>0}_calculateOffsetY(t,e,o,n){let i=0;const s=e.top+e.height/2;switch(this.popupDecisionTreeType){case x.Bottom:i=window.innerHeight-(s+e.height/2*o);break;case x.Center:case x.Center_Button_Overlap:i=this._calculateCenterOffsetY(t,s,o,n),i-=this.popupInfo.stickyBottom_height/2,i+=this.popupInfo.stickyTop_height/2}return i+=o*e.offsetY,i}_calculateCenterOffsetY(t,e,o,n){let s=0;if(n.hasBrother){const a=this.calculateGroupCenter(t,n.brotherNodes).centerY;s=window.innerHeight/2-a+(e-a)*(o-1),a.toFixed(0),s.toFixed(2),i.popupRelayout}else s=window.innerHeight/2-e,s.toFixed(2),i.popupRelayout;if(n.hasGrandChild){const a=(this.calculateGroupCenter(t,n.grandChildNodes).centerY-e)*(o-1);s+=a,a.toFixed(2),i.popupRelayout}return s}_applyStyleFixes(t,e){"inline"===e.display&&(b.setStyle(t,u.display,"block"),this.needRestoreStyleNodes.add(t));for(let o of t.children)""!==o.style.bottom&&"auto"!==o.style.bottom&&(b.setStyle(o,u.bottom,"unset"),this.needRestoreStyleNodes.add(o));this.adjustChildWidths(t)}_applyTransform(t,e,o,n){const i=e.transform===u.none?"":e.transform;b.setStyle(t,u.transform,`${i} translate(0px, ${o}px) scale(${n})`),b.setStyle(t,u.transition,`all ${this.scaleAnimationDuration}ms ease-in`),this.needRestoreStyleNodes.add(t)}adjustChildWidths(t){const e=window.getComputedStyle(t);if(0===parseFloat(e.width))return;const o=t.children;for(let n=0;n<o.length;n++){const t=o[n],e=window.getComputedStyle(t);0===parseFloat(e.width)&&(b.setStyle(t,u.width,u.num100percent),this.needRestoreStyleNodes.add(t))}}restoreStyles(){this.needRestoreStyleNodes.size,i.popupRelayout,this.needRestoreStyleNodes.forEach((t,e)=>{D.removeAllStyle(e)}),b.flushAllStyles(),this.needRestoreStyleNodes.clear(),i.popupRelayout}shouldFixFlexSharink(t){let e=getComputedStyle(t);if(!e.display.includes(u.flex)||e.flexDirection!==u.column||t.children.length<=1)return!1;let o=1/0,n=-1/0,i=0;return Array.from(t.children).forEach(t=>{let e=getComputedStyle(t),s=t.getBoundingClientRect();e.position!==u.absolute&&e.position!==u.fixed&&(o=Math.min(s.top-parseFloat(e.marginTop),o),n=Math.max(s.bottom+parseFloat(e.marginBottom),n),i++)}),i>1&&o!==1/0&&Math.abs(n-o-parseFloat(e.height))<u.flexDelHeightThreshold}tryToFixFlexShrink(){const t=[];this.shouldFixFlexSharink(this.mComponent)&&t.push(this.mComponent),this.mComponent.querySelectorAll("*").forEach(e=>{e instanceof HTMLElement&&this.shouldFixFlexSharink(e)&&t.push(e)});let e=0;return t.forEach(t=>{Array.from(t.children).forEach(t=>{let o=getComputedStyle(t);o.position!==u.absolute&&o.position!==u.fixed&&(b.setStyle(t,u.flex_shrink,"0"),this.needRestoreStyleNodes.add(t),e++)})}),t.length,e>0}fixButtonOverlap(){i.popupRelayout;const t=this.mComponent.querySelectorAll('[class*="close"]');if(1!==t.length)return t.length,void i.popupRelayout;const e=t[0];e.className,i.popupRelayout;const o=e.getBoundingClientRect(),n=window.innerWidth/2,s=o.left+o.width/2;if(Math.abs(s-n)>u.centerCloseButtonThreshold)return;const a=getComputedStyle(e);this.needLayoutConstraintNodes.add(e);const r=a.transform===u.none?"":a.transform;let l=0;const c=e.getBoundingClientRect().top,d=getComputedStyle(this.bottomNode),p=this.bottomNode.getBoundingClientRect().bottom;e===this.bottomNode?(l=parseFloat(d.height),l.toFixed(2),i.popupRelayout):(l=p-c,l.toFixed(2),p.toFixed(0),c.toFixed(0),i.popupRelayout),l/=this.scale;let h=`${r} translate(0px, ${l}px)`;b.setStyle(e,u.transform,h),b.setStyle(e,u.transition,`all ${this.scaleAnimationDuration}ms ease-in`),this.needRestoreStyleNodes.add(e),l.toFixed(2),i.popupRelayout}}const z={features:["root_position","has_mask","root_screen_area_ratio","root_is_visiable","has_close_button","mask_area_ratio","mask_position"],coefficients:[-.008,.565,1.012,-.214,.377,2.006,.868],intercept:3.593,scalerMean:[3.546,.948,47.741,.588,.856,80.64,4.165],scalerScale:[.557,.221,48.176,.492,.351,38.879,.621]},j={sticky:1,relative:2,static:3,fixed:4,absolute:5};class Y{static preprocessFeatures(t){var e,o;const n={},i=String(t.root_position).toLowerCase();n.root_position=null!==(e=j[i])&&void 0!==e?e:NaN;const s=String(t.mask_position).toLowerCase();return n.mask_position=null!==(o=j[s])&&void 0!==o?o:NaN,n.has_mask=t.has_mask?1:0,n.root_is_visiable=t.root_is_visiable?1:0,n.has_close_button=t.has_close_button?1:0,n.root_screen_area_ratio=t.root_screen_area_ratio,n.mask_area_ratio=t.mask_area_ratio,n}static predictIsPopup(t){const e=Y.preprocessFeatures(t);let o=z.intercept;for(let r=0;r<z.features.length;r++){const t=z.features[r],n=e[t];if(void 0===n||isNaN(n))return s.w(`预处理后的特征 '${t}' 是 undefined 或 NaN，返回非弹窗预测`,i.popupRecog),{prediction:0,probability:0};{const t=(n-z.scalerMean[r])/z.scalerScale[r];o+=z.coefficients[r]*t}}const n=(a=o,1/(1+Math.exp(-a)));var a;return{prediction:n>=.5?1:0,probability:n}}}class q{static isStickyComponentVisiable(t){const e=[t,...t.children];for(;e.length>0;){const t=e.shift();if(!(t instanceof HTMLElement))continue;const o=getComputedStyle(t),n=t.offsetWidth,i=t.offsetHeight;if("none"===o.display||"hidden"===o.visibility||0===parseFloat(o.opacity))continue;if(0===n||0===i||G.isColorTransparent(o.backgroundColor)&&!o.backgroundImage.includes("url")){e.push(...t.children);continue}return Math.abs(n-screen.availWidth)<2}return!1}static getPotentialElements(t){const e=Array.from(t.getElementsByTagName("*")).filter(t=>t.nodeType===Node.ELEMENT_NODE);let o=new Array,n=null,i=null;for(const s of e){const t=getComputedStyle(s);if(!this.isElementQualified(s,t))continue;if(this.isPotentialMask(s,t)){o.push(s);continue}const e=this.checkStickyElement(s,t,n,i);n=e.potentialStickyTop,i=e.potentialStickyBottom}return{potentialMasks:o,potentialStickyTop:n,potentialStickyBottom:i}}static isElementQualified(t,e){const o=t.offsetWidth>0&&t.offsetHeight>0&&"none"!==e.display&&"hidden"!==e.visibility&&parseFloat(e.opacity)>0,n="hidden"!==e.visibility&&0===parseFloat(e.opacity)&&G.isColorSemiTransparent(e.backgroundColor);return!(!o&&!n)&&!(Math.abs(t.offsetWidth-window.innerWidth)>=2)}static isPotentialMask(t,e){const o=G.getScreenAreaRatio(t),n=r.getInstance().getMinMaskAreaRatioThreshold();if(o>n&&G.isBackgroundSemiTransparent(e))return t.className,o.toFixed(2),i.popupDetector,!0;if(o>n&&e.position===u.fixed&&1===t.children.length){const e=t.children[0];if(getComputedStyle(e).position===u.absolute&&G.getScreenAreaRatio(e)>r.getInstance().getMinContentAreaRatioThreshold()&&G.hasCloseButton(e))return t.className,i.popupDetector,!0}return!("fixed"!==e.position||!L.analyzeComputedBoxShadow(e.boxShadow))&&(t.className,i.popupDetector,!0)}static checkStickyElement(t,e,o,n){let i=o,s=n;const a=G.getScreenAreaRatio(t);return"fixed"===e.position&&0===parseInt(e.left)&&a>r.getInstance().getMinSARTofStickyComponent()&&a<r.getInstance().getMaxSARTofStickyComponent()&&q.isStickyComponentVisiable(t)?(0===parseInt(e.top)&&(t.className,(null===i||q.isFirstElementOnTop(t,i))&&(i=t)),0===parseInt(e.bottom)&&(t.className,(null===s||q.isFirstElementOnTop(t,s))&&(s=t)),{potentialStickyTop:i,potentialStickyBottom:s}):{potentialStickyTop:o,potentialStickyBottom:n}}static isFirstElementOnTop(t,e){if(!t||!e)return!1;const o=t.getBoundingClientRect(),n=e.getBoundingClientRect(),i=Math.max(o.left,n.left),s=Math.max(o.top,n.top),a=Math.min(o.right,n.right),r=Math.min(o.bottom,n.bottom);if(a<=i||r<=s)return!1;const l=i+(a-i)/2,c=s+(r-s)/2,u=document.elementFromPoint(l,c);return!!u&&(u!==e&&!e.contains(u))}static findPopups(t){i.popupDetector;const e=q.getPotentialElements(t);e.potentialMasks.length,i.popupDetector,e.potentialStickyTop&&(e.potentialStickyTop.className,i.popupDetector),e.potentialStickyBottom&&(e.potentialStickyBottom.className,i.popupDetector);const o=q.findPopupsInternal(e);return i.popupDetector,o}static findTopMostPopup(t){return t&&0!==t.length?t.reduce((t,e)=>L.compareZIndex(t.root_node,e.root_node)>=0?t:e):null}static findBestCandidateInSibling(t,e,o){i.popupDetector,t.className||t.tagName,i.popupDetector,e.className||e.tagName,i.popupDetector;let n=null,s=0;const a=[t,...Array.from(t.querySelectorAll("*"))];i.popupDetector;const r=q.isPreviousElementSibling(e,t),l=r?1:0;i.popupDetector,i.popupDetector;for(const c of a){const t=G.zIndexToNumber(window.getComputedStyle(c).zIndex);if(t>=o+l){0;const t=G.getScreenAreaRatio(c);if(t>s){n&&(n.className||n.tagName,s.toFixed(2));s=t,n=c,c.className||c.tagName,t.toFixed(2),i.popupDetector}}else 0}return i.popupDetector,n?(n.className||n.tagName,s.toFixed(2),i.popupDetector):i.popupDetector,{candidate:n,ratio:s}}static findBestSiblingContent(t){t.className,i.popupDetector;let e=null,o=0;const n=G.zIndexToNumber(window.getComputedStyle(t).zIndex),[s,a]=G.findSiblingContent(t);s.length,i.popupDetector;for(const r of s){const s=this.findBestCandidateInSibling(r,t,n);s.ratio>o&&(o=s.ratio,e=s.candidate,o.toFixed(2),i.popupDetector)}const l=o>=r.getInstance().getMinContentAreaRatioThreshold();return i.popupDetector,l?[e,a]:[null,null]}static findPopupsInternal(t){const{potentialMasks:e,potentialStickyTop:o,potentialStickyBottom:n}=t;if(!e||0===e.length)return i.popupDetector,null;e.sort((t,e)=>G.getElementDepth(e)-G.getElementDepth(t)),G.getElementDepth(e[0]),i.popupDetector;const s=e.map(t=>this.identifyPopupFromMask(t)).filter(t=>null!==t);if(0===s.length)return i.popupDetector,null;s.length,i.popupDetector;const a=this.filterNestedPopups(s),r=this.filterByPrediction(a),l=q.findTopMostPopup(r);return l?(l.root_node.className,l.popup_type,i.popupDetector,this.updateStickyHeights(l,{potentialStickyTop:o,potentialStickyBottom:n}),l):(i.popupDetector,null)}static identifyPopupFromMask(t){t.className,i.popupDetector;const e=this.determinePopupStructure(t);if(!e)return i.popupDetector,null;const{rootNode:o,contentNode:n,popupType:s}=e;return o.className,i.popupDetector,{info:this.createPopupInfo(o,t,n,s),node:o}}static determinePopupStructure(t){const[e,o]=q.findBestSiblingContent(t);if(e&&o){const n=t.parentNode;if(!(n&&n instanceof Element))return null;const i=getComputedStyle(n);return!("none"===i.display||"hidden"===i.visibility||0===parseFloat(i.opacity))?{contentNode:e,rootNode:o,popupType:M.B}:null}return this.findDescendantBasedPopup(t)}static findDescendantBasedPopup(t){const e=q.findBestDescendantContent(t);if(!e||!G.visualFilter(t))return i.popupDetector,null;const o=window.getComputedStyle(t).position;if(i.popupDetector,"fixed"===o||"absolute"===o)return i.popupDetector,{contentNode:e,rootNode:t,popupType:M.C};{const o=this.findPositionedAncestor(t)||t.parentElement;if(o)return o.className,i.popupDetector,{contentNode:e,rootNode:o,popupType:M.A}}return null}static findPositionedAncestor(t){let e=t.parentElement;for(;e&&e!==document.body;){const t=window.getComputedStyle(e).position;if("fixed"===t||"absolute"===t)return e;e=e.parentElement}return null}static filterNestedPopups(t){t.length,i.popupDetector;const e=new Set;for(const n of t)for(const o of t){if(n===o)continue;let t=!1;if(n.node!==o.node)t=n.node.contains(o.node);else{const e=n.info.mask_node,i=o.info.mask_node;t=e!==i&&e.contains(i)}if(t){e.add(n.info),n.node.className,i.popupDetector;break}}const o=t.map(t=>t.info).filter(t=>!e.has(t));return o.length,i.popupDetector,o}static filterByPrediction(t){t.length,i.popupDetector;const e=t.filter(t=>{if(t.has_mask&&t.mask_area_ratio>95&&("fixed"===t.mask_position||"absolute"===t.mask_position))return t.root_node.className,i.popupDetector,!0;const e=Y.predictIsPopup(t);return e.prediction,t.root_node.className,i.popupDetector,e.prediction});return e.length,i.popupDetector,e}static updateStickyHeights(t,e){const{potentialStickyTop:o,potentialStickyBottom:n}=e;o&&L.compareZIndex(t.mask_node,o)<=0&&!t.root_node.contains(o)&&(t.stickyTop_height=parseInt(getComputedStyle(o).height,10)||0),n&&L.compareZIndex(t.mask_node,n)<=0&&!t.root_node.contains(n)&&(t.stickyBottom_height=parseInt(getComputedStyle(n).height,10)||0)}static createPopupInfo(t,e,o,n){const i=window.getComputedStyle(t),s=window.getComputedStyle(e);return{root_node:t,mask_node:e,content_node:o,popup_type:n,root_position:i.position,root_zindex:G.zIndexToNumber(i.zIndex),has_mask:!0,root_screen_area_ratio:G.getScreenAreaRatio(t),root_is_visiable:G.isElementVisibleInViewPort(t),has_close_button:G.hasCloseButton(o||t),mask_area_ratio:G.getScreenAreaRatio(e),mask_position:s.position,mask_zindex:G.zIndexToNumber(s.zIndex),stickyTop_height:0,stickyBottom_height:0}}static isPreviousElementSibling(t,e){if(!t||!e||t.parentNode!==e.parentNode)return!1;let o=t.previousElementSibling;for(;o;){if(o===e)return!0;o=o.previousElementSibling}return!1}static isMaskNodeActive(t){if(!t)return!1;if(!t.isConnected)return i.popupDetector,!1;try{const e=window.getComputedStyle(t);return this.isElementQualified(t,e)&&!!this.isPotentialMask(t,e)||(t.className,i.popupDetector,!1)}catch(e){return t.className,i.popupDetector,!1}}}q.findBestDescendantContent=t=>{t.className,i.popupDetector;let e=null,o=0;const n=Array.from(t.querySelectorAll("*"));n.length,i.popupDetector;for(const i of n){if(!1===G.visualFilter(i))continue;const t=G.getScreenAreaRatio(i);t>o&&(o=t,e=i)}const s=o>=r.getInstance().getMinContentAreaRatioThreshold();return o.toFixed(2),i.popupDetector,s?e:null};class Z{static getActivePopupWindowInfo(){return Z.activePopupWindow.popupInfo}static getActivePopupWindowComponent(){return Z.activePopupWindow.popupComponent}static setActivePopupWindow(t,e){Z.activePopupWindow={popupInfo:t,popupComponent:e}}static clearActivePopupWindow(){Z.activePopupWindow={popupInfo:null,popupComponent:null}}static intelligentLayout(t){var e;Z.TAG;const o=Z.getActivePopupWindowInfo(),n=null!=o?o:q.findPopups(t);if(null===(e=null==n?void 0:n.root_node)||void 0===e||e.className,Z.TAG,null!=n)Z.calculateForPopWin(n);else{let t={resultCode:-2,errorMsg:"no popup found",duration:0,report:"no popup found"};window.layoutConstraintResult=t}Z.TAG}static removePopwinCache(t){const e=Z.getActivePopupWindowInfo();return!(!e||!e.root_node)&&(!!t.contains(e.root_node)&&(e.root_node,Z.TAG,$.clearState(e.root_node),Z.clearActivePopupWindow(),!0))}static calculateForPopWin(t){var e;if(null===(e=null==t?void 0:t.root_node)||void 0===e||e.className,Z.TAG,!$.canStartLayout(t.root_node))return void $.printState(t.root_node,"跳过布局 - 弹窗正在处理中");const o=Z.getActivePopupWindowInfo();let n=Z.getActivePopupWindowComponent();if(o&&o===t||(n=new V(t),Z.setActivePopupWindow(t,n)),n&&n.isDirty())try{n.intelligenceLayout()}catch(i){$.setState(t.root_node,k.FAILED,`布局失败: ${i}`),s.e(`布局失败: ${i}`,Z.TAG)}window.popupInfo=t}static markDirty(t){if(!t||G.shouldSkip(t))return;const e=Z.getActivePopupWindowInfo(),o=Z.getActivePopupWindowComponent();e&&o&&!o.isDirty()&&e.root_node&&e.root_node.contains(t)&&o.setDirty(!0)}static resetPopWindows(t){var e;Z.TAG;const o=Z.getActivePopupWindowInfo(),n=Z.getActivePopupWindowComponent();o&&n?(null===(e=o.root_node)||void 0===e||e.className,Z.TAG,n.cancelPendingValidation(),n.restoreStyles(),$.resetState(o.root_node,t),n.setDirty(!0),Z.clearActivePopupWindow(),Z.TAG):Z.clearActivePopupWindow()}static reInit(){Z.resetPopWindows("智能布局初始化")}}Z.TAG=i.intelligentLayout,Z.activePopupWindow={popupInfo:null,popupComponent:null};class X{static reInit(){X.TAG,X.modifyObserver&&(X.TAG,X.modifyObserver.disconnect()),document.body.id,X.TAG,X.TAG,X.modifyObserver=new MutationObserver(X.onElementModify),X.modifyObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),X.addAnimationListeners(),X.TAG}static cancelAllAnimationTimeouts(){const t=X.activeAnimationTimeouts.size;if(t>0){X.TAG;for(const[t,e]of X.activeAnimationTimeouts.entries())clearTimeout(t),e.tagName,e.className,X.TAG;X.activeAnimationTimeouts.clear(),X.TAG}}static addAnimationListeners(){X.animationListenerAdded||(X.TAG,X.animationStartHandler=t=>{X.handleAnimationEvent(t,"animation")},X.transitionStartHandler=t=>{X.handleAnimationEvent(t,"transition")},document.body.addEventListener("animationstart",X.animationStartHandler,!0),document.body.addEventListener("transitionstart",X.transitionStartHandler,!0),X.animationListenerAdded=!0),X.TAG}static handleAnimationEvent(t,e){const o=t.target;"animation"===e&&t instanceof AnimationEvent?(o.tagName,o.className,t.animationName,X.TAG):"transition"===e&&t instanceof TransitionEvent&&(o.tagName,o.className,t.propertyName,X.TAG);const n=X.findPopupRoot(o);X.updatePopupStateOnAnimationStart(n,e);const i=X.getDurationFromElement(o);X.createAnimationTimeout(o,n,i,e)}static updatePopupStateOnAnimationStart(t,e){if(!t)return;const o=$.getState(t);if(o===k.IDLE){const o="animation"===e?"检测到动画开始":"检测到过渡开始";$.setState(t,k.WAITING_ANIMATION,o)}else k[o],X.TAG}static createAnimationTimeout(t,e,o,n){if(o<=0)return;X.TAG;const i=setTimeout(()=>{X.activeAnimationTimeouts.delete(i);if(X.TAG,e&&$.getState(e)===k.WAITING_ANIMATION){const t="animation"===n?"动画完成":"过渡完成";$.setState(e,k.IDLE,t)}tt.postTask()},o);X.activeAnimationTimeouts.set(i,t)}static findPopupRoot(t){const e=Z.getActivePopupWindowInfo();return(null==e?void 0:e.root_node)&&e.root_node.contains(t)?e.root_node:null}static disconnect(){var t;X.TAG;const e=X.pendingRecords.length;e>0&&s.w(`清理 ${e} 个待处理的变更记录`,X.TAG),null===(t=X.modifyObserver)||void 0===t||t.disconnect(),X.modifyObserver=null,X.pendingRecords=[],X.scheduledWork=!1,X.cancelAllAnimationTimeouts(),X.animationListenerAdded&&(X.TAG,X.animationStartHandler&&(document.body.removeEventListener("animationstart",X.animationStartHandler,!0),X.animationStartHandler=null),X.transitionStartHandler&&(document.body.removeEventListener("transitionstart",X.transitionStartHandler,!0),X.transitionStartHandler=null),X.animationListenerAdded=!1,X.TAG),X.TAG}static handleRemove(t){if(0===t.length)return!1;t.length,X.TAG;let e=!1;for(const o of t){for(let t=0;t<o.removedNodes.length;t++){let n=o.removedNodes[t];if(n.nodeType!==Node.ELEMENT_NODE)continue;0;const i=Z.removePopwinCache(n);i&&(n.tagName,n.className,X.TAG),e=e||i,D.resetEle(n,!0)}D.resetParent(o.target)}return X.TAG,e}static checkElementAddNeedPostTask(t){let e=!1,o=0,n=0;for(let i=0;i<t.addedNodes.length;i++){const s=t.addedNodes[i];s.nodeType===Node.ELEMENT_NODE&&(s.tagName,s.className,X.TAG,s.style.display!==u.none?(s.tagName,s.className,X.TAG,o++,e=!0):(s.tagName,s.className,X.TAG,n++))}return(o>0||n>0)&&X.TAG,e}static onElementModify(t){t.length,X.TAG,X.pendingRecords.push(...t),X.scheduledWork?(X.pendingRecords.length,X.TAG):(X.TAG,X.scheduledWork=!0,queueMicrotask(()=>{const t=X.pendingRecords;X.pendingRecords=[],X.scheduledWork=!1,t.length,X.TAG,X.processBatch(t)}))}static processBatch(t){if(0===t.length)return void X.TAG;if(!X.checkMaskNodeExistence())return void X.TAG;t.length,X.TAG;const e=[],o=[],n=[];for(let r=0;r<t.length;r++){const i=t[r];i.removedNodes.length>0&&e.push(i),i.addedNodes.length>0&&o.push(i),"attributes"===i.type&&n.push(i)}e.length,o.length,n.length,X.TAG;const i=X.handleRemove(e);X.TAG;let s=X.calculateAnimationDuration(o,n);if(s>0){X.TAG;const t=setTimeout(()=>{X.activeAnimationTimeouts.delete(t),X.TAG,tt.postTask()},s);X.activeAnimationTimeouts.set(t,document.body)}X.TAG;const a=X.handleAddedNodes(o);0===s&&(i||a)?(X.TAG,tt.postTask()):X.TAG,X.TAG}static handleAddedNodes(t){let e=!1;if(0===t.length)return X.TAG,!1;t.length,X.TAG;for(let o=0;o<t.length;o++){X.checkElementAddNeedPostTask(t[o])&&(e=!0,Z.markDirty(t[o].target))}return X.TAG,e}static calculateAnimationDuration(t,e){let o=0;if(0===t.length&&0===e.length)return X.TAG,o;t.length,e.length,X.TAG;const n=new Set;return o=X.getAnimationDurationInAttriChange(e,n,o),o=X.getAnimationDurationInAddNodes(t,n,o),o>0?(n.size,X.TAG):X.TAG,o}static processAddedNode(t,e,o){if(!(t instanceof HTMLElement)||e.has(t))return{newDuration:o,detected:!1};e.add(t);const n=X.getDurationFromElement(t);let i=!1;return n>0&&(t.tagName,t.className,X.TAG,i=!0),{newDuration:Math.max(n,o),detected:i}}static getAnimationDurationInAddNodes(t,e,o){let n=0;for(let i=0;i<t.length;i++){const s=t[i].addedNodes;for(let t=0;t<s.length;t++){const i=X.processAddedNode(s[t],e,o);o=i.newDuration,i.detected&&n++}}return n>0&&X.TAG,o}static getAnimationDurationInAttriChange(t,e,o){let n=0;for(let i=0;i<t.length;i++){const s=t[i].target;t[i].attributeName;if(s instanceof HTMLElement&&!e.has(s)){e.add(s);const t=X.getDurationFromElement(s);t>0&&(s.tagName,s.className,X.TAG,n++),t>o&&(o=t,Z.markDirty(s))}}return n>0&&X.TAG,o}static getDurationFromElement(t){const e=X.getAnimDurations(t),o=Math.max(e.animationDur,e.transitionDur);return o>0&&(e.animationDur,e.transitionDur,X.TAG),o}static cssTimeToMs(t){if(!t||"0s"===t||"0ms"===t)return 0;const e=t.split(",").map(t=>t.trim()).filter(t=>t.length>0),o=/^([\d.]+)(s|ms)$/;let n=0;for(const i of e){const t=i.trim().match(o);if(!t)return X.TAG,0;const[,e,s]=t,a="s"===s?1e3*parseFloat(e):parseFloat(e);n=Math.max(n,a)}return n}static getAnimDurations(t){const e=getComputedStyle(t),o=X.cssTimeToMs(e.animationDuration),n=X.cssTimeToMs(e.transitionDuration),i=o+n;return i>0&&(t.tagName,t.className,e.animationDuration,e.transitionDuration,X.TAG),{animationDur:o,transitionDur:n,total:i}}static checkMaskNodeExistence(){var t;const e=Z.getActivePopupWindowInfo();if(!e)return!0;if(!X.isMaskNodeValid(e)){const o=`检测到遮罩节点失效: ${(null===(t=null==e?void 0:e.mask_node)||void 0===t?void 0:t.className)||"unknown-mask"}`;return X.resetPopup(o),tt.postTask(),!1}return!0}static isMaskNodeValid(t){return!!t&&(t.root_node&&t.root_node.isConnected?!!q.isMaskNodeActive(t.mask_node):(X.TAG,!1))}static resetPopup(t){X.TAG;const e=Z.getActivePopupWindowInfo(),o=Z.getActivePopupWindowComponent();o instanceof V&&(o.cancelPendingValidation(),o.restoreStyles()),(null==e?void 0:e.root_node)&&$.resetState(e.root_node,t),Z.clearActivePopupWindow()}}X.TAG=i.modifyObserver,X.pendingRecords=[],X.scheduledWork=!1,X.animationListenerAdded=!1,X.animationStartHandler=null,X.transitionStartHandler=null,X.activeAnimationTimeouts=new Map;class J{static reInit(){J.TAG,J.TAG,J.contentReady=!1,J.disconnect(),J.TAG}static isContentReady(){if(J.TAG,J.contentReady)return J.TAG,!0;J.TAG;return J.checkPageContent()?(J.TAG,J.contentReady=!0,J.disconnect(),!0):(s.w("⚠️ 页面内容未就绪（骨架屏/白屏状态）",J.TAG),!1)}static startObserving(){if(J.observer)return void J.TAG;J.TAG,J.TAG;J.observer=new MutationObserver(()=>{J.TAG,J.checkPageContent()?(J.TAG,J.contentReady=!0,J.disconnect(),J.TAG,tt.postTask()):J.TAG}),document.body?(J.observer.observe(document.body,{childList:!0,subtree:!0}),J.TAG):s.e("document.body不存在，无法启动观察器",J.TAG)}static disconnect(){J.observer&&(J.TAG,J.observer.disconnect(),J.observer=null)}static checkPageContent(){J.TAG;const t=document.body;if(!t)return s.e("document.body不存在",J.TAG),!1;const e=performance.now();let o=J.checkMeaningfulNodeRecursive(t);(performance.now()-e).toFixed(2);const n=o>J.MIN_NODE_THRESHOLD;return J.MIN_NODE_THRESHOLD,J.TAG,n}static checkMeaningfulNodeRecursive(t,e=0){let o=0;if(t instanceof HTMLElement){const n=getComputedStyle(t);if("none"===n.display||"hidden"===n.visibility||"0"===n.opacity)return 0===e&&(t.tagName,t.className,J.TAG),o}if(["DIV","P","SPAN","A","IMG","BUTTON","INPUT","TEXTAREA","UL","LI","H1","H2","H3","H4","H5","H6","SECTION","ARTICLE","NAV","HEADER","FOOTER","MAIN"].includes(t.tagName)&&(o++,o>J.MIN_NODE_THRESHOLD))return J.TAG,o;if(t.children.length>0&&o<=J.MIN_NODE_THRESHOLD){const n=Math.min(t.children.length,J.MAX_CHECK_CHILDREN);t.children.length>n&&(t.tagName,t.children.length,J.TAG);for(let i=0;i<n&&(o+=J.checkMeaningfulNodeRecursive(t.children[i],e+1),!(o>J.MIN_NODE_THRESHOLD));i++);}return o}static reset(){J.TAG,J.contentReady=!1,J.disconnect()}}J.TAG="PageContentObserver",J.contentReady=!1,J.observer=null,J.MIN_NODE_THRESHOLD=9,J.MAX_CHECK_CHILDREN=50;class K{static bodyReady(t){i.framework,function e(){if(!document.body||innerWidth<=100){document.body&&innerWidth;return K.tryTimes,i.framework,K.tryTimes>=0?setTimeout(e,50):s.e("❌ Body就绪检测超时，已达最大尝试次数",i.framework),void K.tryTimes--}innerWidth,i.framework,K.hasBodyReady=!0,i.framework,t()}()}static viewportReady(t){let e;function o(){let o=document.querySelector('meta[name="viewport"]');if(!o)return i.framework,!1;o.getAttribute("content");return i.framework,e&&(i.framework,e.disconnect(),e=null),i.framework,t(),!0}i.framework,o()||(i.framework,e=new MutationObserver(()=>{i.framework,o()}),e.observe(document.head,{childList:!0}))}static checkDOMReady(t){if(!t)return i.framework,!1;t.children.length;return i.framework,!0}static waitForSystemReady(){i.framework,K.sysReady=K.checkDOMReady(document.body),!1===K.sysReady?(i.framework,setTimeout(K.waitForSystemReady,200)):(i.framework,ot.start_())}static headReady(t){if(i.framework,K.tryHead--,K.tryHead<0)return void s.e("❌ Head就绪检测超时，已达最大尝试次数",i.framework);if(!document.head)return K.tryHead,i.framework,void setTimeout(()=>{this.headReady(t)},10);document.head.querySelectorAll("link").length,document.head.querySelectorAll("style").length;i.framework,i.framework,t()}static configReady(t){i.framework,i.framework,t()}}K.tryTimes=1e3,K.hasBodyReady=!1,K.tryHead=100,K.sysReady=!1,K.elementCount=0;class Q{static init_(){Q.TAG,Q.init||(Q.init=!0,window.innerWidth,window.innerHeight,Q.TAG,Q.TAG,window.addEventListener(u.resize,Q.resizeCallback)),Q.TAG}static resizeCallback(){if(Q.TAG,window.innerWidth,window.innerHeight,Q.TAG,window.innerWidth,window.innerHeight,screen.width,screen.height,Q.TAG,ot.initFlag)return Q.TAG,void Q.onResize();s.w("系统未初始化，触发重启",Q.TAG),ot.restart()}static onResize(){Q.TAG,K.hasBodyReady?(Q.TAG,X.cancelAllAnimationTimeouts(),Q.TAG,Z.resetPopWindows("窗口尺寸变化"),Q.TAG,et.headReadyTask(),Q.TAG,tt.updateObserver(),s.checkState("after updateObserver"),Q.TAG,_.updateState(),Q.TAG,tt.postTask(),Q.TAG):s.w("document.body未就绪，跳过resize处理",Q.TAG)}static removeListener(){Q.TAG,Q.init?(Q.TAG,Q.init=!1,removeEventListener(u.resize,Q.resizeCallback),Q.TAG):Q.TAG}}Q.TAG=i.resizeObserver,Q.init=!1;class tt{static postTask(){tt.relayoutHandler.postTask(),i.observerHandler}static reInit(){i.observerHandler,i.observerHandler,X.reInit(),i.observerHandler,J.reInit(),i.observerHandler,Q.init_(),tt.relayoutHandler||(tt.TIMEOUT,i.observerHandler,tt.relayoutHandler=new v(tt.TIMEOUT,et.mainTask)),i.observerHandler,setTimeout(()=>{tt.postTask()},400),i.observerHandler}static updateObserver(){i.observerHandler,et.stopFlag&&(s.w("Framework已停止，移除尺寸监听器",i.observerHandler),Q.removeListener()),E.isWideScreen()?i.observerHandler:(s.w(`窄屏检测: ${screen.availWidth}×${screen.availHeight}，移除观察器`,i.observerHandler),tt.removeObserver())}static removeObserver(){i.observerHandler,i.observerHandler,X.disconnect(),i.observerHandler,J.disconnect(),i.observerHandler}static nextRoundAndPost(t){t.tagName,t.className,i.observerHandler,tt.nextRound(t),tt.postTask()}static nextRound(t){t.tagName,t.className,i.observerHandler,R.setValue(t,p,d.NEXT_ROUND),R.nextRoundCache.push(t),R.nextRoundCache.length,i.observerHandler}}tt.TIMEOUT=200;class et{static isAvailable(){return!et.stopFlag||(et.TAG,!1)}static taskinit(){et.TAG,et.startTime||(et.startTime=(new Date).getTime(),et.startTime,et.TAG);const t=E.isWideScreen(),e=et.isAvailable();if(et.TAG,!t||!e)return et.TAG,!1;if(!et.needRunTask())return et.TAG,tt.postTask(),!1;if(et.TAG,w.clearStyleCache(),!J.isContentReady()){et.TAG,J.startObserving();const t={resultCode:-1,errorMsg:"页面内容未就绪，等待内容加载",duration:0,report:"启动内容观察器，响应式等待"};return window.layoutConstraintResult=t,!1}return et.TAG,!0}static mainTask(){et.TAG;const t=performance.now();if(!et.taskinit())return void et.TAG;if(r.getInstance().checkRule()===e.outOfWhiteList)return s.w("检查不通过:Appid:"+r.getInstance().getAppID()+", Page:"+r.getInstance().getPage(),et.TAG),void ot.stop();if(r.getInstance().checkRule()===e.initial)return void et.TAG;et.TAG,Z.intelligentLayout(document.body),et.TAG,b.flushAllStyles(),w.clearStyleCache();(performance.now()-t).toFixed(2);et.TAG,et.TAG}static reInit(){et.TAG,E.isWideScreen()?(et.TAG,l.init(),w.clearAllCache(),et.TAG,et.TAG,_.reInit(),et.TAG,Z.reInit(),et.TAG,tt.reInit(),et.TAG,et.stopFlag=!1,et.startTime=0,et.TAG):et.TAG}static configReady(){et.TAG,K.headReady(et.headReadyTask)}static headReadyTask(){et.TAG,K.bodyReady(et.reInit)}static needRunTask(){return et.TAG,et.cssIsComplete()?(et.TAG,!0):(s.w("⚠️ CSS样式表尚未加载完成，暂不执行任务",et.TAG),!1)}static cssIsComplete(){var t;et.TAG;const e=document.head;let o=[];for(let i=0;i<e.children.length;i++){const n=e.children[i];if(n.localName===u.link){const e=n,i=e.getAttribute(u.rel),s=e.getAttribute(u.href);if(i!==u.stylesheet||""===s||!s)continue;(null===(t=e.href)||void 0===t?void 0:t.startsWith("http"))&&!e.sheet?(et.TAG,o.push(s)):0}}const n=0===o.length;return et.TAG,n||(o.join(", "),et.TAG),n}}et.TAG=i.framework,et.stopFlag=!1;class ot{static start(t){r.getInstance().fromJson(t)&&ot.start_()}static start_(){E.isWideScreen()&&(ot.initFlag||(K.configReady(et.configReady),ot.initFlag=!0))}static stop(){et.stopFlag=!0}static restart(){et.stopFlag=!1,ot.start_()}}return ot.initFlag=!1,n})());
//# sourceMappingURL=autolayout.min.js.map