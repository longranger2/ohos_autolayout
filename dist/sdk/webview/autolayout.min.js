!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoLayout=e():t.AutoLayout=e()}(self,()=>(()=>{var t={269(t){t.exports={debounce(t,e){let n;return function(...i){n&&clearTimeout(n),n=setTimeout(()=>{t.apply(this,i)},e)}},cleanText:t=>t.replaceAll("\n","").replaceAll("\t","").replaceAll("s","").replaceAll(" ",""),isIncreasingAlphabet(t,e){let n="",i=0;for(let o=0;o<t.length;o++)if(!(t[o]<"A"||t[o]>"Z")){if(t[o]<=n)return!1;t[o]>n&&(i++,n=t[o])}return i>=e},isAlphabetLetter:t=>t>="A"&&t<="Z"||t>="a"&&t<="z",log(...t){0}}},609(t,e,n){const i=n(877),o=n(269),s=n(785);t.exports=class{alphabetDom=null;adaptType=i.BUTTON_GROUP.TYPE;heightWidthMinRatio=i.BASE.HEIGHT_WIDTH_MIN_RATIO_DEFAULT;identificationMinSize=i.BASE.IDENTIFICATION_MIN_SIZE;buttonGroup=null;scrollAdaptOriginHeight="";likelyAnAlphabet(t){for(let e=0;e<=t.length-this.identificationMinSize;e++)if(o.isIncreasingAlphabet(t.substr(e,26),this.identificationMinSize))return!0;return!1}traverseElements(t){if(void 0===t.checkVisibility||!t.checkVisibility())return null;let e=!1,n=o.cleanText(t.textContent);if(n.length<this.identificationMinSize)return null;if(n.length<i.BASE.MAX_STRING_LENGTH_ON_CHECK_ALPHABET&&t.childNodes&&t.childNodes.length>=this.identificationMinSize&&(e=this.likelyAnAlphabet(n)),o.log("hasAlphabet",e),t.childNodes&&t.childNodes.length>0)for(let i of t.childNodes){if(i.textContent.length<this.identificationMinSize)continue;let t=this.traverseElements(i);if(null!==t)return t}if(null===t.getBoundingClientRect||void 0===t.getBoundingClientRect)return null;let s=t.getBoundingClientRect();return o.log("heightWidthMinRatio-width-height-hasAlphabet",this.heightWidthMinRatio,s.width,s.height,e,t),s.width>=.5*window.innerWidth||s.width*this.heightWidthMinRatio>s.height?null:e?t:null}scrollBoxAdapt(){const t=getComputedStyle(this.alphabetDom);if(!("scroll"===t.overflowY||"auto"===t.overflowY))return!1;const e=this.alphabetDom.getBoundingClientRect();if(e.bottom<=window.innerHeight)return!1;this.scrollAdaptOriginHeight=this.alphabetDom.style.height;const n=window.innerHeight-e.top;return this.alphabetDom.style.height=`${n}px`,!0}updateAlphabetButtonGroupVersion(){if(null!==this.alphabetDom&&void 0!==this.alphabetDom.getBoundingClientRect){let t=this.alphabetDom.getBoundingClientRect();t.width*this.heightWidthMinRatio>t.height&&(this.alphabetDom=null)}if(null!==this.alphabetDom&&this.alphabetDom.checkVisibility()||(this.alphabetDom=this.traverseElements(document.body)),o.log("Alphabet",this.alphabetDom),null===this.alphabetDom)return void(this.buttonGroup&&this.buttonGroup.hide());if(s.checkIfShowNavButtonGroup(this.alphabetDom)){if(this.scrollBoxAdapt())return;this.buttonGroup||(this.buttonGroup=new s),this.buttonGroup.show(this.alphabetDom)}else this.buttonGroup&&this.buttonGroup.hide()}update(){this.updateAlphabetButtonGroupVersion()}reset(){o.log("Alphabet reset"),this.buttonGroup&&this.buttonGroup.reset(),this.scrollAdaptOriginHeight&&(this.alphabetDom.style.height=this.scrollAdaptOriginHeight,this.scrollAdaptOriginHeight=""),this.alphabetDom=null,this.update()}observeAction(t,e){o.log("observeAction"),this.reset()}observeDocumentChange(){const t=document.body,e=o.debounce(this.observeAction.bind(this),200);new MutationObserver(e).observe(t,{childList:!0,subtree:!0})}observeResize(){window.addEventListener("resize",()=>{this.reset()})}run(){o.log("Alphabet run"),this.update(),this.observeResize(),this.observeDocumentChange()}setConfig(t){try{let{alphabetHeightWidthMinRatio:e,alphabetIdentificationMinSize:n}=JSON.parse(t);o.log("Config got:",t),!isNaN(e)&&e>0&&(this.heightWidthMinRatio=e<=i.BASE.HEIGHT_WIDTH_MIN_RATIO_CONFIG_MAX?e:i.BASE.HEIGHT_WIDTH_MIN_RATIO_CONFIG_MAX),!isNaN(n)&&n>0&&(this.identificationMinSize=n<=i.BASE.IDENTIFICATION_MIN_SIZE_CONFIG_MAX?n:i.BASE.IDENTIFICATION_MIN_SIZE_CONFIG_MAX),o.log(`Config applied: heightWidthMinRatio=${this.heightWidthMinRatio}`,`, identificationMinSize=${this.identificationMinSize}`)}catch(e){o.log("Not a valid json config, use default instead.",`Values: heightWidthMinRatio=${this.heightWidthMinRatio}`,`, identificationMinSize=${this.identificationMinSize}`)}}constructor(t){o.log("Alphabet start"),this.setConfig(t),"loading"===document.readyState?(o.log("document on loading"),document.addEventListener("DOMContentLoaded",()=>{this.run()})):(o.log("document loaded"),this.run())}}},650(t,e,n){const i=n(609),o=n(269),s=function(){let t;return function(e){t?(t.setConfig(e),t.reset(),o.log("Reset AlphabetAdapter")):(t=new i(e),o.log("New AlphabetAdapter"))}}();t.exports={start:s}},785(t,e,n){const i=n(877),o=n(269);t.exports=class{dom=null;upButton=null;downButton=null;alphabet=null;stepPassed=0;stepCount=0;firstPageTop=0;stepNumber=0;styleSheet={buttonBox:{display:i.BUTTON_GROUP.BOX_DISPLAY_TYPES.HIDE,width:0,height:0},buttonBoxInnerButton:{zIndex:99999,display:"block",textAlign:"center",verticalAlign:"middle",position:"fixed",right:`${i.BUTTON_GROUP.SIDE_DISTANCE.RIGHT_DEFAULT}px`,backgroundColor:"transparent",width:`${i.BUTTON_GROUP.BUTTON_SIZE.WIDTH}px`,height:`${i.BUTTON_GROUP.BUTTON_SIZE.HEIGHT}px`,border:"none",transition:"opacity 0.5s ease-in-out",boxSizing:"border-box",padding:`${i.BUTTON_GROUP.BUTTON_PADDING}px`,margin:0,opacity:i.BUTTON_GROUP.OPACITY_VALUES.HIDE},buttonBoxInnerContent:{display:"block",width:"100%",height:"100%",color:"#666666",backgroundColor:"#ffffff",borderRadius:"100%",fontSize:`${i.BUTTON_GROUP.BUTTON_CONTENT_SIZE}px`,lineHeight:`${i.BUTTON_GROUP.BUTTON_CONTENT_SIZE}px`,fontFamily:i.BUTTON_GROUP.HM_SYMBOL_FONT_FAMILY_NAME}};alphabetOriginalStyle={transform:"",transition:"",computedTransform:""};constructor(){const t=document.createElement("div"),e=document.createElement("div"),n=document.createElement("div"),o=document.createElement("span"),s=document.createElement("span");for(let i in this.styleSheet.buttonBox)Object.prototype.hasOwnProperty.call(this.styleSheet.buttonBox,i)&&(t.style[i]=this.styleSheet.buttonBox[i]);for(let i in this.styleSheet.buttonBoxInnerButton)Object.prototype.hasOwnProperty.call(this.styleSheet.buttonBoxInnerButton,i)&&(e.style[i]=this.styleSheet.buttonBoxInnerButton[i],n.style[i]=this.styleSheet.buttonBoxInnerButton[i]);for(let i in this.styleSheet.buttonBoxInnerContent)Object.prototype.hasOwnProperty.call(this.styleSheet.buttonBoxInnerContent,i)&&(o.style[i]=this.styleSheet.buttonBoxInnerContent[i],s.style[i]=this.styleSheet.buttonBoxInnerContent[i]);e.style.top=`${i.BUTTON_GROUP.SIDE_DISTANCE.TOP_DEFAULT}px`,n.style.bottom=`${i.BUTTON_GROUP.SIDE_DISTANCE.BOTTOM_DEFAULT}px`,o.innerText=i.BUTTON_GROUP.BUTTON_TEXT.UP,s.innerText=i.BUTTON_GROUP.BUTTON_TEXT.DOWN,e.addEventListener("click",()=>{this.handleButtonClick(i.BUTTON_GROUP.BUTTON_SWITCH_TYPES.UP)}),n.addEventListener("click",()=>{this.handleButtonClick(i.BUTTON_GROUP.BUTTON_SWITCH_TYPES.DOWN)}),e.appendChild(o),n.appendChild(s),t.appendChild(e),t.appendChild(n),document.body.appendChild(t),this.dom=t,this.upButton=e,this.downButton=n}static checkIfShowNavButtonGroup(t){if(!t)return!1;return Math.min(window.innerHeight-t.getBoundingClientRect().y,t.clientHeight)<t.scrollHeight-1}handleButtonClick(t){if(!this.alphabet)return;if(0===this.stepNumber&&t===i.BUTTON_GROUP.BUTTON_SWITCH_TYPES.UP)return;if(this.stepNumber===this.stepCount-1&&t===i.BUTTON_GROUP.BUTTON_SWITCH_TYPES.DOWN)return;const e=this.getStepLength();this.stepNumber+=t===i.BUTTON_GROUP.BUTTON_SWITCH_TYPES.DOWN?1:-1;let n=this.getAlphabetOriginalTranslateY(),o=!0,s=!0;if(0===this.stepNumber)o=!1;else if(this.stepNumber===this.stepCount-1){const t=this.alphabet.clientHeight===this.alphabet.scrollHeight?window.innerHeight-i.BUTTON_GROUP.LAST_PAGE_BOTTOM_DISTANCE:Math.min(window.innerHeight,this.alphabet.clientHeight);n-=this.alphabet.scrollHeight+this.firstPageTop-t,s=!1}else n-=e*this.stepNumber;this.alphabet.style.transform=this.generateTransformByTranslateY(n),this.showButtons(o,s)}transformOriginalTransformToArray(){const t=this.alphabetOriginalStyle.computedTransform;if(t.startsWith("matrix"))try{return t.match(/matrix(?<is3d>3d)?\((?<params>[^)]+)\)/)[2].split(", ")}catch(e){o.log("parse transform style failed")}return[]}getAlphabetOriginalTranslateY(){const t=this.transformOriginalTransformToArray();return 6===t.length?parseFloat(t[5]):16===t.length?parseFloat(t[13]):0}generateTransformByTranslateY(t){const e=this.transformOriginalTransformToArray();return 6===e.length?(e[5]=t,`matrix(${e.join(", ")})`):16===e.length?(e[13]=t,`matrix3d(${e.join(", ")})`):`translateY(${t}px)`}showButtons(t,e){t?this.upButton.style.display=i.BUTTON_GROUP.BUTTON_DISPLAY_TYPES.SHOW:this.upButton.style.opacity=i.BUTTON_GROUP.OPACITY_VALUES.HIDE,e?this.downButton.style.display=i.BUTTON_GROUP.BUTTON_DISPLAY_TYPES.SHOW:this.downButton.style.opacity=i.BUTTON_GROUP.OPACITY_VALUES.HIDE,setTimeout(()=>{if(this.alphabet){const t=this.alphabet.getBoundingClientRect(),e=.5*(t.width-i.BUTTON_GROUP.BUTTON_SIZE.WIDTH),n=window.innerWidth-t.right+e,o=n>0?n:i.BUTTON_GROUP.SIDE_DISTANCE.RIGHT_DEFAULT,s=t.top-i.BUTTON_GROUP.BUTTON_SIZE.HEIGHT-i.BUTTON_GROUP.SIDE_DISTANCE.TOP_PLUS,a=s>0?s:i.BUTTON_GROUP.SIDE_DISTANCE.TOP_DEFAULT;this.upButton.style.top=`${a}px`,this.upButton.style.right=`${o}px`,this.downButton.style.right=`${o}px`}t?this.upButton.style.opacity=i.BUTTON_GROUP.OPACITY_VALUES.SHOW:this.upButton.style.display=i.BUTTON_GROUP.BUTTON_DISPLAY_TYPES.HIDE,e?this.downButton.style.opacity=i.BUTTON_GROUP.OPACITY_VALUES.SHOW:this.downButton.style.display=i.BUTTON_GROUP.BUTTON_DISPLAY_TYPES.HIDE},i.BUTTON_GROUP.SLIDE_TRANSITION_MICRO_SECONDS)}getStepLength(){return Math.min(window.innerHeight,this.alphabet.clientHeight)}show(t){if(!t)return;this.alphabet=t;const e=getComputedStyle(t);this.alphabetOriginalStyle.transition=t.style.transition,this.alphabetOriginalStyle.transform=t.style.transform,this.alphabetOriginalStyle.computedTransform=e.transform,this.calculateSteps(),this.alphabet.style.transition=i.BUTTON_GROUP.ALPHABET_TRANSITION_STYLE,this.dom.style.display=i.BUTTON_GROUP.BOX_DISPLAY_TYPES.SHOW,this.showButtons(!1,!0)}hide(){this.dom.style.display=i.BUTTON_GROUP.BOX_DISPLAY_TYPES.HIDE}reset(){this.hide(),this.stepNumber=0,this.dom.style.right=`${i.BUTTON_GROUP.SIDE_DISTANCE.RIGHT_DEFAULT}px`,this.dom.style.bottom=`${i.BUTTON_GROUP.SIDE_DISTANCE.BOTTOM_DEFAULT}px`,this.alphabet&&(this.alphabet.style.transform=this.alphabetOriginalStyle.transform,this.alphabet.style.transition=this.alphabetOriginalStyle.transition),this.alphabet=null,this.alphabetOriginalStyle.transform="",this.alphabetOriginalStyle.transition="",this.alphabetOriginalStyle.computedTransform="",this.firstPageTop=0,this.stepCount=0,this.upButton.style.top=`${i.BUTTON_GROUP.SIDE_DISTANCE.TOP_DEFAULT}px`,this.downButton.style.bottom=`${i.BUTTON_GROUP.SIDE_DISTANCE.BOTTOM_DEFAULT}px`}calculateSteps(){let t=this.alphabet.scrollHeight;window.innerHeight-this.alphabet.getBoundingClientRect().y<this.alphabet.clientHeight&&(this.firstPageTop=this.alphabet.getBoundingClientRect().y,t+=this.firstPageTop),this.stepCount=Math.ceil(t/this.getStepLength())}}},877(t){t.exports={BASE:{MAX_STRING_LENGTH_ON_CHECK_ALPHABET:1500,HEIGHT_WIDTH_MIN_RATIO_DEFAULT:10,HEIGHT_WIDTH_MIN_RATIO_CONFIG_MAX:30,IDENTIFICATION_MIN_SIZE:18,IDENTIFICATION_MIN_SIZE_CONFIG_MAX:26},BUTTON_GROUP:{TYPE:"buttonGroup",SIDE_DISTANCE:{RIGHT_DEFAULT:15,RIGHT_PLUS:0,BOTTOM_DEFAULT:15,BOTTOM_PLUS:5,TOP_DEFAULT:15,TOP_PLUS:5},BUTTON_SIZE:{WIDTH:24,HEIGHT:24},BUTTON_CONTENT_SIZE:18,BUTTON_PADDING:3,BUTTON_TEXT:{UP:"󰃌",DOWN:"󰢝"},BUTTON_SWITCH_TYPES:{UP:"up",DOWN:"down"},OPACITY_VALUES:{SHOW:"1.0",HIDE:"0"},BUTTON_DISPLAY_TYPES:{SHOW:"block",HIDE:"none"},BOX_DISPLAY_TYPES:{SHOW:"block",HIDE:"none"},LAST_PAGE_BOTTOM_DISTANCE:20,ALPHABET_TRANSITION_STYLE:"transform 0.5s ease",SLIDE_TRANSITION_MICRO_SECONDS:500,HM_SYMBOL_FONT_FAMILY_NAME:"HM Symbol"}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i),n.d(i,{Main:()=>st});class t{}var e,o,s;t.framework="Framework",t.intelligentLayout="IntelligentLayout",t.observerHandler="ObserverHandler",t.resizeObserver="ResizeObserver",t.modifyObserver="ModifyObserver",t.pageContentObserver="PageContentObserver",t.throttle="Throttle",t.popupDecisionTree="PopupDecisionTree",t.popupRecog="PopupRecog",t.popupDetector="PopupDetector",t.popupRelayout="PopupRelayout",t.popupStateManager="PopupStateManager",t.layoutConstraintDetector="LayoutConstraintDetector",t.layoutUtils="LayoutUtils",t.util="Utils",t.ccmConfig="CCMConfig",t.styleSetter="StyleSetter",t.styleGetter="StyleGetter",t.styleCleaner="StyleCleaner",t.cssSheetManage="CSSSheetManage",t.domReader="DomReader",t.originStyleCache="OriginStyleCache",t.store="Store",t.record="Record",t.diffRecorder="DiffRecorder",t.zoomFont="ZoomFont",t.performance="Performance",t.visual="Visual",t.state="State",t.cache="Cache",t.debug="Debug",t.component="Component",t.node="Node",function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR"}(e||(e={}));class a{static formatTimestamp(){const t=new Date;return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}.${String(t.getMilliseconds()).padStart(3,"0")}`}static setLevel(t){a.currentLevel=t}static getLevel(){return a.currentLevel}static d(t,e){0}static debug(t,e,n){0}static i(t,e,n){0}static info(t,e){0}static w(t,n){if(a.currentLevel<=e.WARN){const e=a.formatTimestamp(),i=n?`[${n}]`:"[WARN]";console.warn(`[${e}] ${i} ${t}`)}}static warn(t,n,i){if(a.currentLevel<=e.WARN){const e=a.formatTimestamp(),o=i?`[${i}]`:"[WARN]",s=t?`${t.tagName}.${t.className||"no-class"}`:"null";console.warn(`[${e}] ${o} [${s}] ${n}`)}}static e(t,n,i){if(a.currentLevel<=e.ERROR){const e=a.formatTimestamp(),o=n?`[${n}]`:"[ERROR]";console.error(`[${e}] ${o} ${t}`,i||"")}}static error(t,n,i,o){if(a.currentLevel<=e.ERROR){const e=a.formatTimestamp(),s=i?`[${i}]`:"[ERROR]",r=t?`${t.tagName}.${t.className||"no-class"}`:"null";console.error(`[${e}] ${s} [${r}] ${n}`,o||"")}}static taskTimes(){0}static showValue(t,e,n){0}static deleteValue(t,e){0}static clearTag(t,e){0}static logCaller(t){0}static checkState(t){0}}a.currentLevel=e.WARN,function(t){t[t.popupScale=1]="popupScale",t[t.alphabetNavigator=2]="alphabetNavigator"}(o||(o={})),function(t){t[t.skipCheck=0]="skipCheck",t[t.initial=1]="initial",t[t.inWhiteList=2]="inWhiteList",t[t.outOfWhiteList=3]="outOfWhiteList"}(s||(s={}));const r={minMaskAreaRatioThreshold:1,opacityFilter:[0,100],minContentAreaRatioThreshold:15,scrollNodePattern:["srcoll","List","swiper"],closeButtonPattern:["close","guanbi","dele"],buttonPattern:["button","btn"],scaleAnimationDuration:100,minScaleFactor:55,breakpoints:[{widthRange:{min:320,max:500},aspectRatioRange:{min:.61,max:1.63}},{widthRange:{min:580,max:950},aspectRatioRange:{min:.7,max:2}},{widthRange:{min:1e3,max:1150},aspectRatioRange:{min:1.3,max:1.45}}],appRuleInfos:[{id:"000",pg:["home"]}],needCheckIdAndPage:!1,strategy:3,minSARTofStickyComponent:5,maxSARTofStickyComponent:45};class l{constructor(t){this.strategy=o.popupScale,this.isAlphabetNavigatorFixExecuted=!1,this._minMaskAreaRatioThreshold=t.minMaskAreaRatioThreshold,this._opacityFilter=t.opacityFilter,this._minContentAreaRatioThreshold=t.minContentAreaRatioThreshold,this._scrollNodePattern=t.scrollNodePattern,this._closeButtonPattern=t.closeButtonPattern,this._buttonPattern=t.buttonPattern,this._scaleAnimationDuration=t.scaleAnimationDuration,this._minScaleFactor=t.minScaleFactor,this._alphabetIdentificationMinSize=t.alphabetIdentificationMinSize,this._alphabetHeightWidthMinRatio=t.alphabetHeightWidthMinRatio,this._breakpoints=t.breakpoints,this._appRuleInfos=t.appRuleInfos,this._needCheckIdAndPage=t.needCheckIdAndPage,t.needCheckIdAndPage?this.checkRuleStateResult=s.initial:this.checkRuleStateResult=s.skipCheck,this.appId="",this.page="",this._minSARTofStickyComponent=t.minSARTofStickyComponent,this._maxSARTofStickyComponent=t.maxSARTofStickyComponent}getMinMaskAreaRatioThreshold(){return this._minMaskAreaRatioThreshold}getMinSARTofStickyComponent(){return this._minSARTofStickyComponent}getMaxSARTofStickyComponent(){return this._maxSARTofStickyComponent}getOpacityFilter(){return this._opacityFilter}getMinContentAreaRatioThreshold(){return this._minContentAreaRatioThreshold}setMinContentAreaRatioThreshold(t){this._minContentAreaRatioThreshold=t}getscrollNodePattern(){return this._scrollNodePattern}getcloseButtonPattern(){return this._closeButtonPattern}getButtonPattern(){return this._buttonPattern}getScaleAnimationDuration(){return this._scaleAnimationDuration}getMinScaleFactor(){return this._minScaleFactor}getAppID(){return this.appId}getPage(){return this.page}getAutoLayoutStrategyType(){return this.strategy}getAlphabetIdentificationMinSize(){return this._alphabetIdentificationMinSize}getAlphabetHeightWidthMinRatio(){return this._alphabetHeightWidthMinRatio}setAlphabetNavigatorFixExecuted(t){this.isAlphabetNavigatorFixExecuted=t}findAspectRatioRange(t){for(const e of this._breakpoints)if(t>=e.widthRange.min&&t<=e.widthRange.max)return e.aspectRatioRange}update(t){this._minMaskAreaRatioThreshold=t.minMaskAreaRatioThreshold,this._opacityFilter=t.opacityFilter,this._minContentAreaRatioThreshold=t.minContentAreaRatioThreshold,this._scaleAnimationDuration=t.scaleAnimationDuration,this._minScaleFactor=t.minScaleFactor,this._alphabetIdentificationMinSize=t.alphabetIdentificationMinSize,this._alphabetHeightWidthMinRatio=t.alphabetHeightWidthMinRatio,this._appRuleInfos="string"==typeof t.appRuleInfos?JSON.parse(t.appRuleInfos):t.appRuleInfos,this._needCheckIdAndPage=t.needCheckIdAndPage}fromJson(e){try{const t=JSON.parse(e);this.update(t)}catch(n){return a.e("Failed to parse ProductConfig from JSON",t.ccmConfig,n),!1}return!0}static getInstance(){return l.instance||(l.instance=new l(r)),l.instance}checkRule(){if(this.checkRuleStateResult===s.skipCheck&&t.ccmConfig,this.checkRuleStateResult!==s.initial)return this.checkRuleStateResult;const e=String("function"==typeof window._getAppId_?window._getAppId_():""),n=String("function"==typeof window._getPage_?window._getPage_():"");if(!e||""===e||!n||""===n)return t.ccmConfig,s.initial;this.appId=e,this.page=n;for(const i of this._appRuleInfos){const o="*"===i.id||i.id===e,a=i.pg.includes("*")||i.pg.includes(n);if(o&&a)return this.checkRuleStateResult=s.inWhiteList,t.ccmConfig,i.strategy&&(this.strategy=i.strategy,this.strategy,t.ccmConfig),i.alphabetIdentificationMinSize&&(this._alphabetIdentificationMinSize=i.alphabetIdentificationMinSize),i.alphabetHeightWidthMinRatio&&(this._alphabetHeightWidthMinRatio=i.alphabetHeightWidthMinRatio),this.checkRuleStateResult}return this.checkRuleStateResult=s.outOfWhiteList,this.checkRuleStateResult}isPopupScaleEnable(t){return(t&o.popupScale)>0}isAlphabetNavigatorEnable(t){return(t&o.alphabetNavigator)>0&&!this.isAlphabetNavigatorFixExecuted}}class c{static init(){this.offsetHeightCache||(this.offsetHeightCache=this.createSpecStyleCache(t=>t.offsetHeight),this.offsetWidthCache=this.createSpecStyleCache(t=>t.offsetWidth),this.offsetTopCache=this.createSpecStyleCache(t=>t.offsetTop),this.offsetLeftCache=this.createSpecStyleCache(t=>t.offsetLeft),this.scrollHeightCache=this.createSpecStyleCache(t=>t.scrollHeight),this.scrollWidthCache=this.createSpecStyleCache(t=>t.scrollWidth),this.childCountCache=this.createSpecStyleCache(t=>t.childElementCount),this.getRectCache=this.createSpecStyleCache(t=>t.getBoundingClientRect()),this.getComputedStyleCache=this.createSpecStyleCache(getComputedStyle),this.localNameCache=this.createSpecStyleCache(t=>t.localName))}static createSpecStyleCache(t){const e=new Map;return this.clearMap.set(e,()=>e.clear()),function(n,...i){if(!n)return void a.e("input null to CacheStyleGetter");const o=e.get(n);if(o)return o;const s=t.call(null,n,...i);return e.set(n,s),s}}}c.clearMap=new Map,c.specStyleCache=new Map;class u{static visibleOffsetH(t){return 0}static offsetW(t){return c.offsetWidthCache(t)||0}static offsetH(t){return c.offsetHeightCache(t)||0}static computedStyleDec(t){return c.getComputedStyleCache(t)}static computedStyle(t,e){let n,i=c.specStyleCache.get(t);if(i){if(n=i.get(e),n)return n}else i=new Map;return u.computedStyleDec&&c.getComputedStyleCache?(n=u.computedStyleDec(t).getPropertyValue(e),i.set(e,n),c.specStyleCache.set(t,i),n):n}static localName(t){return c.localNameCache?c.localNameCache(t):""}static clearSpecCache(){for(const t of c.clearMap.values())t.call(null);c.specStyleCache.clear()}}class d{}d.minMargin=5,d.ATTR_NUM=5,d.display="display",d.width="width",d.minHeight="min-height",d.transform="transform",d.transition="transition",d.transform_origin="transform-origin",d.translate="translate",d.perspective="perspective",d.flex="flex",d.position="position",d.top="top",d.left="left",d.bottom="bottom",d.float="float",d.vertical_align="vertical-align",d.justify_content="justify-content",d.margin_top="margin-top",d.margin_left="margin-left",d.margin_right="margin-right",d.flex_direction="flex-direction",d.align_items="align-items",d.margin_bottom="margin-bottom",d.padding_top="padding-top",d.padding_bottom="padding-bottom",d.padding_right="padding-right",d.padding_left="padding-left",d.right="right",d.overflow="overflow",d.overflow_x="overflow-x",d.overflow_y="overflow-y",d.zoom="zoom",d.z_index="z-index",d.line_height="line-height",d.computedWidth="computedWidth",d.box_sizing="box-sizing",d.background_size="background-size",d.border_bottom_width="border-bottom-width",d.border_top_width="border-top-width",d.border_left_width="border-left-width",d.border_right_width="border-right-width",d.border_left="border-left",d.border_right="border-right",d.border_top="border-top",d.white_space="white-space",d.text_align="text-align",d.max_height="max-height",d.flex_grow="flex-grow",d.row="row",d.flex_shrink="flex-shrink",d.filter="filter",d.flex_wrap="flex-wrap",d.content="content",d.name_="name",d.meta="meta",d.viewport="viewport",d.resize="resize",d.load="load",d.childList="childList",d.border_radius="border-radius",d.border="border",d.border_width="border-width",d.max_width="max-width",d.transition_duration="transition-duration",d.visibility="visibility",d.opacity="opacity",d.rel="rel",d.href="href",d._webkit_box_flex="-webkit-box-flex",d.scale="scale",d.flex_basis="flex-basis",d.box_shadow="box-shadow",d.pointer_events="pointer-events",d.px="px",d.style="style",d.media_="media",d.WIDE_SCREEN_MEDIA_EN_DEFAULT="only screen and (max-height : 500px), screen and (min-width : 500px)",d.WIDE_SCREEN_MEDIA_DIS="only screen and (max-height : -10px)",d.none="none",d.stylesheet="stylesheet",d.link="link",d.delete="delete",d.fixed="fixed",d.sticky="sticky",d.absolute="absolute",d.static="static",d.relative="relative",d.wrap="wrap",d.column="column",d.space_between="space-between",d.space_evenly="space-evenly",d.space_around="space-around",d.true="true",d.false="false",d.grid_template_columns="grid-template-columns",d.gap="gap",d.grid_auto_flow="grid-auto-flow",d.dense="dense",d.start="start",d.fit_content="fit-content",d.break_inside="break-inside",d.avoid="avoid",d.grid="grid",d.border_box="border-box",d.tag_truncate="truncate-tag",d.input="input",d.textarea="textarea",d.textTypes=new Set(["email","number","password","search","tel","text","url"]),d.discrepancy=1,d.maxCloseButtonSizeRatio=.15,d.bottomCloseButtonRatio=.6,d.flexDelHeightThreshold=2,d.truncateThreshold=2,d.centerCloseButtonThreshold=5,d.RESULT_CODE_PASS=0,d.RESULT_CODE_GAPS=100,d.RESULT_CODE_OVERFLOW=50,d.RESULT_CODE_OFFSET=10,d.RESULT_CODE_CLOSE_BTN_OVERLAP=2,d.RESULT_CODE_INTERACTIVE=1,d.RESULT_CODE_PAGE_CONTENT_NOT_READY=-1,d.RESULT_CODE_NO_POPUP=-2,d.RESULT_CODE_NOT_TRUNCATED=-3,d.RESULT_CODE_SKIP_SCALE=-4,d.maxMaskAspectRatio=3,d.paddingTop="padding-top",d.paddingBottom="padding-bottom",d.transitionend="transitionend",d.script="script",d.noscript="noscript",d.back="back",d.swiperBox="swiper-box",d.num0px="0px",d.hidden="hidden",d.num100percent="100%",d.important="!important",d.hw_="hw_",d.a_="a",d.hwA=d.hw_+d.a_;const p={DISABLE:"disable",VERTICAL_GRID:"vertical_grid",ASIDE_BAR:"asideBar",BACK_IMG:"backImg",ONE_LINE:"oneLine",ZOOM_PARENT:"zoomParent",IS_IMG:"isImg",HAS_TEXT_CHILD:"hasTextChild",WATERFALL:"waterfall",SWIPER:"swiper",SCROLL_LIST:"scrollList",COMMENT:"comment",HEADER:"header",ACROSS_COLUMN:"across_column",NEXT_ROUND:"next_round",BOTTOM:"bottom",EMPTY:"empty"},h="hwLayout",m="thirdLayout",g="diffEle",f="insertRule",T="insertSwiper",y="multi_items",S="ele_num",A="origin_width",C="height0",N="force_css",_="origin_height";class E{static setValue(e,n,i){if(!e)return;t.store;let o=this.valueMap.get(n);o||(o=new Map,this.valueMap.set(n,o)),o.set(e,i),a.showValue(e,n,i),E.saveOriginHeight(e,n)}static removeValue(e,n){if(!e)return;t.store;const i=this.valueMap.get(n);i&&(i.delete(e),a.deleteValue(e,n))}static getValue(t,e){if(!t)return null;const n=this.valueMap.get(e);if(!n)return null;const i=n.get(t);return i||null}static clearTag(t){a.clearTag(this.valueMap,t),this.valueMap.delete(t)}static clearAllTag(t,e){const n=[A,S,C,y,C,p.HAS_TEXT_CHILD,p.IS_IMG,g],i=(new Map).set(m,p.DISABLE);for(let[o,s]of this.valueMap){if(!e&&n.includes(o))continue;const r=i.get(o);!e&&r&&E.getValue(t,o)===r||(s.delete(t),a.deleteValue(t,o))}}static removeNextRoundTags(){E.nextRoundCache.forEach(t=>{E.removeValue(t,h)}),E.nextRoundCache=[]}static saveOriginHeight(t,e){e===h&&E.getValue(t,_)&&E.setValue(t,_,u.offsetH(t).toString())}}E.valueMap=new Map,E.nextRoundCache=[];class I{static getHTMLElement(t){return t instanceof HTMLElement?t:t.parentElement}static isWideScreen(){const t=screen.availHeight,e=screen.availWidth;if(0===t)return!1;const n=l.getInstance().findAspectRatioRange(e);if(void 0===n)return!1;const i=e/t;return i>n.min&&i<n.max}static setParentTag(t,e=h,n=p.ZOOM_PARENT){t&&(E.getValue(t,e)||(E.setValue(t,e,n),this.setParentTag(t.parentElement,e,n)))}static hadRelayOut(t){return null!=E.getValue(t,h)}static hadZoomRelayout(t){return![null,p.ZOOM_PARENT].includes(E.getValue(t,h))}static hadConfig(t){return null!=E.getValue(t,m)}static timesBetween(t,e,n){return t/e<n&&e/t<n}static getInterval(t,e){return t[0]>t[1]||e[0]>e[1]?null:t[1]<e[0]||t[0]>e[1]?0:Math.min(t[1],e[1])-Math.max(t[0],e[0])}static MapAContainsMapB(t,e){for(const[n,i]of e.entries()){let e=t.get(n);if(e!==i&&(i!==d.delete||e))return!1}return!0}static isZoomParent(t){return E.getValue(t,h)===p.ZOOM_PARENT}static hadZoomLayout(t){const e=E.getValue(t,h);return null!=e&&e!==p.ZOOM_PARENT}static hadStretchedWidth(t){const e=E.getValue(t,h);return[p.ACROSS_COLUMN,p.ONE_LINE,p.EMPTY,p.COMMENT,p.SCROLL_LIST].includes(e)}static hadZoomConfig(t){const e=E.getValue(t,m);return null!=e&&e!==p.ZOOM_PARENT}static isInvisibleElement(t){if(u.computedStyle(t,d.display)===d.none)return!0;if(u.computedStyle(t,d.visibility)===d.hidden)return!0;return"0"===u.computedStyle(t,d.opacity)}static getAvailWidth(){return screen.availWidth}static ignoreEle(t){const e=[];if(!e.length)return!1;if(!t.className)return!1;for(let n=0;n<t.classList.length;n++)if(e.includes(t.classList[n]))return!0;return!1}static ignoreLocalName(t,e=[]){const n=[d.script,d.style,d.swiperBox,d.noscript].concat(e),i=u.localName(t);return n.includes(i)||i.startsWith(d.back)}static callRelayoutHappen(){I.hadCalledRelayoutHappen||(I.hadCalledRelayoutHappen=!0)}static isEmptyText(t){return!t||!/[^\t\n\r ]/.test(t)}static paddingFillHeight(t){const e=parseFloat(u.computedStyle(t,d.paddingTop)),n=parseFloat(u.computedStyle(t,d.paddingBottom));if(0===e&&0===n)return!1;if(e&&n)return!1;const i=Math.round(e||n);return u.offsetH(t)===i}static restoreLeftMarginSpace(t,e){}static getNumBetween(t,e,n){const i=Math.max(e,n),o=Math.min(e,n);return Math.min(Math.max(t,o),i)}static isImgCompleted(t){return!0}static hasSameSize(t,e){return!1}}I.TAG=t.util,I.hadCalledRelayoutHappen=!1;class b{static clearAllCache(){E.removeNextRoundTags(),this.bodyCache=void 0,this.documentCache=void 0}static clearStyleCache(){u.clearSpecCache()}static body_(){return this.bodyCache||(this.bodyCache=document.body),this.bodyCache}static documentElement_(){return this.documentCache||(this.documentCache=document.documentElement),this.documentCache}}b.bodyCache=void 0,b.documentCache=void 0;class R{}R.INDEX_IDX=0,R.STYLE_MAP_IDX=1,R.styleCache=new Map,R.styleFlushed=new Map,R.uniqueVirIdx=0,R.indexMappingList=[],R.styleDiv=null;class w{static reInit(){w.initFlag||(R.styleDiv=this.creatStyleDiv(),w.initFlag=!0)}static creatStyleDiv(){const t=document.createElement(d.style),e=document.head.appendChild(t);return w.styleNodeList.push(e),w.updateState(),e}static enableMedia(){if(!this.styleNodeList.length)return;let e;e=window.matchMedia(d.WIDE_SCREEN_MEDIA_EN_DEFAULT).matches?d.WIDE_SCREEN_MEDIA_EN_DEFAULT:"",t.cssSheetManage;for(let t=0;t<this.styleNodeList.length;t++)this.styleNodeList[t].setAttribute(d.media_,e)}static disableMedia(t=!1){if(!this.styleNodeList.length)return;const e=w.styleNodeList.some(t=>""===t.getAttribute(d.media_)),n=window.matchMedia(d.WIDE_SCREEN_MEDIA_EN_DEFAULT).matches;if(t||e||n)for(let i=0;i<this.styleNodeList.length;i++)this.styleNodeList[i].setAttribute(d.media_,d.WIDE_SCREEN_MEDIA_DIS)}static updateState(){I.isWideScreen()?w.enableMedia():w.disableMedia()}}w.initFlag=!1,w.styleNodeList=[];class O{static queryInsertRuleEle(){for(let[t,e]of this.insertRuleSelectorArr){const n=document.querySelectorAll(t);for(let t=0;t<n.length;t++){n[t];for(let t=0;t<e.length;t++){e[t]}}}}static appendRule(t,e){this.forceCSSAppendStyle;let n="",i=[];for(let s=0;s<e.length;s++){const t=e[s];i.push(t[0]),n+=`${t[0]}: ${t[1]}!important;`}const o=this.insertRuleSelectorArr.findIndex(e=>{const[n]=e;return n===t});-1!==o&&(this.forceCSSAppendStyle.sheet.deleteRule(o),this.insertRuleSelectorArr.splice(o,1)),this.insertRuleSelectorArr.push([t,i,n]),this.forceCSSAppendStyle.sheet.insertRule(`${t}{${n}} `,this.insertRuleSelectorArr.length-1)}static setStyle(e,n,i){if(this.hasForceCSS(e,n))return void t.styleSetter;t.styleSetter;const o=R.styleCache.get(e);o?o.set(n,i):R.styleCache.set(e,(new Map).set(n,i))}static setStyleByInsertRule(e,n,i){if(this.hasForceCSS(e,n))return void t.styleSetter;let o,s=`[class='${e.className}']`;e.style.position===d.fixed&&(s+='[style*="position: fixed;"]'),e.style.top&&(s+=`[style*='top: ${e.style.top};']`),e.id&&(s=`#${e.id}`+s),o=e.getAttribute(f)?e.getAttribute(f):"LayoutKey.INSERT_RULE"+R.uniqueVirIdx++,e.setAttribute(f,o),s+=`[${f}='${o}']`,e.setAttribute(f,o),this.appendRule(s,[[n,i]])}static hasForceCSS(t,e){const n=E.getValue(t,N);if(!n)return!1;return n.split(",").includes(e)}static flushAllStyles(){R.styleDiv.parentElement!==document.head&&(R.styleDiv=document.head.appendChild(R.styleDiv)),this.queryInsertRuleEle(),this.flushRemove(),this.flushCacheToCSSSheet(),this.checkAttr(),R.styleCache.clear()}static flushRemove(){for(let t=0;t<O.deleteList.length;t++)O.deleteList[t].remove();O.deleteList=[]}static removeEle(t){t&&O.deleteList.push(t)}static flushCacheToCSSSheet(){for(const[e,n]of R.styleCache.entries()){if(!e)continue;let i=R.styleFlushed.get(e);if(n.delete(d.delete)){if(i){const t=i[R.INDEX_IDX];this.deleteOldStyle(e,t),i=void 0}if(!n.size)continue}if(i||(i=[R.uniqueVirIdx,new Map],R.styleFlushed.set(e,i),R.uniqueVirIdx++),I.MapAContainsMapB(i[R.STYLE_MAP_IDX],n)){t.styleSetter;continue}const o=O.mergeStyle(n,i[R.STYLE_MAP_IDX]),s=i[R.INDEX_IDX];R.styleFlushed.set(e,[s,o]),this.setStoreStyleToCSSSheet(e,s,o)}}static mergeStyle(t,e){for(let[n,i]of t.entries())i===d.delete?e.delete(n):e.set(n,i);return e}static deleteOldStyle(t,e){R.styleFlushed.delete(t),O.delAttr(t);const n=O.findRuleIdxInList(e);-1!==n&&(R.styleDiv.sheet.deleteRule(n),O.delRuleIdxInList(n))}static setStoreStyleToCSSSheet(e,n,i){const o=O.getRulesStr(i),s=O.getSelectStr(e,n);O.setAttr(e,n);let a=O.findRuleIdxInList(n);-1!==a?R.styleDiv.sheet.deleteRule(a):a=O.addRuleIdxInList(n),R.styleDiv.sheet.insertRule(s+"{"+o+"}",a),t.styleSetter}static getRulesStr(t){let e="";for(const[n,i]of t)e+=n+":"+i+" "+d.important+";\n";return e}static getSelectStr(t,e){const n=O.getAttrSelectStr(e);return O.getIdSelect(t,n)+n}static getAttrSelectStr(t){let e="";const n=d.a_+t;for(let i=0;i<d.ATTR_NUM;i++){e+=`[${O.generateAttrKey(i)}=${n}]`}return e}static getIdSelect(t,e){let n="";const i=/^[a-zA-Z_.-][0-9a-zA-Z_.-]*$/g;for(i.test(t.id)&&(n+=`#${t.id}`.replace(/\./g,"\\.")),t=t.parentElement;t&&t!==b.body_();)i.test(t.id)&&(n=`#${t.id}`.replace(/\./g,"\\.")+" "+n),t=t.parentElement;return n&&(n+=e+","),n}static setAttr(t,e){const n=d.a_+e;for(let i=0;i<d.ATTR_NUM;i++){const e=O.generateAttrKey(i);t.setAttribute(e,n)}}static delAttr(t){for(let e=0;e<d.ATTR_NUM;e++){const n=O.generateAttrKey(e);t.removeAttribute(n)}}static checkAttr(){for(let t=0;t<this.observeList.length;t++){const e=this.observeList[t],n=R.styleFlushed.get(e);n&&this.setAttr(e,n[R.INDEX_IDX])}this.observeList=[]}static addRuleIdxInList(t){return R.indexMappingList.push(t),R.indexMappingList.length-1}static findRuleIdxInList(t){return R.indexMappingList.findIndex(e=>e===t)}static delRuleIdxInList(t){t<0||t>=R.indexMappingList.length||R.indexMappingList.splice(t,1)}static disableHandle(t){E.setValue(t,m,p.DISABLE),I.setParentTag(t.parentElement,h,p.ZOOM_PARENT),I.setParentTag(t.parentElement,m,p.ZOOM_PARENT)}static checkAndSetStyle(t,e,n){if(!t)return;const i=u.computedStyle(t,e);null!==i&&i!==d.num0px||O.setStyle(t,e,n)}static generateAttrKey(t){return d.hw_+String.fromCharCode(t+d.a_.charCodeAt(0))}}O.insertRuleSelectorArr=[],O.deleteList=[],O.observeList=[];class D{constructor(t,e){if(this.taskCount=0,this.isLocked=!1,this.timerId=null,D.TAG,"function"!=typeof e)throw a.e("任务参数必须是函数",D.TAG),new TypeError("Throttle: task must be a function");"number"!=typeof t||t<D.MIN_TIMEOUT?(a.w(`⚠️ timeout参数无效 (${t}ms)，使用最小值 ${D.MIN_TIMEOUT}ms`,D.TAG),this.timeout=D.MIN_TIMEOUT):this.timeout=t,this.taskToRun=e,this.timeout,e.name,D.TAG}postTask(){this.taskCount++,this.isLocked?(this.taskCount,D.TAG):(this.taskCount,D.TAG,this.executeTask())}cancel(){const t=this.taskCount;D.TAG,this.taskCount=0,null!==this.timerId&&(D.TAG,clearTimeout(this.timerId),this.timerId=null),t>0&&D.TAG}destroy(){D.TAG,this.cancel(),this.isLocked=!1,D.TAG}executeTask(){const t=Date.now();this.taskCount;D.TAG,this.lock();try{D.TAG,this.taskToRun();Date.now();D.TAG,this.scheduleUnlock(t)}catch(e){const n=Date.now()-t;a.e(`❌ 任务执行失败 (耗时: ${n}ms): ${e}`,D.TAG,e),a.w("紧急解锁以避免死锁",D.TAG),this.unlock()}}lock(){this.taskCount;this.isLocked=!0,this.taskCount=0,Date.now(),D.TAG}scheduleUnlock(t){const e=t+this.timeout,n=Date.now(),i=Math.max(0,e-n);this.timeout,D.TAG,null!==this.timerId&&(D.TAG,clearTimeout(this.timerId)),this.timerId=window.setTimeout(()=>{this.timerId=null,D.TAG,this.unlock()},i)}unlock(){if(this.isLocked=!1,this.taskCount>0){this.taskCount;Date.now(),D.TAG,this.executeTask()}else Date.now(),D.TAG}getState(){const t={isLocked:this.isLocked,taskCount:this.taskCount,timeout:this.timeout};return D.TAG,t}}D.TAG=t.throttle,D.MIN_TIMEOUT=10;class v{static removeAllStyle(e){t.styleCleaner;const n=(new Map).set(d.delete,d.true);R.styleCache.set(e,n)}static removeSingleStyle(e,n){t.styleCleaner,O.setStyle(e,n,d.delete)}static resetEle(e,n=!1){t.styleCleaner,E.getValue(e,h),t.styleCleaner,E.getValue(e,m),t.styleCleaner,v.resetChild(e,n),v.resetParent(e.parentElement)}static resetChild(e,n){if(e){if(E.getValue(e,T))return e.parentElement,t.styleCleaner,void e.remove();v.removeAllStyle(e),E.clearAllTag(e,n),[...e.children].forEach(t=>{v.resetChild(t,n)})}}static resetParent(t){if(t&&t!==b.documentElement_()&&(E.getValue(t,h)===p.ZOOM_PARENT||E.getValue(t,m)===p.ZOOM_PARENT)){for(let e=0;e<t.children.length;e++){const n=t.children[e];if(n&&(E.getValue(n,h)||E.getValue(n,m)))return}this.removeAllStyle(t),E.clearAllTag(t,!1),this.resetParent(t.parentElement)}}static resetParentRelayout(e){return!(!e||I.isZoomParent(e))&&(E.getValue(e,h),t.styleCleaner,E.getValue(e,h)===p.NEXT_ROUND||(I.hadZoomLayout(e)?(t.styleCleaner,I.hadStretchedWidth(e)?(t.styleCleaner,v.resetEle(e),et.nextRoundAndPost(e),!0):(v.resetEle(e),!1)):v.resetParentRelayout(e.parentElement)))}static removeWidth(t){v.removeSingleStyle(t,d.width),v.removeSingleStyle(t,d.max_width),v.removeSingleStyle(t,d.flex_basis)}}var M,x,L;!function(t){t[t.Center=1]="Center",t[t.Center_Button_Overlap=2]="Center_Button_Overlap",t[t.Bottom=3]="Bottom",t[t.Picker=4]="Picker",t[t.Input=5]="Input"}(M||(M={}));class k{static hasExplicitlyDefinedStyle(e,n,i,o){t.layoutUtils,e.className||e.tagName,t.layoutUtils;const s=e.style[n];if(s&&this.convertToPxUnits(s)===i)return t.layoutUtils,!0;t.layoutUtils;const a=this.findStyleInSheets(e,n,i);if(a.isFound)return t.layoutUtils,!0;if(!a.crossDomainSheetEncountered)return t.layoutUtils,!1;t.layoutUtils;const r=e.getBoundingClientRect();if("top"===n){const e=Math.abs(r[n]-parseFloat(i))<d.discrepancy;return r.top,Math.abs(r[n]-parseFloat(i)),t.layoutUtils,e}const l=Math.abs(r[n]-window.innerHeight)<d.discrepancy;return r.bottom,Math.abs(r[n]-window.innerHeight),t.layoutUtils,l}static findStyleInSheets(e,n,i){let o=!1;document.styleSheets.length,t.layoutUtils;for(const s of document.styleSheets){const a=this._processSingleSheet(s,e,n,i);if(a.error&&(o=!0),a.isFound)return t.layoutUtils,{isFound:!0,crossDomainSheetEncountered:o}}return t.layoutUtils,{isFound:!1,crossDomainSheetEncountered:o}}static _processSingleSheet(e,n,i,o){try{return{isFound:Array.from(e.cssRules).some(t=>this._isRuleMatch(t,n,i,o)),error:!1}}catch(s){return a.w(`无法访问跨域样式表，某些样式检查可能不准确: ${e.href}`,t.layoutUtils),{isFound:!1,error:!0}}}static _isRuleMatch(t,e,n,i){if(!(t instanceof CSSStyleRule&&t.selectorText&&e.matches(t.selectorText)))return!1;const o=t.style.getPropertyValue(n);return o&&k.convertToPxUnits(o)===i}static hasTopStyle(t,e,n){return this.hasExplicitlyDefinedStyle(t,"top",n,e)}static hasBottomStyle(t,e,n){return this.hasExplicitlyDefinedStyle(t,"bottom",n,e)}static convertToPxUnits(t){return t.endsWith("rem")?parseFloat(t)*parseFloat(getComputedStyle(document.documentElement).fontSize)+"px":t.endsWith("vw")||t.endsWith("%")?window.innerHeight*parseFloat(t)/100+"px":t}static isNodeTruncated(e,n){if(!(e instanceof HTMLElement))return!1;t.layoutUtils,e.className||e.tagName,t.layoutUtils;const i=window.innerHeight,o=(null==n?void 0:n.stickyTop_height)||0,s=(null==n?void 0:n.stickyBottom_height)||0;t.layoutUtils,t.layoutUtils;const a=e.getBoundingClientRect(),r=window.getComputedStyle(e),l=parseFloat(r.borderTopWidth),c=parseFloat(r.borderBottomWidth),u=parseFloat(r.paddingTop),p=parseFloat(r.paddingBottom),h=a.top+l+u,m=a.bottom-c-p;if(t.layoutUtils,h>=m)return t.layoutUtils,!1;const g=Math.round(h)<o,f=Math.round(m)>i-s+d.truncateThreshold;g&&(e.className,t.layoutUtils),f&&(e.className,t.layoutUtils);const T=g||f;return t.layoutUtils,T}static isOverflowScroll(t){const e=this.hasScrollbar(t),n=t.scrollHeight>t.clientHeight;return e&&n}static isOverflowScrollChild(e,n){var i;(null===(i=e.className)||void 0===i?void 0:i.split(" ")[0])||e.tagName;n.length,t.layoutUtils;const o=n.some(n=>{var i;const o=e!==n,s=n.contains(e),a=o&&s;if(a){(null===(i=n.className)||void 0===i?void 0:i.split(" ")[0])||n.tagName;t.layoutUtils}return a});return t.layoutUtils,o}static checkIfBackgroundImgTruncated(e){if(!(e instanceof HTMLElement))return!1;let n=getComputedStyle(e);const i="none"!==n.backgroundImage&&"cover"===n.backgroundSize;return i&&(e.className||e.tagName,t.layoutUtils),i}static getWidthAsPx(t,e){return window.getComputedStyle(t).getPropertyValue(e)}static canBeRelayout(t){const e=E.getValue(t,h);return[null,p.ZOOM_PARENT,p.HEADER,p.BOTTOM,p.VERTICAL_GRID].includes(e)}static getVisibleChildren(t){return Array.from(t.children).filter(t=>{if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity})}static findParentWithEqualChildren(e,n=5){if(!e||e.nodeType!==Node.ELEMENT_NODE)return null;if("none"===window.getComputedStyle(e).display)return null;const i=Array.from(e.children).filter(t=>{const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity});if(i.length>=2){const o=new Map,s=t=>Math.round(t/n)*n;for(const t of i){const e=t.getBoundingClientRect(),n=`${s(e.width)}, ${s(e.height)}`;o.set(n,(o.get(n)||0)+1)}if([...o.values()].some(t=>t>=2))return e.className||e.tagName,i.length,t.layoutUtils,e}for(const t of i){const i=this.findParentWithEqualChildren(t,n);if((e===i||!e.contains(i))&&i)return i}return null}static analyzeComputedBoxShadow(e){var n,i,o,s;if(t.layoutUtils,!e||"string"!=typeof e||"none"===e||""===e)return t.layoutUtils,null;const a=e.match(/(rgba?\(.*?\)|hsla?\(.*?\)|#[\da-f]{3,8}|[a-z]+)/i);if(!a)return t.layoutUtils,null;const r=a[0],l=e.replace(r,"").trim().split(/\s+/).filter(Boolean);if(l.length<2)return l.length,t.layoutUtils,null;const c={offsetX:null!==(n=l[0])&&void 0!==n?n:"0px",offsetY:null!==(i=l[1])&&void 0!==i?i:"0px",blurRadius:null!==(o=l[2])&&void 0!==o?o:"0px",spreadRadius:null!==(s=l[3])&&void 0!==s?s:"0px",color:r};c.offsetX,c.offsetY,c.blurRadius,c.spreadRadius,t.layoutUtils;const u=parseFloat(c.spreadRadius),d=Math.max(window.innerWidth,window.innerHeight),p=u>=d,h=c.offsetX.trim().startsWith("0")&&c.offsetY.trim().startsWith("0")&&c.blurRadius.trim().startsWith("0")&&p;return t.layoutUtils,h}static isBottomCloseButtonOverlap(e){if(t.layoutUtils,!e||!e.root_node)return t.layoutUtils,!1;const n=e.root_node.querySelectorAll('[class*="close"]');if(n.length,t.layoutUtils,1!==n.length)return t.layoutUtils,!1;const i=n[0],o=getComputedStyle(i),s=i.getBoundingClientRect();if(o.position,o.bottom,t.layoutUtils,this.isCloseButton(i)&&"absolute"===o.position&&parseFloat(o.bottom)<0){const e=s.top,n=i.parentElement.getBoundingClientRect().top,o=i.parentElement.getBoundingClientRect().bottom;if(t.layoutUtils,e<o&&e>(n+o)/2)return t.layoutUtils,!0}return t.layoutUtils,!1}static isCloseButton(e){const n=getComputedStyle(e).background.includes("url"),i="button"===e.getAttribute("role");return!(!n&&!i)&&(t.layoutUtils,!0)}static isAbsoluteButtonInBottom(t){t.root_node.querySelectorAll('[class*="button"]');return!1}static hasElementSiblings(t){return null!==t.previousElementSibling||null!==t.nextElementSibling}static getVisualBoundingRectForAll(e){if(t.layoutUtils,!e||"function"!=typeof e.getBoundingClientRect)return t.layoutUtils,null;const n=e.getBoundingClientRect();let i=n.top,o=n.bottom;const s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(t){if(!(t instanceof HTMLElement))return NodeFilter.FILTER_REJECT;const e=window.getComputedStyle(t.parentElement).overflowY,n="scroll"===e||"auto"===e,i=t.parentElement.scrollHeight>t.parentElement.clientHeight;return n&&i?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let a=s.nextNode();for(;a;){let t=a.getBoundingClientRect().top,e=a.getBoundingClientRect().bottom;i=Math.min(i,t),o=Math.max(o,e),a=s.nextNode()}return t.layoutUtils,{top:i,bottom:o}}static getVisualBoundingRect(e,n,i){if(t.layoutUtils,e.className||e.tagName,t.layoutUtils,!e||"function"!=typeof e.getBoundingClientRect)return t.layoutUtils,null;const o=e.getBoundingClientRect();let s=null,a=0,r=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;0!==o.height&&0!==o.width&&(r=o.left,l=o.top,c=o.right,u=o.bottom,t.layoutUtils);const d=(e,o)=>{if(this.hasScrollbar(e))return void(e=>{if(s=e,e.className||e.tagName,t.layoutUtils,!n)return;const o=e.scrollHeight-e.getBoundingClientRect().height;t.layoutUtils,i===M.Bottom?(a-=o,t.layoutUtils):i!==M.Center&&i!==M.Center_Button_Overlap||(a-=o/2,t.layoutUtils)})(e);const p=window.getComputedStyle(e);if(!(e!==o&&"hidden"===p.overflowY&&e.scrollHeight>e.clientHeight)){(t=>{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t);if(!(e.width>0&&e.height>0&&"none"!==n.display&&"hidden"!==n.visibility&&parseFloat(n.opacity)>0))return;const i=e.height/e.width;i>.1&&i<10&&(r=Math.min(r,e.left),l=Math.min(l,e.top),c=Math.max(c,e.right),u=Math.max(u,e.bottom))})(e);for(const t of e.children)t instanceof HTMLElement&&d(t,o)}};d(e,e);const p=c-r,h=u-l;return 0!==o.height&&0!==o.width&&(a+=l-o.top+(h-o.height)/2),t.layoutUtils,t.layoutUtils,s&&(s.className||s.tagName),t.layoutUtils,{left:r,top:l,right:c,bottom:u,width:p,height:h,offsetY:a,scrollElement:s}}static hasScrollbar(t){const e=window.getComputedStyle(t).overflowY;return"scroll"===e||"auto"===e}static getStackingContextChain(t){const e=[];let n=t;for(;n&&n!==document.documentElement;)k.isStackingContext(n)&&e.push({element:n,zIndex:k.getEffectiveZIndex(n)}),n=n.parentElement;return e.push({element:document.documentElement,zIndex:0}),e.reverse()}static isStackingContext(e){if(e===document.documentElement)return!0;const n=window.getComputedStyle(e);return!!(this.isPositionedStackingContext(n)||this.isLayoutChildStackingContext(e,n)||this.isCssPropertyStackingContext(n)||this.isWillChangeStackingContext(n)||this.isContainStackingContext(n))||(e.className,t.layoutUtils,!1)}static isPositionedStackingContext(t){const e=t.position;return e===d.fixed||e===d.sticky||(e===d.absolute||e===d.relative)&&"auto"!==t.zIndex}static isLayoutChildStackingContext(t,e){return k.isFlexOrGridChildWithZIndex(t,e)}static isCssPropertyStackingContext(t){if(parseFloat(t.opacity)<1||"normal"!==t.mixBlendMode||"isolate"===t.isolation)return!0;return["transform","filter","backdropFilter","perspective","clipPath","mask","maskImage"].some(e=>"none"!==t[e])}static isWillChangeStackingContext(t){const e=t.willChange;return"z-index"===e||e.includes("transform")||e.includes("opacity")}static isContainStackingContext(t){const e=t.contain;return["layout","paint","strict","content"].some(t=>e.includes(t))}static isFlexOrGridChildWithZIndex(t,e){const n=t.parentElement;if(!n)return!1;const i=window.getComputedStyle(n);return("flex"===i.display||"inline-flex"===i.display||"grid"===i.display||"inline-grid"===i.display)&&"auto"!==e.zIndex}static getEffectiveZIndex(t){const e=window.getComputedStyle(t);return"auto"===e.zIndex?0:parseInt(e.zIndex,10)||0}static compareZIndex(e,n){if(t.layoutUtils,e===n)return t.layoutUtils,0;if(e.contains(n))return t.layoutUtils,-1;if(n.contains(e))return t.layoutUtils,1;const i=k.getStackingContextChain(e),o=k.getStackingContextChain(n);i.length,o.length,t.layoutUtils,t.layoutUtils;let s=0;for(;s<i.length&&s<o.length;){const t=i[s],e=o[s];if(t.element!==e.element)return this.compareSiblingContexts(t,e);s++}return k.handleByChainPost(e,n,i,o)}static compareSiblingContexts(e,n){if(e.zIndex>n.zIndex)return e.zIndex,n.zIndex,t.layoutUtils,1;if(e.zIndex<n.zIndex)return e.zIndex,n.zIndex,t.layoutUtils,-1;const i=e.element.compareDocumentPosition(n.element);return i===Node.DOCUMENT_POSITION_FOLLOWING?(t.layoutUtils,-1):i===Node.DOCUMENT_POSITION_PRECEDING?(t.layoutUtils,1):(t.layoutUtils,0)}static handleByChainPost(e,n,i,o){if(i.length<o.length){t.layoutUtils;const n=o[i.length].zIndex;if(n>0)return-1;if(n<0)return 1;{const n=e.compareDocumentPosition(o[i.length].element);return n===Node.DOCUMENT_POSITION_FOLLOWING?(t.layoutUtils,-1):n===Node.DOCUMENT_POSITION_PRECEDING?(t.layoutUtils,1):(t.layoutUtils,0)}}if(i.length>o.length){t.layoutUtils;const e=i[o.length].zIndex;if(e>0)return 1;if(e<0)return-1;{const e=i[o.length].element.compareDocumentPosition(n);return e===Node.DOCUMENT_POSITION_FOLLOWING?(t.layoutUtils,-1):e===Node.DOCUMENT_POSITION_PRECEDING?(t.layoutUtils,1):(t.layoutUtils,0)}}t.layoutUtils;const s=e.compareDocumentPosition(n);return s===Node.DOCUMENT_POSITION_FOLLOWING?(t.layoutUtils,-1):s===Node.DOCUMENT_POSITION_PRECEDING?(t.layoutUtils,1):(t.layoutUtils,0)}}class G{static isImageCanSafetyStrech(t){const e=getComputedStyle(t).backgroundImage;return!(!e||!e.includes("linear-gradient"))}static isPureText(t){return t.nodeType===Node.TEXT_NODE||1===t.childNodes.length&&t.firstChild.nodeType===Node.TEXT_NODE}static isImageContainer(t){var e;if("IMG"===t.tagName)return!0;if("img"===t.getAttribute("role"))return!0;const n=getComputedStyle(t).backgroundImage;if(n&&"none"!==n&&"initial"!==n)return!0;const i=getComputedStyle(t).webkitMaskImage;return!(!i||"none"===i||!i.includes("url"))||("SOURCE"===t.tagName&&"PICTURE"===(null===(e=t.parentElement)||void 0===e?void 0:e.tagName)||("image"===t.tagName&&"http://www.w3.org/2000/svg"===t.namespaceURI||("CANVAS"===t.tagName&&"container"===t.dataset.imageRole||(!!t.classList.contains("pseudo-image-container")||("IFRAME"===t.tagName&&"image-viewer"===t.dataset.role||!!t.classList.contains("a-lottie"))))))}static isObjectNode(t){return"object"===t.tagName}static copyEventListeners(t,e){const n=getEventListeners(t);for(const s in n)n[s].forEach(t=>{e.addEventListener(s,t.listener)});const i=t.children,o=e.children;for(let s=0;s<i.length;s++)G.copyEventListeners(i[s],o[s]);return e}static isOverFlowHidden(t,e){for(;t&&t!==e;){if("hidden"===getComputedStyle(t).overflow)return null==t||t.className,G.TAG,!0;t=t.parentElement}return!1}static pruneCommonAncestorsInTree(t,e){const n=new Set;n.add(e);for(const[i,o]of t){if(o)continue;let s=i.parentElement;for(;s&&s!==e;)t.has(s)&&n.add(s),s=s.parentElement}return n.forEach(e=>t.delete(e)),t}static getValidChildNodeLength(t){let e=0;return t&&t.childNodes&&t.childNodes.forEach(t=>{G.shouldSkip(t)||(e+=1)}),e}static getSwiperIndicator(t){if(t&&t.childNodes){const e=t.querySelectorAll('[class*="indicator"]');if(e&&1===e.length)return e[0]}return null}static findVisibleImageNode(t){for(;0!==G.getValidChildNodeLength(t);)for(const e of t.childNodes){const t=e;if(!G.shouldSkip(t))return G.isImageContainer(t)?t:G.findVisibleImageNode(t)}return null}static shouldSkip(t){return!t||t.nodeType!==Node.ELEMENT_NODE||(I.ignoreLocalName(t)?(null==t||t.className,G.TAG,!0):k.canBeRelayout(t)?!!I.isInvisibleElement(t)&&(null==t||t.className,G.TAG,!0):(null==t||t.className,G.TAG,!0))}static isElementVisible(t,e){if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const n=getComputedStyle(t);if("none"===n.display||"hidden"===n.visibility||"0"===n.opacity)return null==t||t.className,G.TAG,!1;const i=t.getBoundingClientRect();if(0===i.width||0===i.height)return null==t||t.className,G.TAG,!1;const o=t.parentElement;if("absolute"===n.position)if(G.isOverFlowHidden(o,e))return!1;return!0}static isElementInViewport(t){if(!t)return!1;const e=t.getBoundingClientRect();return e.width>0&&e.height>0&&e.top<window.innerHeight&&e.bottom>0&&e.left<window.innerWidth&&e.right>0}static getElementDepth(t){if(!t)return 0;let e=0,n=t;for(;n.parentElement;)e++,n=n.parentElement;return e}static zIndexToNumber(t){if(!t)return 0;if("auto"===t.toLowerCase())return 0;const e=parseInt(t,10);return isNaN(e)?0:e}static isColorTransparent(t){if(!t)return!1;if("transparent"===(t=t.toLowerCase().trim()))return!0;if(t.startsWith("rgba")||t.startsWith("hsla")){const e=parseFloat(t.split(",")[3]);return!isNaN(e)&&0===e}if(t.startsWith("#")&&(5===t.length||9===t.length)){const e=t.slice(1);if(4===e.length){return 0===parseInt(e[3]+e[3],16)/255}if(8===e.length){return 0===parseInt(e.slice(6,8),16)/255}}return!1}static isColorSemiTransparent(t){if(!t)return!1;t=t.toLowerCase().trim();const e=l.getInstance().getOpacityFilter();if("transparent"===t)return!1;if(t.startsWith("rgba")||t.startsWith("hsla")){const n=parseFloat(t.split(",")[3]);return!isNaN(n)&&n>e[0]/100&&n<e[1]/100}if(t.startsWith("#")&&(5===t.length||9===t.length)){const n=t.slice(1);if(4===n.length){const t=parseInt(n[3]+n[3],16)/255;return t>e[0]/100&&t<e[1]/100}if(8===n.length){const t=parseInt(n.slice(6,8),16)/255;return t>e[0]/100&&t<e[1]/100}}return!1}static hasSemiTransparentGradient(t){return!(!t||"none"===t)&&(!t.includes("transparent")&&!!/rgba$$.+?$$|hsla$$.+?$$/i.test(t))}static hasSemiTransparentFilter(t){if(!t)return!1;if(/opacity$$[^)]*$$/i.test(t)){const e=t.match(/opacity$$([^)]+)$$/),n=l.getInstance().getOpacityFilter();if(e){const t=parseFloat(e[1].trim());return t>n[0]/100&&t<n[1]/100}}return!1}static isBackgroundSemiTransparent(e){if(!e)return t.util,!1;if(G.isColorSemiTransparent(e.backgroundColor))return t.util,!0;const n=parseFloat(e.opacity),i=l.getInstance().getOpacityFilter();return n>i[0]/100&&n<i[1]/100?(e.opacity,i[0],i[1],t.util,!0):(G.hasSemiTransparentGradient(e.backgroundImage)||G.hasSemiTransparentFilter(e.filter)||"none"!==e.backdropFilter||/overlay|multiply|screen|soft-light/.test(e.mixBlendMode)||"none"!==e.mask)&&(t.util,!0)}static isUserTextEditable(t){if("disabled"in t&&t.disabled)return!1;const e=t.tagName.toLowerCase();if(e===d.input){const e=t;return!e.readOnly&&!!d.textTypes.has(e.type)}return e===d.textarea&&!t.readOnly}static isElementVisibleInViewPort(t){if(!t)return!1;const e=getComputedStyle(t);if("none"===e.display||"hidden"===e.visibility||0===parseFloat(e.opacity))return t.className,e.display,e.display,e.opacity,!1;const n=t.getBoundingClientRect();return n.width>0&&n.height>0}static getScreenAreaRatio(t){if(!t)return 0;const e=t.getBoundingClientRect(),n=window.innerWidth,i=window.innerHeight;return Math.max(0,Math.min(e.right,n)-Math.max(e.left,0))*Math.max(0,Math.min(e.bottom,i)-Math.max(e.top,0))/(n*i)*100}static hasCloseButton(t){var e;if(!t)return!1;try{const n=t.classList?Array.from(t.classList).join(" ").toLowerCase():"",i=window.getComputedStyle(t).backgroundImage.toLowerCase();if(null===(e=l.getInstance().getcloseButtonPattern())||void 0===e?void 0:e.some(t=>n.includes(t)||i.includes(t)))return!0;for(const e of Array.from(t.children))if(G.hasCloseButton(e))return!0}catch(n){}return!1}static hasButton(t){var e;if(!t)return!1;try{const n=t.classList?Array.from(t.classList).join(" ").toLowerCase():"";if(null===(e=l.getInstance().getButtonPattern())||void 0===e?void 0:e.some(t=>n.includes(t)))return!0}catch(n){}return!1}static getVisibleSiblings(t){if(G.TAG,t.className||t.tagName,G.TAG,!t||!t.parentNode)return G.TAG,[];const e=Array.from(t.parentNode.children);e.length,G.TAG;const n=e.filter(e=>{if(e===t)return!1;const n=getComputedStyle(e);if("none"!==n.display&&"hidden"!==n.visibility&&0===parseFloat(n.opacity)){const t=K.getDurationFromElement(e);t>0&&(e.className||e.tagName,n.display,n.visibility,n.opacity,G.TAG,et.postTask())}return"none"!==n.display&&"hidden"!==n.visibility&&parseFloat(n.opacity)>0?(e.className||e.tagName,G.TAG,!0):(e.className||e.tagName,n.display,n.visibility,n.opacity,G.TAG,!1)});return G.TAG,n.length,n.length,G.TAG,n}static visualFilter(t){if(!t)return!1;const e=getComputedStyle(t);return 0!==t.offsetWidth&&0!==t.offsetHeight&&"none"!==e.display&&"hidden"!==e.visibility&&0!==parseFloat(e.opacity)}static findSiblingContent(t,e=3){const n=G.getVisibleSiblings(t);if(n.length>0)return n.length,[n,t.parentNode];if(t.children.length>0)return[[],null];let i=t.parentNode,o=1;for(;i&&i!==document.body&&o<=e;){const t=G.getVisibleSiblings(i);if(t.length>0)return t.length,[t,i.parentNode];i=i.parentNode,o++}return[[],null]}}G.TAG=t.util;class P{constructor(t){this.root=t,this.mDirty=!0,this.mComponent=t}static recognize(t){throw new Error("FATAL ERROR:Please Implement tis function in subclass")}isDirty(){return this.mDirty}setDirty(t){this.mDirty=t}contains(t){return this.mComponent.contains(t)}}class B{constructor(){this.originalLayoutState=null}static getInstance(){return B.instance||(B.instance=new B),B.instance}recordOriginalPosition(t){if(this.originalLayoutState&&this.originalLayoutState.metrics.has(t))return;const e=new Map;e.set(t,this.getLayoutMetrics(t));t.querySelectorAll("*").forEach(t=>{e.set(t,this.getLayoutMetrics(t))}),this.originalLayoutState={metrics:e,screenSize:{width:window.innerWidth,height:window.innerHeight}}}getLayoutMetrics(t){const e=t.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height,right:e.right,bottom:e.bottom}}}B.minGap=-1,B.minInterWH=Number((48/Math.max(window.devicePixelRatio,1)).toFixed(2)),B.empiricalCoefficient=.022,B.maxProportion=0,B.minAlignment=Number((20/Math.max(window.devicePixelRatio,1)).toFixed(2)),B.tolerance=Number((20/Math.max(window.devicePixelRatio,1)).toFixed(2)),B.relativeOffset=.05,B.maxOffset=.5;class F{static detectLayoutConstraintMetrics(e,n){if(t.layoutConstraintDetector,!n||0===n.size)return a.e("无效的根节点列表",t.layoutConstraintDetector),this.createErrorReport("无效的根节点列表");n.size,t.layoutConstraintDetector;const i=[],o=performance.now();let s=d.RESULT_CODE_PASS,r="",l=!0,c=!0;for(const h of n){if(h.tagName,h.className,t.layoutConstraintDetector,!(h&&h instanceof HTMLElement)){a.e(`无效的根节点: ${h}`,t.layoutConstraintDetector);continue}const e=this.collectLayoutMetrics(h);e.size,t.layoutConstraintDetector,e.has(h)||(a.w("根节点布局数据缺失，重新获取",t.layoutConstraintDetector),this.addRootNodeMetrics(h,e)),t.layoutConstraintDetector;const n=this.detectSafeAreaGaps(h,e,i);Object.values(n).every(t=>t>=B.minGap)?t.layoutConstraintDetector:(a.w(`安全间隙检测失败: 左${n.left.toFixed(1)} 上${n.top.toFixed(1)} 右${n.right.toFixed(1)} 下${n.bottom.toFixed(1)}`,t.layoutConstraintDetector),s=Math.max(s,d.RESULT_CODE_GAPS),l=!1),t.layoutConstraintDetector;const o=this.detectContainerOverflowRate(h,e,i);o>0?(a.w(`元素溢出率检测失败: ${o.toFixed(1)}%`,t.layoutConstraintDetector),s=Math.max(s,d.RESULT_CODE_OVERFLOW),c=!1):t.layoutConstraintDetector}l||(r+="四边安全间隙检测 FAIL."),c||(r+="元素溢出率检测 FAIL."),t.layoutConstraintDetector,k.isBottomCloseButtonOverlap(e)?(a.w("关闭按钮重叠检测失败",t.layoutConstraintDetector),s=Math.max(s,d.RESULT_CODE_CLOSE_BTN_OVERLAP),r+="关闭按钮重叠检测 FAIL."):t.layoutConstraintDetector;const u=this.generateFinalReport(i,s),p=performance.now()-o;return p.toFixed(2),t.layoutConstraintDetector,t.layoutConstraintDetector,t.layoutConstraintDetector,{resultCode:s,errorMsg:r,duration:p,report:u}}static generateFinalReport(t,e){return`# 布局约束指标检测报告\n\n## 总体状态: ${0===e?"✅ 通过":"❌ 未通过"}\n\n`+t.join("\n\n")+("\n\n---\n*检测标准:*\n- 安全间隙 ≥ "+B.minGap+"\n- 元素溢出率 ≤ "+B.maxProportion+".\n")}static createErrorReport(t){return{resultCode:-1,errorMsg:"",duration:0,report:`### 布局约束指标检测\n❌ 错误: ${t}`}}static addRootNodeMetrics(t,e){const n=t.getBoundingClientRect();e.set(t,{top:n.top,left:n.left,width:n.width,height:n.height,right:n.right,bottom:n.bottom})}static collectLayoutMetrics(e){e.tagName,e.className,t.layoutConstraintDetector;const n=new Map;this.addRootNodeMetrics(e,n);const i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});let o=i.nextNode();for(;o;){const t=o;if(t!==e){const e=t.getBoundingClientRect();n.set(t,{top:e.top,left:e.left,width:e.width,height:e.height,right:e.right,bottom:e.bottom})}o=i.nextNode()}return n.size,t.layoutConstraintDetector,n}static detectSafeAreaGaps(e,n,i){const o=n.get(e);if(!o)return a.e("无法获取根节点布局指标",t.layoutConstraintDetector),i.push("### 安全区域间隙检测\n❌ 错误: 无法获取根节点布局指标"),{left:0,top:0,right:0,bottom:0};o.left.toFixed(1),o.top.toFixed(1),o.right.toFixed(1),o.bottom.toFixed(1),t.layoutConstraintDetector,o.width.toFixed(1),o.height.toFixed(1),t.layoutConstraintDetector;const s=Object.assign({top:0,left:0,bottom:0,right:0},window.safeAreaInsets||{});s.left,s.top,s.right,s.bottom,t.layoutConstraintDetector;const r={left:s.left,top:s.top,right:window.innerWidth-s.right,bottom:window.innerHeight-s.bottom},l={left:o.left-s.left,top:o.top-s.top,right:r.right-o.right,bottom:r.bottom-o.bottom};B.minGap,l.left.toFixed(1),l.top.toFixed(1),l.right.toFixed(1),l.bottom.toFixed(1),t.layoutConstraintDetector;const c={left:l.left>=B.minGap,top:l.top>=B.minGap,right:l.right>=B.minGap,bottom:l.bottom>=B.minGap},u=Object.entries(c).filter(([t,e])=>!e).map(([t,e])=>t);u.length>0&&(u.join("、"),t.layoutConstraintDetector);const d=t=>t?"✅ 通过":"❌ 未通过",p=`### 1. 安全间隙检测(弹窗距离屏幕)\n- **要求**: 弹窗四边到安全区域边缘 ≥ ${B.minGap}\n- **屏幕尺寸**: ${window.innerWidth}×${window.innerHeight}\n- **安全区域**: [T:${s.top}, R:${s.right}, B:${s.bottom}, L:${s.left}]\n- **有效区域**: [L:${r.left.toFixed(1)}, T:${r.top.toFixed(1)}, R:${r.right.toFixed(1)}, B:${r.bottom.toFixed(1)}]\n- **弹窗位置**: [L:${o.left.toFixed(1)}, T:${o.top.toFixed(1)}, R:${o.right.toFixed(1)}, B:${o.bottom.toFixed(1)}]\n\n| 方向 | 要求 | 实际值 | 状态 |\n|------|------|--------|------|\n| 左侧 | ≥ ${B.minGap} | ${l.left.toFixed(1)} | ${d(c.left)} |\n| 顶部 | ≥ ${B.minGap} | ${l.top.toFixed(1)} | ${d(c.top)} |\n| 右侧 | ≥ ${B.minGap} | ${l.right.toFixed(1)} | ${d(c.right)} |\n| 底部 | ≥ ${B.minGap} | ${l.bottom.toFixed(1)} | ${d(c.bottom)} |\n\n- **整体状态**: ${Object.values(c).every(t=>t)?"✅ 全部通过":"⚠️ 部分未通过"}\n`;return i.push(p),l}static detectContainerOverflowRate(e,n,i){const o=Object.assign({top:0,left:0,bottom:0,right:0},window.safeAreaInsets||{}),s={left:o.left,top:o.top,right:window.innerWidth-o.right,bottom:window.innerHeight-o.bottom},a=this.collectInteractiveElements(e);a.length,t.layoutConstraintDetector;let r=0;const l=[];a.forEach((i,o)=>{if(i===e)return;const a=n.get(i);if(!a||0===a.width||0===a.height)return;const c=Math.round(a.left)<Math.round(s.left),u=Math.round(a.right)>Math.round(s.right),d=Math.round(a.top)<Math.round(s.top),p=Math.round(a.bottom)>Math.round(s.bottom);if(c||u||d||p){if(this.isScrollableList(i,e)||this.isSwiperComponent(i))return i.tagName,i.className,void t.layoutConstraintDetector;r++;const n=[];c&&n.push("左"),u&&n.push("右"),d&&n.push("上"),p&&n.push("下");const o=`${i.tagName}.${i.className}: ${n.join("、")}侧溢出`;t.layoutConstraintDetector,l.push(`  - ${o}`)}});const c=a.length>0?r/a.length*100:0,u=0===c?"✅ 通过":"❌ 未通过";a.length,c.toFixed(1),t.layoutConstraintDetector;const d=`### 3.  元素溢出率检测(弹窗内控件是否溢出弹窗)\n- **要求**: 元素溢出率 ≤ ${B.maxProportion}}\n- **实际值**: ${c.toFixed(1)}%\n- **状态**: ${u}\n- **详情**:\n  - 总元素数: ${a.length}\n  - 溢出元素数: ${r}\n`;return l.length>0?i.push(d+`  - **溢出元素**:\n${l.join("\n")}`):i.push(d),c}static collectInteractiveElements(e){e.tagName,e.className,t.layoutConstraintDetector;const n=new Set(["button:not([disabled])","a[href]:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[role="button"]:not([disabled])','[role="link"]:not([disabled])','[role="menuitem"]','[role="option"]','[role="img"]','[tabindex]:not([tabindex="-1"])',".a-text.iconfont",".a-view.iconfont",'.iconfont[data-action="close"]','.iconfont[data-role="button"]',".iconfont[onclick]",'.iconfont[role="button"]',".icon-close",".icon-close-circle",".icon-close_circle",".icon-guanbi",".icon-shutdown",'[class*="close"]','[class*="guanbi"]']),i=Array.from(n).join(","),o=Array.from(e.querySelectorAll(i));var s;return s=e,Array.from(n).some(t=>s.matches(t))&&(o.unshift(e),t.layoutConstraintDetector),o.length,t.layoutConstraintDetector,o}static isScrollableList(t,e){const n=t=>{const e=window.getComputedStyle(t),n=e.overflow,i=e.overflowY;return"auto"===n||"scroll"===n||"auto"===i||"scroll"===i};if(n(t))return!0;let i=t.parentElement;for(;i!==e.parentElement;){if(n(i))return!0;i=i.parentElement}return!1}static isSwiperComponent(t){const e=/swiper/,n=e.test(t.className);let i=t.parentElement;for(;i;){if(e.test(i.className))return!0;i=i.parentElement}return n}}!function(t){t[t.A=1]="A",t[t.B=2]="B",t[t.C=3]="C",t[t.Unknown=20]="Unknown"}(x||(x={}));class U{static hasOverlappingCloseButton(e,n){var i;const o=U.getCloseButtons(n.root_node,e);if(0===o.length)return t.popupDecisionTree,!1;const s=U.isCloseElementAbsolute(o,n.root_node,n);return o.some((t,e)=>s[e]&&U.hasOverlapWithSiblings(t))?(null===(i=null==n?void 0:n.root_node)||void 0===i||i.className,t.popupDecisionTree,!0):(t.popupDecisionTree,!1)}static judgePopupDecisionTreeType(e,n){if(U.isInputPopup(e))return t.popupDecisionTree,M.Input;if(U.isTimePickerPopup(e))return M.Picker;return U.isModalWin(e,n)?(window.popWin="bottom",t.popupDecisionTree,M.Bottom):(window.popWin="center",t.popupDecisionTree,this.hasOverlappingCloseButton(e,n)?M.Center_Button_Overlap:M.Center)}static getCloseButtons(t,e){const n=e.filter(e=>{var n,i,o,s,a;if(!t.contains(e))return!1;const r=e.classList?Array.from(e.classList).join(" ").toLowerCase():"",c=window.getComputedStyle(e),u=null!==(o=null===(i=null===(n=c.backgroundImage)||void 0===n?void 0:n.toLowerCase)||void 0===i?void 0:i.call(n))&&void 0!==o?o:"",d=null!==(s=c.backgroundImage)&&void 0!==s?s:"",p=null!==(a=l.getInstance().getcloseButtonPattern())&&void 0!==a?a:[],h=p.some(t=>r.includes(t)||u.includes(t)),m=!h&&p.some(t=>d.includes(t)),g="IMG"===e.tagName&&p.some(t=>e.src.includes(t));return h||m||g});return this.filterContainedNodes(n)}static filterContainedNodes(t){const e=new Set(t),n=[];for(const i of t){let t=i.parentElement,o=!1;for(;null!==t;){if(e.has(t)){o=!0;break}t=t.parentElement}o||n.push(i)}return n}static isElementOrAncestorAbsolute(t,e){let n=window.getComputedStyle(t);if("absolute"===n.position)return!0;let i=t.parentElement;for(;i&&i!==e;){n=window.getComputedStyle(i);const t=i.getBoundingClientRect();if("absolute"===n.position&&t.height<50&&t.width<50)return!0;i=i.parentElement}return!1}static isCloseElementAbsolute(t,e,n){const{popup_type:i,mask_node:o}=n,s=i===x.B||i===x.C?e:o;return t.map(t=>this.isElementOrAncestorAbsolute(t,s))}static hasOverlapWithSiblings(t){if(!t||!t.parentElement)return!1;const e=Array.from(t.parentElement.children).indexOf(t),n=G.getVisibleSiblings(t);let i=[];return n.forEach(t=>{const n=Array.from(t.parentElement.children).indexOf(t);n!==e-1&&n!==e+1||i.push({index:n,element:t})}),0!==i.length&&i.some(n=>{if("absolute"===window.getComputedStyle(n.element).position){const e=this.calOverlapAreaRatio(n.element,t);return this.hasOverlap(n.element,t)&&e>.2&&e<1}if(n.index===e-1){const e=this.findLastChild(n.element),i=this.calOverlapAreaRatio(e,t);return this.hasOverlap(e,t)&&i>.2&&i<1}{const e=this.findFirstChild(n.element),i=this.calOverlapAreaRatio(e,t);return this.hasOverlap(e,t)&&i>.2&&i<1}})}static findFirstChild(t){if(!t||!t.lastElementChild)return null;let e=t.lastElementChild;for(;e.firstElementChild;)e=e.firstElementChild;return e}static findLastChild(t){if(!t||!t.lastElementChild)return null;let e=t.lastElementChild;for(;e.lastElementChild;)e=e.lastElementChild;return e}static hasOverlap(t,e){if(null===t)return!1;const n=t.getBoundingClientRect(),i=e.getBoundingClientRect();return!(i.right<n.left||i.left>n.right||i.bottom<n.top||i.top>n.bottom)}static calOverlapAreaRatio(t,e){if(null===t)return 0;const n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=Math.max(n.left,i.left),s=Math.min(n.right,i.right),a=Math.max(n.top,i.top),r=Math.min(n.bottom,i.bottom),l=Math.max(0,s-o),c=Math.max(0,r-a),u=i.width*i.height;return u>0?l*c/u:0}static isTimePickerPopup(e){let n=!1,i=!1,o=!1;for(const t of Array.from(e))if(t instanceof HTMLElement&&(n||(n=this.checkPickerClass(t)),i||(i=this.checkUniformHeight(t)),o||(o=this.checkLinearGradient(t)),n&&i&&o))break;return t.popupDecisionTree,n&&i&&o}static isInputPopup(t){return t.some(t=>{const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{const e=t,n=e.tagName.toLowerCase();return(n===d.input||n===d.textarea)&&G.isUserTextEditable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;e.nextNode();)return!0;return!1})}static checkPickerClass(t){return"string"==typeof t.className&&t.className.includes("picker")}static checkUniformHeight(t){const e=t.children;if(e.length<2)return!1;const n=e[0].clientHeight;if(0===n)return!1;for(let i=1;i<e.length;i++){if(e[i].clientHeight!==n)return!1}return!0}static checkLinearGradient(t){const e=window.getComputedStyle(t),n=[e.backgroundImage,e.maskImage].filter(Boolean);for(const i of n){if(!i.includes("linear-gradient"))continue;const t=/(rgba?\(.*?\)|hsla?\(.*?\)|#\w{3,8}|transparent)/gi,e=i.match(t);if(!e)continue;if(e.some(t=>G.isColorSemiTransparent(t)))return!0}return!1}static isModalWin(t,e){const n=this.findMainContentNode(e);if(!n)return!1;if(this.CheckCenterCloseButton(n,t))return!1;switch(e.content_node=n,e.popup_type){case x.C:return U.isModalForTypeC(e);case x.B:return U.isModalForTypeB(e);default:return!1}}static CheckCenterCloseButton(t,e){const n=U.getCloseButtons(t,e);if(n.length<1)return!1;const i=n[0].getBoundingClientRect();return 1===n.length&&i.height<window.innerHeight*d.maxCloseButtonSizeRatio&&i.bottom>window.innerHeight*d.bottomCloseButtonRatio}static isModalForTypeC(t){const e=t.root_node,n=t.content_node;return this.judgeModalConditions(e,n)}static isModalForTypeB(t){const e=t.root_node,n=t.content_node,i=U.judgeModalConditions(e,n);return n.children.length>0?!!i||Array.from(n.children).some(t=>U.judgeModalConditions(e,t)):i}static findMainContentNode(t){let e=t.mask_node;if(t.popup_type===x.B)for(;e.parentElement!==t.root_node;)if(e=e.parentElement,!e)return null;const n=Array.from(t.root_node.children).filter(t=>t!==e);if(0===n.length)return null;if(1===n.length)return n[0];let i=null,o=-1/0,s=0;for(const a of n){const t=window.getComputedStyle(a),e="auto"===t.zIndex?0:parseFloat(t.zIndex);e>o?(o=e,i=a,s=1):e===o&&s++}return 1===s?i:null}static judgeModalConditions(t,e){if(U.specialCenterCondition(e))return!1;if(U.specialBottomCondition(t,e))return!0;const n=window.getComputedStyle(e),{position:i,bottom:o,top:s}=n,a=e.getBoundingClientRect(),r=U.equalToScreenWidth(e,d.discrepancy),l=Math.abs(a.bottom-window.innerHeight)<d.discrepancy,c=Math.abs(a.top)<d.discrepancy;if(!r)return!1;if(i===d.static&&"auto"===o)return l&&!c;if(0!==parseFloat(o))return!1;if(!k.hasBottomStyle(e,i,o))return!1;if(s.endsWith("px")){if(0!==parseFloat(s))return!0;if(k.hasTopStyle(e,i,s))return!1}return l}static specialBottomCondition(t,e){const n=window.getComputedStyle(e),i=window.getComputedStyle(t);return"column"===n.flexDirection&&("flex-end"===n.justifyContent||"end"===n.justifyContent)||"row"===n.flexDirection&&("flex-end"===n.alignItems||"end"===n.alignItems)||"column"===i.flexDirection&&("flex-end"===i.justifyContent||"end"===i.justifyContent)||"row"===i.flexDirection&&("flex-end"===i.alignItems||"end"===i.alignItems)}static specialCenterCondition(t){const e=window.getComputedStyle(t);return"row"===e.flexDirection&&"center"===e.alignItems||"column"===e.flexDirection&&"center"===e.justifyContent}static equalToScreenWidth(t,e){const n=window.getComputedStyle(t),{paddingLeft:i,paddingRight:o,width:s,boxSizing:a,borderLeft:r,borderRight:l}=n;return"border-box"===a?Math.abs(parseFloat(s)-window.innerWidth)<e:!(isNaN(parseFloat(i))||isNaN(parseFloat(o))||isNaN(parseFloat(r))||isNaN(parseFloat(l))||"content-box"!==a)&&Math.abs(parseFloat(s)+parseFloat(i)+parseFloat(o)-window.innerWidth)<e}}!function(t){t.IDLE="IDLE",t.WAITING_ANIMATION="WAITING_ANIMATION",t.PREPROCESSING="PREPROCESSING",t.LAYOUTING="LAYOUTING",t.WAITING_VALIDATION="WAITING_VALIDATION",t.VALIDATING="VALIDATING",t.COMPLETED="COMPLETED",t.RESTORED="RESTORED",t.FAILED="FAILED"}(L||(L={}));const H={[L.IDLE]:[L.WAITING_ANIMATION,L.PREPROCESSING,L.LAYOUTING,L.FAILED],[L.WAITING_ANIMATION]:[L.LAYOUTING,L.IDLE,L.FAILED],[L.PREPROCESSING]:[L.IDLE,L.LAYOUTING],[L.LAYOUTING]:[L.WAITING_VALIDATION,L.IDLE,L.COMPLETED,L.FAILED],[L.WAITING_VALIDATION]:[L.VALIDATING,L.IDLE,L.FAILED],[L.VALIDATING]:[L.COMPLETED,L.RESTORED,L.IDLE,L.FAILED],[L.COMPLETED]:[L.IDLE],[L.RESTORED]:[L.IDLE],[L.FAILED]:[L.IDLE]};function W(t){return{[L.IDLE]:"未布局",[L.WAITING_ANIMATION]:"等待动画完成",[L.PREPROCESSING]:"预处理",[L.LAYOUTING]:"布局中",[L.WAITING_VALIDATION]:"等待验证",[L.VALIDATING]:"验证中",[L.COMPLETED]:"已完成",[L.RESTORED]:"已恢复",[L.FAILED]:"失败"}[t]}function $(t){return{[L.IDLE]:"⚪",[L.WAITING_ANIMATION]:"⏳",[L.PREPROCESSING]:"🔄",[L.LAYOUTING]:"🔄",[L.WAITING_VALIDATION]:"⏰",[L.VALIDATING]:"🔍",[L.COMPLETED]:"✅",[L.RESTORED]:"↩️",[L.FAILED]:"❌"}[t]}class V{static getState(t){if(!t)return a.w("获取状态失败：弹窗根节点为空",V.TAG),L.IDLE;return this.stateMap.get(t)||L.IDLE}static setState(t,e,n){if(!t)return a.w("设置状态失败：弹窗根节点为空",V.TAG),!1;const i=this.getState(t);if(i===e)return $(e),W(e),V.TAG,!0;if(o=e,!H[i].includes(o))return a.e(`❌ 非法状态转换: ${$(i)} ${W(i)} -> ${$(e)} ${W(e)}`,V.TAG),!1;var o;this.stateMap.set(t,e),this.timestampMap.set(t,Date.now());return $(i),W(i),$(e),W(e),V.TAG,e!==L.COMPLETED&&e!==L.FAILED&&e!==L.RESTORED&&et.postTask(),!0}static resetState(t,e){if(!t)return;const n=this.getState(t);$(n),W(n),$(L.IDLE),W(L.IDLE),V.TAG,this.stateMap.set(t,L.IDLE),this.timestampMap.set(t,Date.now())}static clearState(t){if(!t)return;const e=this.getState(t);$(e),W(e),V.TAG,this.stateMap.delete(t),this.timestampMap.delete(t)}static canStartLayout(t){const e=this.getState(t),n=e===L.IDLE||e===L.PREPROCESSING;return n||($(e),W(e),V.TAG),n}static isProcessing(t){const e=this.getState(t);return e===L.WAITING_ANIMATION||e===L.PREPROCESSING||e===L.LAYOUTING||e===L.WAITING_VALIDATION||e===L.VALIDATING}static isCompleted(t){const e=this.getState(t);return e===L.COMPLETED||e===L.RESTORED}static getStateDuration(t){if(!t)return 0;const e=this.timestampMap.get(t);return e?Date.now()-e:0}static printState(t,e){if(!t)return;const n=this.getState(t);this.getStateDuration(t);$(n),W(n),V.TAG}}V.TAG=t.popupStateManager,V.stateMap=new WeakMap,V.timestampMap=new WeakMap;class z extends P{resetStyle(){throw new Error("Method not implemented.")}constructor(t){super(t.root_node),this.cancellationToken={cancelled:!1,generation:0},this.scale=1,this.minTop=1/0,this.maxBottom=-1/0,this.truncateNodes=[],this.bottomNode=null,this.needRestoreStyleNodes=new Set,this.needLayoutConstraintNodes=new Set,this.layoutConstraintResult=null,this.visualHeight=window.innerHeight,this.isCloseButtonTruncatedByScroll=!1,this.popupDecisionTreeType=M.Center,this.contentNodes=[],this.minScaleFactor=l.getInstance().getMinScaleFactor()/100,this.scaleAnimationDuration=l.getInstance().getScaleAnimationDuration(),this.scrollNodes=[],this.popupInfo=t}printTree(t=!1){}setDirty(t){this.mDirty=t}intelligenceLayout(){null!==this.mComponent?(this.visualHeight=window.innerHeight-this.popupInfo.stickyBottom_height-this.popupInfo.stickyTop_height,this.mComponent.className,window.innerWidth,window.innerHeight,this.visualHeight,t.popupRelayout,this.popupInfo.popup_type,this.popupInfo.stickyTop_height,this.popupInfo.stickyBottom_height,t.popupRelayout,this.relayout()):t.popupRelayout}cancelPendingValidation(){this.cancellationToken.cancelled=!0,this.cancellationToken.generation,t.popupRelayout}relayout(){t.popupRelayout,this.cancellationToken={cancelled:!1,generation:Date.now()};const e=this.cancellationToken;e.generation,t.popupRelayout,this.contentNodes=this.getContentNodes();const n=[];if(this.contentNodes.forEach(t=>{this.traverseTree(t,n)}),this.contentNodes.length,t.popupRelayout,V.getState(this.popupInfo.root_node)===L.IDLE&&this.tryToFixFlexShrink())V.setState(this.popupInfo.root_node,L.PREPROCESSING,"预处理，修复flex");else{if(V.setState(this.popupInfo.root_node,L.LAYOUTING,"开始重布局"),this.findTruncateNodes(n),0===this.truncateNodes.length){t.popupRelayout,V.setState(this.popupInfo.root_node,L.IDLE,"无截断节点，恢复空闲状态");let e={resultCode:d.RESULT_CODE_NOT_TRUNCATED,errorMsg:"no truncateNodes found",duration:0,report:"no truncateNodes found"};return void(window.layoutConstraintResult=e)}this.truncateNodes.length,t.popupRelayout,this.popupDecisionTreeType=U.judgePopupDecisionTreeType(n,this.popupInfo),this.popupDecisionTreeType,t.popupRelayout,this.calScale(),this.scale.toFixed(3),t.popupRelayout,t.popupRelayout,this.resetByScale(),this.popupDecisionTreeType===M.Center_Button_Overlap&&(t.popupRelayout,this.fixButtonOverlap()),O.flushAllStyles(),t.popupRelayout,t.popupRelayout,this.getLayoutConstraintReport(e)}}getContentNodes(){x[this.popupInfo.popup_type],t.popupRelayout;let e=[];if(this.popupInfo.popup_type===x.C)e=this.getTopmostChildren(this.mComponent,this.popupInfo.popup_type),e.length,t.popupRelayout;else if(this.popupInfo.popup_type===x.B){this.equivalentMask=this.getEquivalentMask();e=this.getTopmostChildren(this.equivalentMask.parentElement,this.popupInfo.popup_type).filter(t=>t!==this.equivalentMask),e.length,t.popupRelayout}else this.popupInfo.popup_type===x.A&&(e=this.getTopmostChildren(this.popupInfo.mask_node,this.popupInfo.popup_type),e.length,t.popupRelayout);return e}getTopmostChildren(t,e){const n=Array.from(t.children).filter(t=>{const e=window.getComputedStyle(t);return t instanceof HTMLElement&&"none"!==e.display&&"hidden"!==e.visibility&&1===parseFloat(e.opacity)&&!G.isBackgroundSemiTransparent(e)});if(e===x.C||e===x.A)return n.length,n;if(!k.isStackingContext(this.popupInfo.mask_node)){const t=n.filter(t=>k.compareZIndex(t,this.popupInfo.mask_node)>=0);return t.length,t}const i=this.traverseTree(t,[]).filter(e=>{const n=window.getComputedStyle(e);return e instanceof HTMLElement&&e!==t&&!this.equivalentMask.contains(e)&&"none"!==n.display&&"hidden"!==n.visibility&&1===parseFloat(n.opacity)&&!G.isBackgroundSemiTransparent(n)&&k.isStackingContext(e)}),o=this.filterContainedNodes(i).filter(t=>k.compareZIndex(t,this.popupInfo.mask_node)>=0);return o.length,o}getValidGrandChildren(t){return t.filter(t=>{const e=getComputedStyle(t).transform.match(/matrix\((.*?),(.*?),(.*?),(.*?),(.*?),(.*?)\)/),n=e?parseFloat(e[6]):0;return Math.abs(n)<=window.innerHeight})}calScale(){t.popupRelayout,this.truncateNodes.forEach(e=>{e.className,t.popupRelayout;let n=e.getBoundingClientRect();this.minTop=Math.min(this.minTop,n.top),n.bottom>this.maxBottom&&(this.bottomNode=e,this.maxBottom=n.bottom);let i=e;i=e===this.mComponent?e:e.parentElement;const o=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>t instanceof HTMLElement?k.isOverflowScrollChild(t,this.scrollNodes)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let s=o.nextNode();for(;s;){let t=s.getBoundingClientRect().top,e=s.getBoundingClientRect().bottom;this.minTop=Math.min(this.minTop,t),e>this.maxBottom&&(this.bottomNode=s,this.maxBottom=e),s=o.nextNode()}});let e=this.maxBottom-this.minTop,n=this.visualHeight;this.scale=Math.min(1,Math.max(.7*n/e,this.minScaleFactor)),this.scale,this.bottomNode.className}resetByScale(){switch(x[this.popupInfo.popup_type],t.popupRelayout,this.popupInfo.popup_type){case x.C:this.resetForTypeC();break;case x.B:this.resetForTypeB();break;case x.A:this.resetForTypeA()}t.popupRelayout}resetForTypeC(){t.popupRelayout;for(let t of this.contentNodes){const e=t.children.length>0?getComputedStyle(t.children[0]):null,n=t.getBoundingClientRect(),i=!!e&&("fixed"===e.position||"absolute"===e.position),o=0===n.width||0===n.height;this.scaleChildForTypeC(e,i,o,t,this.contentNodes)}}resetForTypeB(){t.popupRelayout;for(let t of this.contentNodes){const e=t.children.length>0?getComputedStyle(t.children[0]):null,n=t.getBoundingClientRect(),i=!!e&&("fixed"===e.position||"absolute"===e.position),o=0===n.width||0===n.height;e&&i&&o?this.scaleGrandChildrenForTypeB(t,this.contentNodes):this.scaleChildForTypeB(t,this.contentNodes)}}resetForTypeA(){t.popupRelayout;for(let e of this.contentNodes)this.scaleByTransform(e,this.scale,!1,this.contentNodes,!1,[]),e.className,t.popupRelayout}scaleChildForTypeB(e,n){this.popupDecisionTreeType===M.Bottom?(e.className,t.popupRelayout,this.scaleByTransform(e,this.scale,!1,n,!1,[])):(e.className,n.length,t.popupRelayout,this.scaleByTransform(e,this.scale,n.length>1,n,!1,[]))}scaleGrandChildrenForTypeB(e,n){const i=this.getValidGrandChildren(Array.from(e.children));e.className,i.length,t.popupRelayout;for(let o=0;o<i.length;o++){const e=i[o];this.popupDecisionTreeType===M.Bottom?this.scaleByTransform(e,this.scale,!1,n,i.length>1,i):this.scaleByTransform(e,this.scale,n.length>1,n,i.length>1,i),e.className,t.popupRelayout}}scaleChildForTypeC(e,n,i,o,s){if(e&&n&&i){o.className,t.popupRelayout;const e=this.getValidGrandChildren(Array.from(o.children));e.length,t.popupRelayout;for(let n=0;n<e.length;n++){const i=e[n];this.scaleByTransform(i,this.scale,s.length>1,s,e.length>1,e),i.className,t.popupRelayout}}else o.className,t.popupRelayout,this.scaleByTransform(o,this.scale,s.length>1,s,!1,[])}getEquivalentMask(){let t=this.popupInfo.mask_node;if(this.popupInfo.popup_type!==x.B)return t;let e=t;if(t!==this.mComponent&&t.parentElement!==this.mComponent&&!k.hasElementSiblings(t)){let n=t.parentElement;for(;n!==this.mComponent&&!k.hasElementSiblings(n);)n=n.parentElement;e=n}return e}makeAllOverflowVisible(t){for(;t&&t!==document.documentElement;){"visible"!==window.getComputedStyle(t).overflow&&(O.setStyle(t,d.overflow,"visible"),this.needRestoreStyleNodes.add(t)),t=t.parentElement}}handleScrollbar(t){t.forEach(t=>{const e=window.getComputedStyle(t.parentElement).overflowY;!G.hasCloseButton(t)||"auto"!==e&&"scroll"!==e||(O.setStyle(t.parentElement,d.overflow,"visible"),this.isCloseButtonTruncatedByScroll=!0,this.makeAllOverflowVisible(t.parentElement),this.needRestoreStyleNodes.add(t.parentElement))})}findTruncateNodes(e){t.popupRelayout;const n=e.filter(t=>!k.isOverflowScrollChild(t,this.scrollNodes)&&k.isNodeTruncated(t,this.popupInfo));n.length,t.popupRelayout,this.handleScrollbar(n),this.truncateNodes=this.filterContainedNodes(n),this.truncateNodes.length,t.popupRelayout,this.truncateNodes.forEach(e=>{e.className,t.popupRelayout})}traverseTree(t,e){e.push(t),k.isOverflowScroll(t)&&this.scrollNodes.push(t);for(let n=0;n<t.childNodes.length;n++)t.childNodes[n]instanceof HTMLElement&&this.traverseTree(t.childNodes[n],e);return e}async getLayoutConstraintReport(e){if(0!==this.needLayoutConstraintNodes.size)try{if(!V.setState(this.popupInfo.root_node,L.WAITING_VALIDATION,"开始等待验证"))return void t.popupRelayout;this.needLayoutConstraintNodes.size,t.popupRelayout,setTimeout(()=>{this.runReport(e)},450)}catch(n){e.cancelled||(a.e("布局约束验证失败",t.popupRelayout,n),V.setState(this.popupInfo.root_node,L.FAILED,`验证异常: ${n}`),this.restoreStyles())}else t.popupRelayout}runReport(e){if(e.cancelled)return e.generation,void t.popupRelayout;const n=V.getState(this.popupInfo.root_node);n===L.WAITING_VALIDATION&&V.setState(this.popupInfo.root_node,L.VALIDATING,"开始验证")?(this.layoutConstraintResult=F.detectLayoutConstraintMetrics(this.popupInfo,this.needLayoutConstraintNodes),this.layoutConstraintResult.resultCode,t.popupRelayout,e.cancelled||(this.layoutConstraintResult.resultCode===d.RESULT_CODE_GAPS||this.layoutConstraintResult.resultCode===d.RESULT_CODE_OVERFLOW?(this.layoutConstraintResult.resultCode,t.popupRelayout,this.restoreStyles(),V.setState(this.popupInfo.root_node,L.RESTORED,"验证失败，已恢复")):(t.popupRelayout,V.setState(this.popupInfo.root_node,L.COMPLETED,"验证通过")),this.setDirty(!1),this.needLayoutConstraintNodes.clear(),window.layoutConstraintResult=this.layoutConstraintResult),t.popupRelayout):t.popupRelayout}filterContainedNodes(t){const e=new Set(t),n=[];for(const i of t){let t=i.parentElement,o=!1;for(;null!==t;){if(e.has(t)){o=!0;break}t=t.parentElement}o||n.push(i)}return n}calculateGroupCenter(t,e){if(!t)return{centerX:0,centerY:0};if(!t.parentNode)return{centerX:0,centerY:0};const n=e.filter(t=>{const e=t.getBoundingClientRect();return e.width>0&&e.height>0}).map(t=>t.getBoundingClientRect()),i=Math.min(...n.map(t=>t.top)),o=Math.max(...n.map(t=>t.bottom)),s=Math.min(...n.map(t=>t.left));return{centerX:s+(Math.max(...n.map(t=>t.right))-s)/2,centerY:i+(o-i)/2}}scaleByTransform(e,n,i,o,s,a){if(null==e||e.className,n.toFixed(3),t.popupRelayout,this._shouldSkipScaling(e))return null==e||e.className,void t.popupRelayout;const r=window.getComputedStyle(e),l=k.getVisualBoundingRect(e,this.isCloseButtonTruncatedByScroll,this.popupDecisionTreeType);this.needLayoutConstraintNodes.add(e);let c=this._calculateOffsetY(e,l,n,{hasBrother:i,brotherNodes:o,hasGrandChild:s,grandChildNodes:a});c.toFixed(2),e.className,t.popupRelayout,this._applyStyleFixes(e,r),this._applyTransform(e,r,c,n),e.className,t.popupRelayout}_shouldSkipScaling(t){if(this.popupDecisionTreeType===M.Picker){let t={resultCode:d.RESULT_CODE_SKIP_SCALE,errorMsg:"the Popup is TimePicker, skip scaling",duration:0,report:"the Popup is TimePicker, skip scaling"};return window.layoutConstraintResult=t,!0}if(this.popupDecisionTreeType===M.Input){let t={resultCode:d.RESULT_CODE_SKIP_SCALE,errorMsg:"the Popup is Input, skip scaling",duration:0,report:"the Popup is Input, skip scaling"};return window.layoutConstraintResult=t,!0}const e=window.getComputedStyle(t),n=k.getVisualBoundingRect(t,this.isCloseButtonTruncatedByScroll,this.popupDecisionTreeType),i=e.transform.match(/matrix\((.*?),(.*?),(.*?),(.*?),(.*?),(.*?)\)/),o=i?parseFloat(i[6]):0;if(Math.abs(o)>window.innerHeight&&!this._isElementInViewport(n)){let t={resultCode:d.RESULT_CODE_SKIP_SCALE,errorMsg:"elements that exceed the screen height and are not within the viewport, skip scaling",duration:0,report:"elements that exceed the screen height and are not within the viewport, skip scaling"};return window.layoutConstraintResult=t,!0}if(this.popupDecisionTreeType===M.Bottom&&n.scrollElement){const t=n.scrollElement.getBoundingClientRect();if(!this._isElementInViewport(t)){let t={resultCode:d.RESULT_CODE_SKIP_SCALE,errorMsg:"Scrolling elements are off-screen, skip scaling",duration:0,report:"Scrolling elements are off-screen, skip scaling"};return window.layoutConstraintResult=t,!0}{const e=(window.innerHeight-t.top)/window.innerHeight*100;O.setStyle(n.scrollElement,d.max_height,`${e}vh`),this.needRestoreStyleNodes.add(n.scrollElement)}}return!1}_isElementInViewport(t){return t.top<window.innerHeight&&t.left<window.innerWidth&&t.bottom>0&&t.right>0}_calculateOffsetY(t,e,n,i){let o=0;const s=e.top+e.height/2;switch(this.popupDecisionTreeType){case M.Bottom:o=window.innerHeight-(s+e.height/2*n);break;case M.Center:case M.Center_Button_Overlap:o=this._calculateCenterOffsetY(t,s,n,i),o-=this.popupInfo.stickyBottom_height/2,o+=this.popupInfo.stickyTop_height/2}return o+=n*e.offsetY,o}_calculateCenterOffsetY(e,n,i,o){let s=0;if(o.hasBrother){const a=this.calculateGroupCenter(e,o.brotherNodes).centerY;s=window.innerHeight/2-a+(n-a)*(i-1),a.toFixed(0),s.toFixed(2),t.popupRelayout}else s=window.innerHeight/2-n,s.toFixed(2),t.popupRelayout;if(o.hasGrandChild){const a=(this.calculateGroupCenter(e,o.grandChildNodes).centerY-n)*(i-1);s+=a,a.toFixed(2),t.popupRelayout}return s}_applyStyleFixes(t,e){"inline"===e.display&&(O.setStyle(t,d.display,"block"),this.needRestoreStyleNodes.add(t));for(let n of t.children)""!==n.style.bottom&&"auto"!==n.style.bottom&&(O.setStyle(n,d.bottom,"unset"),this.needRestoreStyleNodes.add(n));this.adjustChildWidths(t)}_applyTransform(t,e,n,i){const o=e.transform===d.none?"":e.transform;O.setStyle(t,d.transform,`${o} translate(0px, ${n}px) scale(${i})`),O.setStyle(t,d.transition,`all ${this.scaleAnimationDuration}ms ease-in`),this.needRestoreStyleNodes.add(t)}adjustChildWidths(t){const e=window.getComputedStyle(t);if(0===parseFloat(e.width))return;const n=t.children;for(let i=0;i<n.length;i++){const t=n[i],e=window.getComputedStyle(t);0===parseFloat(e.width)&&(O.setStyle(t,d.width,d.num100percent),this.needRestoreStyleNodes.add(t))}}restoreStyles(){this.needRestoreStyleNodes.size,t.popupRelayout,this.needRestoreStyleNodes.forEach((t,e)=>{v.removeAllStyle(e)}),O.flushAllStyles(),this.needRestoreStyleNodes.clear(),t.popupRelayout}shouldFixFlexSharink(t){let e=getComputedStyle(t);if(!e.display.includes(d.flex)||e.flexDirection!==d.column||t.children.length<=1)return!1;let n=1/0,i=-1/0,o=0;return Array.from(t.children).forEach(t=>{let e=getComputedStyle(t),s=t.getBoundingClientRect();e.position!==d.absolute&&e.position!==d.fixed&&(n=Math.min(s.top-parseFloat(e.marginTop),n),i=Math.max(s.bottom+parseFloat(e.marginBottom),i),o++)}),o>1&&n!==1/0&&i-n>=parseFloat(e.height)-d.flexDelHeightThreshold}tryToFixFlexShrink(){const t=[];this.shouldFixFlexSharink(this.mComponent)&&t.push(this.mComponent),this.mComponent.querySelectorAll("*").forEach(e=>{e instanceof HTMLElement&&this.shouldFixFlexSharink(e)&&t.push(e)});let e=0;return t.forEach(t=>{Array.from(t.children).forEach(t=>{let n=getComputedStyle(t);n.position!==d.absolute&&n.position!==d.fixed&&(O.setStyle(t,d.flex_shrink,"0"),this.needRestoreStyleNodes.add(t),e++)})}),t.length,e>0}fixButtonOverlap(){t.popupRelayout;const e=this.mComponent.querySelectorAll('[class*="close"]');if(1!==e.length)return e.length,void t.popupRelayout;const n=e[0];n.className,t.popupRelayout;const i=n.getBoundingClientRect(),o=window.innerWidth/2,s=i.left+i.width/2;if(Math.abs(s-o)>d.centerCloseButtonThreshold)return;const a=getComputedStyle(n);this.needLayoutConstraintNodes.add(n);const r=a.transform===d.none?"":a.transform;let l=0;const c=n.getBoundingClientRect().top,u=getComputedStyle(this.bottomNode),p=this.bottomNode.getBoundingClientRect().bottom;n===this.bottomNode?(l=parseFloat(u.height),l.toFixed(2),t.popupRelayout):(l=p-c,l.toFixed(2),p.toFixed(0),c.toFixed(0),t.popupRelayout),l/=this.scale;let h=`${r} translate(0px, ${l}px)`;O.setStyle(n,d.transform,h),O.setStyle(n,d.transition,`all ${this.scaleAnimationDuration}ms ease-in`),this.needRestoreStyleNodes.add(n),l.toFixed(2),t.popupRelayout}}const Y={features:["root_position","has_mask","root_screen_area_ratio","root_is_visiable","has_close_button","mask_area_ratio","mask_position"],coefficients:[-.008,.565,1.012,-.214,.377,2.006,.868],intercept:3.593,scalerMean:[3.546,.948,47.741,.588,.856,80.64,4.165],scalerScale:[.557,.221,48.176,.492,.351,38.879,.621]},Z={sticky:1,relative:2,static:3,fixed:4,absolute:5};class j{static preprocessFeatures(t){var e,n;const i={},o=String(t.root_position).toLowerCase();i.root_position=null!==(e=Z[o])&&void 0!==e?e:NaN;const s=String(t.mask_position).toLowerCase();return i.mask_position=null!==(n=Z[s])&&void 0!==n?n:NaN,i.has_mask=t.has_mask?1:0,i.root_is_visiable=t.root_is_visiable?1:0,i.has_close_button=t.has_close_button?1:0,i.root_screen_area_ratio=t.root_screen_area_ratio,i.mask_area_ratio=t.mask_area_ratio,i}static predictIsPopup(e){const n=j.preprocessFeatures(e);let i=Y.intercept;for(let r=0;r<Y.features.length;r++){const e=Y.features[r],o=n[e];if(void 0===o||isNaN(o))return a.w(`预处理后的特征 '${e}' 是 undefined 或 NaN，返回非弹窗预测`,t.popupRecog),{prediction:0,probability:0};{const t=(o-Y.scalerMean[r])/Y.scalerScale[r];i+=Y.coefficients[r]*t}}const o=(s=i,1/(1+Math.exp(-s)));var s;return{prediction:o>=.5?1:0,probability:o}}}class X{static isStickyComponentVisiable(t){const e=[t,...t.children];for(;e.length>0;){const t=e.shift();if(!(t instanceof HTMLElement))continue;const n=getComputedStyle(t),i=t.offsetWidth,o=t.offsetHeight;if("none"===n.display||"hidden"===n.visibility||0===parseFloat(n.opacity))continue;if(0===i||0===o||G.isColorTransparent(n.backgroundColor)&&!n.backgroundImage.includes("url")){e.push(...t.children);continue}return Math.abs(i-screen.availWidth)<2}return!1}static getPotentialElements(t){const e=Array.from(t.getElementsByTagName("*")).filter(t=>t.nodeType===Node.ELEMENT_NODE);let n=new Array,i=null,o=null;for(const s of e){const t=getComputedStyle(s);if(!this.isElementQualified(s,t))continue;if(this.isPotentialMask(s,t)){n.push(s);continue}const e=this.checkStickyElement(s,t,i,o);i=e.potentialStickyTop,o=e.potentialStickyBottom}return{potentialMasks:n,potentialStickyTop:i,potentialStickyBottom:o}}static isElementQualified(t,e){const n=t.offsetWidth>0&&t.offsetHeight>0&&"none"!==e.display&&"hidden"!==e.visibility&&parseFloat(e.opacity)>0,i="hidden"!==e.visibility&&0===parseFloat(e.opacity)&&G.isColorSemiTransparent(e.backgroundColor);return!(!n&&!i)&&!(Math.abs(t.offsetWidth-window.innerWidth)>=2)}static isPotentialMask(e,n){const i=G.getScreenAreaRatio(e),o=l.getInstance().getMinMaskAreaRatioThreshold(),s=e.getBoundingClientRect(),a=s.height/s.width;if(a>d.maxMaskAspectRatio)return e.className,a.toFixed(2),s.width.toFixed(0),s.height.toFixed(0),t.popupDetector,!1;if(i>o&&G.isBackgroundSemiTransparent(n))return e.className,i.toFixed(2),t.popupDetector,!0;if(i>o&&n.position===d.fixed&&1===e.children.length){const n=e.children[0];if(getComputedStyle(n).position===d.absolute&&G.getScreenAreaRatio(n)>l.getInstance().getMinContentAreaRatioThreshold()&&G.hasCloseButton(n))return e.className,t.popupDetector,!0}return!("fixed"!==n.position||!k.analyzeComputedBoxShadow(n.boxShadow))&&(e.className,t.popupDetector,!0)}static checkStickyElement(t,e,n,i){let o=n,s=i;const a=G.getScreenAreaRatio(t);return"fixed"===e.position&&0===parseInt(e.left)&&a>l.getInstance().getMinSARTofStickyComponent()&&a<l.getInstance().getMaxSARTofStickyComponent()&&X.isStickyComponentVisiable(t)?(0===parseInt(e.top)&&(t.className,(null===o||X.isFirstElementOnTop(t,o))&&(o=t)),0===parseInt(e.bottom)&&(t.className,(null===s||X.isFirstElementOnTop(t,s))&&(s=t)),{potentialStickyTop:o,potentialStickyBottom:s}):{potentialStickyTop:n,potentialStickyBottom:i}}static isFirstElementOnTop(t,e){if(!t||!e)return!1;const n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=Math.max(n.left,i.left),s=Math.max(n.top,i.top),a=Math.min(n.right,i.right),r=Math.min(n.bottom,i.bottom);if(a<=o||r<=s)return!1;const l=o+(a-o)/2,c=s+(r-s)/2,u=document.elementFromPoint(l,c);return!!u&&(u!==e&&!e.contains(u))}static findPopups(e){t.popupDetector;const n=X.getPotentialElements(e);n.potentialMasks.length,t.popupDetector,n.potentialStickyTop&&(n.potentialStickyTop.className,t.popupDetector),n.potentialStickyBottom&&(n.potentialStickyBottom.className,t.popupDetector);const i=X.findPopupsInternal(n);return t.popupDetector,i}static findTopMostPopup(t){return t&&0!==t.length?t.reduce((t,e)=>k.compareZIndex(t.root_node,e.root_node)>=0?t:e):null}static findBestCandidateInSibling(e,n,i){t.popupDetector,e.className||e.tagName,t.popupDetector,n.className||n.tagName,t.popupDetector;let o=null,s=0;const a=[e,...Array.from(e.querySelectorAll("*"))];t.popupDetector;const r=X.isPreviousElementSibling(n,e);t.popupDetector,t.popupDetector;for(const l of a){const e=k.compareZIndex(l,n),i=r?e>0:e>=0;G.zIndexToNumber(window.getComputedStyle(l).zIndex);if(i){0;const e=G.getScreenAreaRatio(l);if(e>s){o&&(o.className||o.tagName,s.toFixed(2));s=e,o=l,l.className||l.tagName,e.toFixed(2),t.popupDetector}}else 0}return t.popupDetector,o?(o.className||o.tagName,s.toFixed(2),t.popupDetector):t.popupDetector,{candidate:o,ratio:s}}static findBestSiblingContent(e){e.className,t.popupDetector;let n=null,i=0;const o=G.zIndexToNumber(window.getComputedStyle(e).zIndex),[s,a]=G.findSiblingContent(e);s.length,t.popupDetector;for(const l of s){const s=this.findBestCandidateInSibling(l,e,o);s.ratio>i&&(i=s.ratio,n=s.candidate,i.toFixed(2),t.popupDetector)}const r=i>=l.getInstance().getMinContentAreaRatioThreshold();return t.popupDetector,r?[n,a]:[null,null]}static findPopupsInternal(e){const{potentialMasks:n,potentialStickyTop:i,potentialStickyBottom:o}=e;if(!n||0===n.length)return t.popupDetector,null;n.sort((t,e)=>G.getElementDepth(e)-G.getElementDepth(t)),G.getElementDepth(n[0]),t.popupDetector;const s=n.map(t=>this.identifyPopupFromMask(t)).filter(t=>null!==t);if(0===s.length)return t.popupDetector,null;s.length,t.popupDetector;const a=this.filterNestedPopups(s),r=this.filterByPrediction(a),l=X.findTopMostPopup(r);return l?(l.root_node.className,l.popup_type,t.popupDetector,this.updateStickyHeights(l,{potentialStickyTop:i,potentialStickyBottom:o}),l):(t.popupDetector,null)}static identifyPopupFromMask(e){e.className,t.popupDetector;const n=this.determinePopupStructure(e);if(!n)return t.popupDetector,null;const{rootNode:i,contentNode:o,popupType:s}=n;return i.className,t.popupDetector,{info:this.createPopupInfo(i,e,o,s),node:i}}static determinePopupStructure(t){const[e,n]=X.findBestSiblingContent(t);if(e&&n){const i=t.parentNode;if(!(i&&i instanceof Element))return null;const o=getComputedStyle(i);return!("none"===o.display||"hidden"===o.visibility||0===parseFloat(o.opacity))?{contentNode:e,rootNode:n,popupType:x.B}:null}return this.findDescendantBasedPopup(t)}static findDescendantBasedPopup(e){const n=X.findBestDescendantContent(e);if(!n||!G.visualFilter(e))return t.popupDetector,null;const i=window.getComputedStyle(e).position;if(t.popupDetector,"fixed"===i||"absolute"===i)return t.popupDetector,{contentNode:n,rootNode:e,popupType:x.C};{const i=this.findPositionedAncestor(e)||e.parentElement;if(i)return i.className,t.popupDetector,{contentNode:n,rootNode:i,popupType:x.A}}return null}static findPositionedAncestor(t){let e=t.parentElement;for(;e&&e!==document.body;){const t=window.getComputedStyle(e).position;if("fixed"===t||"absolute"===t)return e;e=e.parentElement}return null}static filterNestedPopups(e){e.length,t.popupDetector;const n=new Set;for(const o of e)for(const i of e){if(o===i)continue;let e=!1;if(o.node!==i.node)e=o.node.contains(i.node);else{const t=o.info.mask_node,n=i.info.mask_node;e=t!==n&&t.contains(n)}if(e){n.add(o.info),o.node.className,t.popupDetector;break}}const i=e.map(t=>t.info).filter(t=>!n.has(t));return i.length,t.popupDetector,i}static filterByPrediction(e){e.length,t.popupDetector;const n=e.filter(e=>{if(e.has_mask&&e.mask_area_ratio>95&&("fixed"===e.mask_position||"absolute"===e.mask_position))return e.root_node.className,t.popupDetector,!0;const n=j.predictIsPopup(e);return n.prediction,e.root_node.className,t.popupDetector,n.prediction});return n.length,t.popupDetector,n}static updateStickyHeights(t,e){const{potentialStickyTop:n,potentialStickyBottom:i}=e;n&&k.compareZIndex(t.mask_node,n)<=0&&!t.root_node.contains(n)&&(t.stickyTop_height=parseInt(getComputedStyle(n).height,10)||0),i&&k.compareZIndex(t.mask_node,i)<=0&&!t.root_node.contains(i)&&(t.stickyBottom_height=parseInt(getComputedStyle(i).height,10)||0)}static createPopupInfo(t,e,n,i){const o=window.getComputedStyle(t),s=window.getComputedStyle(e);return{root_node:t,mask_node:e,content_node:n,popup_type:i,root_position:o.position,root_zindex:G.zIndexToNumber(o.zIndex),has_mask:!0,root_screen_area_ratio:G.getScreenAreaRatio(t),root_is_visiable:G.isElementVisibleInViewPort(t),has_close_button:G.hasCloseButton(n||t),mask_area_ratio:G.getScreenAreaRatio(e),mask_position:s.position,mask_zindex:G.zIndexToNumber(s.zIndex),stickyTop_height:0,stickyBottom_height:0}}static isPreviousElementSibling(t,e){if(!t||!e||t.parentNode!==e.parentNode)return!1;let n=t.previousElementSibling;for(;n;){if(n===e)return!0;n=n.previousElementSibling}return!1}static isMaskNodeActive(e){if(!e)return!1;if(!e.isConnected)return t.popupDetector,!1;try{const n=window.getComputedStyle(e);return this.isElementQualified(e,n)&&!!this.isPotentialMask(e,n)||(e.className,t.popupDetector,!1)}catch(n){return e.className,t.popupDetector,!1}}}X.findBestDescendantContent=e=>{e.className,t.popupDetector;let n=null,i=0;const o=Array.from(e.querySelectorAll("*"));o.length,t.popupDetector;for(const t of o){if(!1===G.visualFilter(t))continue;const e=G.getScreenAreaRatio(t);e>i&&(i=e,n=t)}const s=i>=l.getInstance().getMinContentAreaRatioThreshold();return i.toFixed(2),t.popupDetector,s?n:null};class q{static getActivePopupWindowInfo(){return q.activePopupWindow.popupInfo}static getActivePopupWindowComponent(){return q.activePopupWindow.popupComponent}static setActivePopupWindow(t,e){q.activePopupWindow={popupInfo:t,popupComponent:e}}static clearActivePopupWindow(){q.activePopupWindow={popupInfo:null,popupComponent:null}}static intelligentLayout(t){var e;q.TAG;const n=q.getActivePopupWindowInfo(),i=null!=n?n:X.findPopups(t);if(null===(e=null==i?void 0:i.root_node)||void 0===e||e.className,q.TAG,null!=i)q.calculateForPopWin(i);else{let t={resultCode:d.RESULT_CODE_NO_POPUP,errorMsg:"no popup found",duration:0,report:"no popup found"};window.layoutConstraintResult=t}q.TAG}static removePopwinCache(t){const e=q.getActivePopupWindowInfo();return!(!e||!e.root_node)&&(!!t.contains(e.root_node)&&(e.root_node,q.TAG,V.clearState(e.root_node),q.clearActivePopupWindow(),!0))}static calculateForPopWin(t){var e;if(null===(e=null==t?void 0:t.root_node)||void 0===e||e.className,q.TAG,!V.canStartLayout(t.root_node))return void V.printState(t.root_node,"跳过布局 - 弹窗正在处理中");const n=q.getActivePopupWindowInfo();let i=q.getActivePopupWindowComponent();if(n&&n===t||(i=new z(t),q.setActivePopupWindow(t,i)),i&&i.isDirty())try{i.intelligenceLayout()}catch(o){V.setState(t.root_node,L.FAILED,`布局失败: ${o}`),a.e(`布局失败: ${o}`,q.TAG)}window.popupInfo=t}static markDirty(t){if(!t||G.shouldSkip(t))return;const e=q.getActivePopupWindowInfo(),n=q.getActivePopupWindowComponent();e&&n&&!n.isDirty()&&e.root_node&&e.root_node.contains(t)&&n.setDirty(!0)}static resetPopWindows(t){var e;q.TAG;const n=q.getActivePopupWindowInfo(),i=q.getActivePopupWindowComponent();n&&i?(null===(e=n.root_node)||void 0===e||e.className,q.TAG,i.cancelPendingValidation(),i.restoreStyles(),V.resetState(n.root_node,t),i.setDirty(!0),q.clearActivePopupWindow(),q.TAG):q.clearActivePopupWindow()}static reInit(){q.resetPopWindows("智能布局初始化")}}q.TAG=t.intelligentLayout,q.activePopupWindow={popupInfo:null,popupComponent:null};class K{static reInit(){K.TAG,K.modifyObserver&&(K.TAG,K.modifyObserver.disconnect()),document.body.id,K.TAG,K.TAG,K.modifyObserver=new MutationObserver(K.onElementModify),K.modifyObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),K.addAnimationListeners(),K.TAG}static cancelAllAnimationTimeouts(){const t=K.activeAnimationTimeouts.size;if(t>0){K.TAG;for(const[t,e]of K.activeAnimationTimeouts.entries())clearTimeout(t),e.tagName,e.className,K.TAG;K.activeAnimationTimeouts.clear(),K.TAG}}static addAnimationListeners(){K.animationListenerAdded||(K.TAG,K.animationStartHandler=t=>{K.handleAnimationEvent(t,"animation")},K.transitionStartHandler=t=>{K.handleAnimationEvent(t,"transition")},document.body.addEventListener("animationstart",K.animationStartHandler,!0),document.body.addEventListener("transitionstart",K.transitionStartHandler,!0),K.animationListenerAdded=!0),K.TAG}static handleAnimationEvent(t,e){const n=t.target;"animation"===e&&t instanceof AnimationEvent?(n.tagName,n.className,t.animationName,K.TAG):"transition"===e&&t instanceof TransitionEvent&&(n.tagName,n.className,t.propertyName,K.TAG);const i=K.findPopupRoot(n);K.updatePopupStateOnAnimationStart(i,e);const o=K.getDurationFromElement(n);K.createAnimationTimeout(n,i,o,e)}static updatePopupStateOnAnimationStart(t,e){if(!t)return;const n=V.getState(t);if(n===L.IDLE){const n="animation"===e?"检测到动画开始":"检测到过渡开始";V.setState(t,L.WAITING_ANIMATION,n)}else L[n],K.TAG}static createAnimationTimeout(t,e,n,i){if(n<=0)return;K.TAG;const o=setTimeout(()=>{K.activeAnimationTimeouts.delete(o);if(K.TAG,e&&V.getState(e)===L.WAITING_ANIMATION){const t="animation"===i?"动画完成":"过渡完成";V.setState(e,L.IDLE,t)}et.postTask()},n);K.activeAnimationTimeouts.set(o,t)}static findPopupRoot(t){const e=q.getActivePopupWindowInfo();return(null==e?void 0:e.root_node)&&e.root_node.contains(t)?e.root_node:null}static disconnect(){var t;K.TAG;const e=K.pendingRecords.length;e>0&&a.w(`清理 ${e} 个待处理的变更记录`,K.TAG),null===(t=K.modifyObserver)||void 0===t||t.disconnect(),K.modifyObserver=null,K.pendingRecords=[],K.scheduledWork=!1,K.cancelAllAnimationTimeouts(),K.animationListenerAdded&&(K.TAG,K.animationStartHandler&&(document.body.removeEventListener("animationstart",K.animationStartHandler,!0),K.animationStartHandler=null),K.transitionStartHandler&&(document.body.removeEventListener("transitionstart",K.transitionStartHandler,!0),K.transitionStartHandler=null),K.animationListenerAdded=!1,K.TAG),K.TAG}static handleRemove(t){if(0===t.length)return!1;t.length,K.TAG;let e=!1;for(const n of t){for(let t=0;t<n.removedNodes.length;t++){let i=n.removedNodes[t];if(i.nodeType!==Node.ELEMENT_NODE)continue;0;const o=q.removePopwinCache(i);o&&(i.tagName,i.className,K.TAG),e=e||o,v.resetEle(i,!0)}v.resetParent(n.target)}return K.TAG,e}static checkElementAddNeedPostTask(t){let e=!1,n=0,i=0;for(let o=0;o<t.addedNodes.length;o++){const s=t.addedNodes[o];s.nodeType===Node.ELEMENT_NODE&&(s.tagName,s.className,K.TAG,s.style.display!==d.none?(s.tagName,s.className,K.TAG,n++,e=!0):(s.tagName,s.className,K.TAG,i++))}return(n>0||i>0)&&K.TAG,e}static onElementModify(t){t.length,K.TAG,K.pendingRecords.push(...t),K.scheduledWork?(K.pendingRecords.length,K.TAG):(K.TAG,K.scheduledWork=!0,queueMicrotask(()=>{const t=K.pendingRecords;K.pendingRecords=[],K.scheduledWork=!1,t.length,K.TAG,K.processBatch(t)}))}static processBatch(t){if(0===t.length)return void K.TAG;if(!K.checkMaskNodeExistence())return void K.TAG;t.length,K.TAG;const e=[],n=[],i=[];for(let l=0;l<t.length;l++){const o=t[l];o.removedNodes.length>0&&e.push(o),o.addedNodes.length>0&&n.push(o),"attributes"===o.type&&i.push(o)}e.length,n.length,i.length,K.TAG;const o=K.handleRemove(e);K.TAG;let s=K.calculateAnimationDuration(n,i);if(s>0){K.TAG;const t=setTimeout(()=>{K.activeAnimationTimeouts.delete(t),K.TAG,et.postTask()},s);K.activeAnimationTimeouts.set(t,document.body)}const a=K.handleAttributeChanges(i);K.TAG;const r=K.handleAddedNodes(n);0===s&&(o||r||a)?(K.TAG,et.postTask()):K.TAG,K.TAG}static handleAddedNodes(t){let e=!1;if(0===t.length)return K.TAG,!1;t.length,K.TAG;for(let n=0;n<t.length;n++){K.checkElementAddNeedPostTask(t[n])&&(e=!0,q.markDirty(t[n].target))}return K.TAG,e}static handleAttributeChanges(t){let e=!1;if(0===t.length)return!1;for(const n of t)if("style"===n.attributeName){const t=n.target;q.markDirty(t),e=!0}return e&&K.TAG,e}static calculateAnimationDuration(t,e){let n=0;if(0===t.length&&0===e.length)return K.TAG,n;t.length,e.length,K.TAG;const i=new Set;return n=K.getAnimationDurationInAttriChange(e,i,n),n=K.getAnimationDurationInAddNodes(t,i,n),n>0?(i.size,K.TAG):K.TAG,n}static processAddedNode(t,e,n){if(!(t instanceof HTMLElement)||e.has(t))return{newDuration:n,detected:!1};e.add(t);const i=K.getDurationFromElement(t);let o=!1;return i>0&&(t.tagName,t.className,K.TAG,o=!0),{newDuration:Math.max(i,n),detected:o}}static getAnimationDurationInAddNodes(t,e,n){let i=0;for(let o=0;o<t.length;o++){const s=t[o].addedNodes;for(let t=0;t<s.length;t++){const o=K.processAddedNode(s[t],e,n);n=o.newDuration,o.detected&&i++}}return i>0&&K.TAG,n}static getAnimationDurationInAttriChange(t,e,n){let i=0;for(let o=0;o<t.length;o++){const s=t[o].target;t[o].attributeName;if(s instanceof HTMLElement&&!e.has(s)){e.add(s);const t=K.getDurationFromElement(s);t>0&&(s.tagName,s.className,K.TAG,i++),t>n&&(n=t,q.markDirty(s))}}return i>0&&K.TAG,n}static getDurationFromElement(t){const e=K.getAnimDurations(t),n=Math.max(e.animationDur,e.transitionDur);return n>0&&(e.animationDur,e.transitionDur,K.TAG),n}static cssTimeToMs(t){if(!t||"0s"===t||"0ms"===t)return 0;const e=t.split(",").map(t=>t.trim()).filter(t=>t.length>0),n=/^([\d.]+)(s|ms)$/;let i=0;for(const o of e){const t=o.trim().match(n);if(!t)return K.TAG,0;const[,e,s]=t,a="s"===s?1e3*parseFloat(e):parseFloat(e);i=Math.max(i,a)}return i}static getAnimDurations(t){const e=getComputedStyle(t),n=K.cssTimeToMs(e.animationDuration),i=K.cssTimeToMs(e.transitionDuration),o=n+i;return o>0&&(t.tagName,t.className,e.animationDuration,e.transitionDuration,K.TAG),{animationDur:n,transitionDur:i,total:o}}static checkMaskNodeExistence(){var t;const e=q.getActivePopupWindowInfo();if(!e)return!0;if(!K.isMaskNodeValid(e)){const n=`检测到遮罩节点失效: ${(null===(t=null==e?void 0:e.mask_node)||void 0===t?void 0:t.className)||"unknown-mask"}`;return K.resetPopup(n),et.postTask(),!1}return!0}static isMaskNodeValid(t){return!!t&&(t.root_node&&t.root_node.isConnected?!!X.isMaskNodeActive(t.mask_node):(K.TAG,!1))}static resetPopup(t){K.TAG;const e=q.getActivePopupWindowInfo(),n=q.getActivePopupWindowComponent();n instanceof z&&(n.cancelPendingValidation(),n.restoreStyles()),(null==e?void 0:e.root_node)&&V.resetState(e.root_node,t),q.clearActivePopupWindow()}}K.TAG=t.modifyObserver,K.pendingRecords=[],K.scheduledWork=!1,K.animationListenerAdded=!1,K.animationStartHandler=null,K.transitionStartHandler=null,K.activeAnimationTimeouts=new Map;class J{static reInit(){J.TAG,J.TAG,J.contentReady=!1,J.disconnect(),J.TAG}static isContentReady(){if(J.TAG,J.contentReady)return J.TAG,!0;J.TAG;return J.checkPageContent()?(J.TAG,J.contentReady=!0,J.disconnect(),!0):(a.w("⚠️ 页面内容未就绪（骨架屏/白屏状态）",J.TAG),!1)}static startObserving(){if(J.observer)return void J.TAG;J.TAG,J.TAG;J.observer=new MutationObserver(()=>{J.TAG,J.checkPageContent()?(J.TAG,J.contentReady=!0,J.disconnect(),J.TAG,et.postTask()):J.TAG}),document.body?(J.observer.observe(document.body,{childList:!0,subtree:!0}),J.TAG):a.e("document.body不存在，无法启动观察器",J.TAG)}static disconnect(){J.observer&&(J.TAG,J.observer.disconnect(),J.observer=null)}static checkPageContent(){J.TAG;const t=document.body;if(!t)return a.e("document.body不存在",J.TAG),!1;const e=performance.now();let n=J.checkMeaningfulNodeRecursive(t);(performance.now()-e).toFixed(2);const i=n>J.MIN_NODE_THRESHOLD;return J.MIN_NODE_THRESHOLD,J.TAG,i}static checkMeaningfulNodeRecursive(t,e=0){let n=0;if(t instanceof HTMLElement){const i=getComputedStyle(t);if("none"===i.display||"hidden"===i.visibility||"0"===i.opacity)return 0===e&&(t.tagName,t.className,J.TAG),n}if(["DIV","P","SPAN","A","IMG","BUTTON","INPUT","TEXTAREA","UL","LI","H1","H2","H3","H4","H5","H6","SECTION","ARTICLE","NAV","HEADER","FOOTER","MAIN"].includes(t.tagName)&&(n++,n>J.MIN_NODE_THRESHOLD))return J.TAG,n;if(t.children.length>0&&n<=J.MIN_NODE_THRESHOLD){const i=Math.min(t.children.length,J.MAX_CHECK_CHILDREN);t.children.length>i&&(t.tagName,t.children.length,J.TAG);for(let o=0;o<i&&(n+=J.checkMeaningfulNodeRecursive(t.children[o],e+1),!(n>J.MIN_NODE_THRESHOLD));o++);}return n}static reset(){J.TAG,J.contentReady=!1,J.disconnect()}}J.TAG="PageContentObserver",J.contentReady=!1,J.observer=null,J.MIN_NODE_THRESHOLD=9,J.MAX_CHECK_CHILDREN=50;class Q{static bodyReady(e){t.framework,function n(){if(!document.body||innerWidth<=100){document.body&&innerWidth;return Q.tryTimes,t.framework,Q.tryTimes>=0?setTimeout(n,50):a.e("❌ Body就绪检测超时，已达最大尝试次数",t.framework),void Q.tryTimes--}innerWidth,t.framework,Q.hasBodyReady=!0,t.framework,e()}()}static viewportReady(e){let n;function i(){let i=document.querySelector('meta[name="viewport"]');if(!i)return t.framework,!1;i.getAttribute("content");return t.framework,n&&(t.framework,n.disconnect(),n=null),t.framework,e(),!0}t.framework,i()||(t.framework,n=new MutationObserver(()=>{t.framework,i()}),n.observe(document.head,{childList:!0}))}static checkDOMReady(e){if(!e)return t.framework,!1;e.children.length;return t.framework,!0}static waitForSystemReady(){t.framework,Q.sysReady=Q.checkDOMReady(document.body),!1===Q.sysReady?(t.framework,setTimeout(Q.waitForSystemReady,200)):(t.framework,st.start_())}static headReady(e){if(t.framework,Q.tryHead--,Q.tryHead<0)return void a.e("❌ Head就绪检测超时，已达最大尝试次数",t.framework);if(!document.head)return Q.tryHead,t.framework,void setTimeout(()=>{this.headReady(e)},10);document.head.querySelectorAll("link").length,document.head.querySelectorAll("style").length;t.framework,t.framework,e()}static configReady(e){t.framework,t.framework,e()}}Q.tryTimes=1e3,Q.hasBodyReady=!1,Q.tryHead=100,Q.sysReady=!1,Q.elementCount=0;class tt{static init_(){tt.TAG,tt.init||(tt.init=!0,window.innerWidth,window.innerHeight,tt.TAG,tt.TAG,window.addEventListener(d.resize,tt.resizeCallback)),tt.TAG}static resizeCallback(){if(tt.TAG,window.innerWidth,window.innerHeight,tt.TAG,window.innerWidth,window.innerHeight,screen.width,screen.height,tt.TAG,st.initFlag)return tt.TAG,void tt.onResize();a.w("系统未初始化，触发重启",tt.TAG),st.restart()}static onResize(){tt.TAG,Q.hasBodyReady?(tt.TAG,K.cancelAllAnimationTimeouts(),tt.TAG,q.resetPopWindows("窗口尺寸变化"),tt.TAG,ot.headReadyTask(),tt.TAG,et.updateObserver(),a.checkState("after updateObserver"),tt.TAG,w.updateState(),tt.TAG,et.postTask(),tt.TAG):a.w("document.body未就绪，跳过resize处理",tt.TAG)}static removeListener(){tt.TAG,tt.init?(tt.TAG,tt.init=!1,removeEventListener(d.resize,tt.resizeCallback),tt.TAG):tt.TAG}}tt.TAG=t.resizeObserver,tt.init=!1;class et{static postTask(){et.relayoutHandler.postTask(),t.observerHandler}static reInit(){t.observerHandler,t.observerHandler,K.reInit(),t.observerHandler,J.reInit(),t.observerHandler,tt.init_(),et.relayoutHandler||(et.TIMEOUT,t.observerHandler,et.relayoutHandler=new D(et.TIMEOUT,ot.mainTask)),t.observerHandler,setTimeout(()=>{et.postTask()},400),t.observerHandler}static updateObserver(){t.observerHandler,ot.stopFlag&&(a.w("Framework已停止，移除尺寸监听器",t.observerHandler),tt.removeListener()),I.isWideScreen()?t.observerHandler:(a.w(`窄屏检测: ${screen.availWidth}×${screen.availHeight}，移除观察器`,t.observerHandler),et.removeObserver())}static removeObserver(){t.observerHandler,t.observerHandler,K.disconnect(),t.observerHandler,J.disconnect(),t.observerHandler}static nextRoundAndPost(e){e.tagName,e.className,t.observerHandler,et.nextRound(e),et.postTask()}static nextRound(e){e.tagName,e.className,t.observerHandler,E.setValue(e,h,p.NEXT_ROUND),E.nextRoundCache.push(e),E.nextRoundCache.length,t.observerHandler}}et.TIMEOUT=200;var nt=n(650),it=n.n(nt);class ot{static isAvailable(){return!ot.stopFlag||(ot.TAG,!1)}static taskinit(){ot.TAG,ot.startTime||(ot.startTime=(new Date).getTime(),ot.startTime,ot.TAG);const t=I.isWideScreen(),e=ot.isAvailable();if(ot.TAG,!t||!e)return ot.TAG,!1;if(!ot.needRunTask())return ot.TAG,et.postTask(),!1;if(ot.TAG,b.clearStyleCache(),!J.isContentReady()){ot.TAG,J.startObserving();const t={resultCode:d.RESULT_CODE_PAGE_CONTENT_NOT_READY,errorMsg:"页面内容未就绪，等待内容加载",duration:0,report:"启动内容观察器，响应式等待"};return window.layoutConstraintResult=t,!1}return ot.TAG,!0}static mainTask(){ot.TAG;const t=performance.now();if(!ot.taskinit())return void ot.TAG;if(l.getInstance().checkRule()===s.outOfWhiteList)return a.w("检查不通过:Appid:"+l.getInstance().getAppID()+", Page:"+l.getInstance().getPage(),ot.TAG),void st.stop();if(l.getInstance().checkRule()===s.initial)return void ot.TAG;let e=l.getInstance().getAutoLayoutStrategyType();if(ot.TAG,l.getInstance().isPopupScaleEnable(e)){ot.TAG,q.intelligentLayout(document.body),ot.TAG,O.flushAllStyles(),b.clearStyleCache();(performance.now()-t).toFixed(2);ot.TAG,ot.TAG}if(l.getInstance().isAlphabetNavigatorEnable(e)){ot.TAG;const t={alphabetIdentificationMinSize:l.getInstance().getAlphabetIdentificationMinSize(),alphabetHeightWidthMinRatio:l.getInstance().getAlphabetHeightWidthMinRatio()},e=JSON.stringify(t);it().start(e),l.getInstance().setAlphabetNavigatorFixExecuted(!0)}}static reInit(){ot.TAG,I.isWideScreen()?(ot.TAG,c.init(),b.clearAllCache(),ot.TAG,ot.TAG,w.reInit(),ot.TAG,q.reInit(),ot.TAG,et.reInit(),ot.TAG,ot.stopFlag=!1,ot.startTime=0,ot.TAG):ot.TAG}static configReady(){ot.TAG,Q.headReady(ot.headReadyTask)}static headReadyTask(){ot.TAG,Q.bodyReady(ot.reInit)}static needRunTask(){return ot.TAG,ot.cssIsComplete()?(ot.TAG,!0):(a.w("⚠️ CSS样式表尚未加载完成，暂不执行任务",ot.TAG),!1)}static cssIsComplete(){var t;ot.TAG;const e=document.head;let n=[];for(let o=0;o<e.children.length;o++){const i=e.children[o];if(i.localName===d.link){const e=i,o=e.getAttribute(d.rel),s=e.getAttribute(d.href);if(o!==d.stylesheet||""===s||!s)continue;(null===(t=e.href)||void 0===t?void 0:t.startsWith("http"))&&!e.sheet?(ot.TAG,n.push(s)):0}}const i=0===n.length;return ot.TAG,i||(n.join(", "),ot.TAG),i}}ot.TAG=t.framework,ot.stopFlag=!1;class st{static start(t){l.getInstance().fromJson(t)&&st.start_()}static start_(){I.isWideScreen()&&(st.initFlag||(Q.configReady(ot.configReady),st.initFlag=!0))}static stop(){ot.stopFlag=!0}static restart(){ot.stopFlag=!1,st.start_()}static alphabetStart(t){it().start(t)}}st.initFlag=!1})(),i})());
//# sourceMappingURL=autolayout.min.js.map