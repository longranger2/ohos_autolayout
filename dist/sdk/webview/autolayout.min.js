!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoLayout=e():t.AutoLayout=e()}(self,()=>(()=>{"use strict";var t,e,n={d:(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};n.r(o),n.d(o,{Main:()=>nt});class i{}i.framework="Framework",i.intelligentLayout="IntelligentLayout",i.observerHandler="ObserverHandler",i.resizeObserver="ResizeObserver",i.modifyObserver="ModifyObserver",i.pageContentObserver="PageContentObserver",i.throttle="Throttle",i.popupDecisionTree="PopupDecisionTree",i.popupRecog="PopupRecog",i.popupDetector="PopupDetector",i.popupRelayout="PopupRelayout",i.popupStateManager="PopupStateManager",i.layoutConstraintDetector="LayoutConstraintDetector",i.layoutUtils="LayoutUtils",i.util="Utils",i.ccmConfig="CCMConfig",i.styleSetter="StyleSetter",i.styleGetter="StyleGetter",i.styleCleaner="StyleCleaner",i.cssSheetManage="CSSSheetManage",i.domReader="DomReader",i.originStyleCache="OriginStyleCache",i.store="Store",i.record="Record",i.diffRecorder="DiffRecorder",i.zoomFont="ZoomFont",i.performance="Performance",i.visual="Visual",i.state="State",i.cache="Cache",i.debug="Debug",i.component="Component",i.node="Node",function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR"}(t||(t={}));class s{static formatTimestamp(){const t=new Date;return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}.${String(t.getMilliseconds()).padStart(3,"0")}`}static setLevel(t){s.currentLevel=t}static getLevel(){return s.currentLevel}static d(t,e){0}static debug(t,e,n){0}static i(t,e,n){0}static info(t,e){0}static w(e,n){if(s.currentLevel<=t.WARN){const t=s.formatTimestamp(),o=n?`[${n}]`:"[WARN]";console.warn(`[${t}] ${o} ${e}`)}}static warn(e,n,o){if(s.currentLevel<=t.WARN){const t=s.formatTimestamp(),i=o?`[${o}]`:"[WARN]",a=e?`${e.tagName}.${e.className||"no-class"}`:"null";console.warn(`[${t}] ${i} [${a}] ${n}`)}}static e(e,n,o){if(s.currentLevel<=t.ERROR){const t=s.formatTimestamp(),i=n?`[${n}]`:"[ERROR]";console.error(`[${t}] ${i} ${e}`,o||"")}}static error(e,n,o,i){if(s.currentLevel<=t.ERROR){const t=s.formatTimestamp(),a=o?`[${o}]`:"[ERROR]",r=e?`${e.tagName}.${e.className||"no-class"}`:"null";console.error(`[${t}] ${a} [${r}] ${n}`,i||"")}}static taskTimes(){0}static showValue(t,e,n){0}static deleteValue(t,e){0}static clearTag(t,e){0}static logCaller(t){0}static checkState(t){0}}s.currentLevel=t.WARN,function(t){t[t.initial=1]="initial",t[t.inWhiteList=2]="inWhiteList",t[t.outOfWhiteList=3]="outOfWhiteList"}(e||(e={}));const a={minMaskAreaRatioThreshold:1,opacityFilter:[0,100],minContentAreaRatioThreshold:15,scrollNodePattern:["srcoll","List","swiper"],closeButtonPattern:["close","guanbi","dele"],buttonPattern:["button","btn"],scaleAnimationDuration:100,minScaleFactor:55,breakpoints:[{widthRange:{min:320,max:500},aspectRatioRange:{min:.61,max:1.63}},{widthRange:{min:580,max:900},aspectRatioRange:{min:.7,max:2}},{widthRange:{min:1e3,max:1150},aspectRatioRange:{min:1.3,max:1.45}}],appRuleInfos:[{id:"000",pg:["home"]}],minSARTofStickyComponent:5,maxSARTofStickyComponent:45};class r{constructor(t){this._minMaskAreaRatioThreshold=t.minMaskAreaRatioThreshold,this._opacityFilter=t.opacityFilter,this._minContentAreaRatioThreshold=t.minContentAreaRatioThreshold,this._scrollNodePattern=t.scrollNodePattern,this._closeButtonPattern=t.closeButtonPattern,this._buttonPattern=t.buttonPattern,this._scaleAnimationDuration=t.scaleAnimationDuration,this._minScaleFactor=t.minScaleFactor,this._breakpoints=t.breakpoints,this._appRuleInfos=t.appRuleInfos,this.appId="",this.page="",this.checkRuleStateResult=e.initial,this._minSARTofStickyComponent=t.minSARTofStickyComponent,this._maxSARTofStickyComponent=t.maxSARTofStickyComponent}getMinMaskAreaRatioThreshold(){return this._minMaskAreaRatioThreshold}getMinSARTofStickyComponent(){return this._minSARTofStickyComponent}getMaxSARTofStickyComponent(){return this._maxSARTofStickyComponent}getOpacityFilter(){return this._opacityFilter}getMinContentAreaRatioThreshold(){return this._minContentAreaRatioThreshold}setMinContentAreaRatioThreshold(t){this._minContentAreaRatioThreshold=t}getscrollNodePattern(){return this._scrollNodePattern}getcloseButtonPattern(){return this._closeButtonPattern}getButtonPattern(){return this._buttonPattern}getScaleAnimationDuration(){return this._scaleAnimationDuration}getMinScaleFactor(){return this._minScaleFactor}getAppID(){return this.appId}getPage(){return this.page}findAspectRatioRange(t){for(const e of this._breakpoints)if(t>=e.widthRange.min&&t<=e.widthRange.max)return e.aspectRatioRange}update(t){this._minMaskAreaRatioThreshold=t.minMaskAreaRatioThreshold,this._opacityFilter=t.opacityFilter,this._minContentAreaRatioThreshold=t.minContentAreaRatioThreshold,this._scaleAnimationDuration=t.scaleAnimationDuration,this._minScaleFactor=t.minScaleFactor,this._appRuleInfos="string"==typeof t.appRuleInfos?JSON.parse(t.appRuleInfos):t.appRuleInfos}fromJson(t){try{const e=JSON.parse(t);this.update(e)}catch(e){return s.e("Failed to parse ProductConfig from JSON",i.ccmConfig,e),!1}return!0}static getInstance(){return r.instance||(r.instance=new r(a)),r.instance}checkRule(){if(this.checkRuleStateResult!==e.initial)return this.checkRuleStateResult;const t=String("function"==typeof window._getAppId_?window._getAppId_():""),n=String("function"==typeof window._getPage_?window._getPage_():"");if(!t||""===t||!n||""===n)return i.ccmConfig,e.initial;this.appId=t,this.page=n;for(const o of this._appRuleInfos){const i="*"===o.id||o.id===t,s=o.pg.includes("*")||o.pg.includes(n);if(i&&s)return this.checkRuleStateResult=e.inWhiteList,this.checkRuleStateResult}return this.checkRuleStateResult=e.outOfWhiteList,this.checkRuleStateResult}}class l{static init(){this.offsetHeightCache||(this.offsetHeightCache=this.createSpecStyleCache(t=>t.offsetHeight),this.offsetWidthCache=this.createSpecStyleCache(t=>t.offsetWidth),this.offsetTopCache=this.createSpecStyleCache(t=>t.offsetTop),this.offsetLeftCache=this.createSpecStyleCache(t=>t.offsetLeft),this.scrollHeightCache=this.createSpecStyleCache(t=>t.scrollHeight),this.scrollWidthCache=this.createSpecStyleCache(t=>t.scrollWidth),this.childCountCache=this.createSpecStyleCache(t=>t.childElementCount),this.getRectCache=this.createSpecStyleCache(t=>t.getBoundingClientRect()),this.getComputedStyleCache=this.createSpecStyleCache(getComputedStyle),this.localNameCache=this.createSpecStyleCache(t=>t.localName))}static createSpecStyleCache(t){const e=new Map;return this.clearMap.set(e,()=>e.clear()),function(n){if(!n)return void s.e("input null to CacheStyleGetter");const o=e.get(n);if(o)return o;const i=t.apply(null,arguments);return e.set(n,i),i}}}l.clearMap=new Map,l.specStyleCache=new Map;class c{static visibleOffsetH(t){return 0}static offsetW(t){return l.offsetWidthCache(t)||0}static offsetH(t){return l.offsetHeightCache(t)||0}static computedStyleDec(t){return l.getComputedStyleCache(t)}static computedStyle(t,e){let n,o=l.specStyleCache.get(t);if(o){if(n=o.get(e),n)return n}else o=new Map;return c.computedStyleDec&&l.getComputedStyleCache?(n=c.computedStyleDec(t).getPropertyValue(e),o.set(e,n),l.specStyleCache.set(t,o),n):n}static localName(t){return l.localNameCache?l.localNameCache(t):""}static clearSpecCache(){for(const t of l.clearMap.values())t.call(null);l.specStyleCache.clear()}}class u{}u.minMargin=5,u.ATTR_NUM=5,u.display="display",u.width="width",u.minHeight="min-height",u.transform="transform",u.transition="transition",u.transform_origin="transform-origin",u.translate="translate",u.perspective="perspective",u.flex="flex",u.position="position",u.top="top",u.left="left",u.bottom="bottom",u.float="float",u.vertical_align="vertical-align",u.justify_content="justify-content",u.margin_top="margin-top",u.margin_left="margin-left",u.margin_right="margin-right",u.flex_direction="flex-direction",u.align_items="align-items",u.margin_bottom="margin-bottom",u.padding_top="padding-top",u.padding_bottom="padding-bottom",u.padding_right="padding-right",u.padding_left="padding-left",u.right="right",u.overflow="overflow",u.overflow_x="overflow-x",u.overflow_y="overflow-y",u.zoom="zoom",u.z_index="z-index",u.line_height="line-height",u.computedWidth="computedWidth",u.box_sizing="box-sizing",u.background_size="background-size",u.border_bottom_width="border-bottom-width",u.border_top_width="border-top-width",u.border_left_width="border-left-width",u.border_right_width="border-right-width",u.border_left="border-left",u.border_right="border-right",u.border_top="border-top",u.white_space="white-space",u.text_align="text-align",u.max_height="max-height",u.flex_grow="flex-grow",u.row="row",u.flex_shrink="flex-shrink",u.filter="filter",u.flex_wrap="flex-wrap",u.content="content",u.name_="name",u.meta="meta",u.viewport="viewport",u.resize="resize",u.load="load",u.childList="childList",u.border_radius="border-radius",u.border="border",u.border_width="border-width",u.max_width="max-width",u.transition_duration="transition-duration",u.visibility="visibility",u.opacity="opacity",u.rel="rel",u.href="href",u._webkit_box_flex="-webkit-box-flex",u.scale="scale",u.flex_basis="flex-basis",u.box_shadow="box-shadow",u.pointer_events="pointer-events",u.px="px",u.style="style",u.media_="media",u.WIDE_SCREEN_MEDIA_EN_DEFAULT="only screen and (max-height : 500px), screen and (min-width : 500px)",u.WIDE_SCREEN_MEDIA_DIS="only screen and (max-height : -10px)",u.none="none",u.stylesheet="stylesheet",u.link="link",u.delete="delete",u.fixed="fixed",u.sticky="sticky",u.absolute="absolute",u.static="static",u.wrap="wrap",u.column="column",u.space_between="space-between",u.space_evenly="space-evenly",u.space_around="space-around",u.true="true",u.false="false",u.grid_template_columns="grid-template-columns",u.gap="gap",u.grid_auto_flow="grid-auto-flow",u.dense="dense",u.start="start",u.fit_content="fit-content",u.break_inside="break-inside",u.avoid="avoid",u.grid="grid",u.border_box="border-box",u.tag_truncate="truncate-tag",u.discrepancy=1,u.maxCloseButtonSizeRatio=.15,u.bottomCloseButtonRatio=.6,u.ERR_CODE_GAPS=100,u.ERR_CODE_OVERFLOW=50,u.ERR_CODE_OFFSET=10,u.ERR_CODE_CLOSE_BTN_OVERLAP=2,u.ERR_CODE_INTERACTIVE=1,u.paddingTop="padding-top",u.paddingBottom="padding-bottom",u.transitionend="transitionend",u.script="script",u.noscript="noscript",u.back="back",u.swiperBox="swiper-box",u.num0px="0px",u.hidden="hidden",u.num100percent="100%",u.important="!important",u.hw_="hw_",u.a_="a",u.hwA=u.hw_+u.a_;const d={DISABLE:"disable",VERTICAL_GRID:"vertical_grid",ASIDE_BAR:"asideBar",BACK_IMG:"backImg",ONE_LINE:"oneLine",ZOOM_PARENT:"zoomParent",IS_IMG:"isImg",HAS_TEXT_CHILD:"hasTextChild",WATERFALL:"waterfall",SWIPER:"swiper",SCROLL_LIST:"scrollList",COMMENT:"comment",HEADER:"header",ACROSS_COLUMN:"across_column",NEXT_ROUND:"next_round",BOTTOM:"bottom",EMPTY:"empty"},p="hwLayout",h="thirdLayout",m="diffEle",g="insertRule",f="insertSwiper",y="multi_items",T="ele_num",S="origin_width",A="height0",C="force_css",N="origin_height";class w{static setValue(t,e,n){if(!t)return;i.store;let o=this.valueMap.get(e);o||(o=new Map,this.valueMap.set(e,o)),o.set(t,n),s.showValue(t,e,n),w.saveOriginHeight(t,e)}static removeValue(t,e){if(!t)return;i.store;const n=this.valueMap.get(e);n&&(n.delete(t),s.deleteValue(t,e))}static getValue(t,e){if(!t)return null;const n=this.valueMap.get(e);if(!n)return null;const o=n.get(t);return o||null}static clearTag(t){s.clearTag(this.valueMap,t),this.valueMap.delete(t)}static clearAllTag(t,e){const n=[S,T,A,y,A,d.HAS_TEXT_CHILD,d.IS_IMG,m],o=(new Map).set(h,d.DISABLE);for(let[i,a]of this.valueMap){if(!e&&n.includes(i))continue;const r=o.get(i);!e&&r&&w.getValue(t,i)===r||(a.delete(t),s.deleteValue(t,i))}}static removeNextRoundTags(){w.nextRoundCache.forEach(t=>{w.removeValue(t,p)}),w.nextRoundCache=[]}static saveOriginHeight(t,e){e===p&&w.getValue(t,N)&&w.setValue(t,N,c.offsetH(t).toString())}}w.valueMap=new Map,w.nextRoundCache=[];class R{static getHTMLElement(t){return t instanceof HTMLElement?t:t.parentElement}static isWideScreen(){const t=screen.availHeight,e=screen.availWidth;if(0===t)return!1;const n=r.getInstance().findAspectRatioRange(e);if(void 0===n)return!1;const o=e/t;return o>n.min&&o<n.max}static setParentTag(t,e=p,n=d.ZOOM_PARENT){t&&(w.getValue(t,e)||(w.setValue(t,e,n),this.setParentTag(t.parentElement,e,n)))}static hadRelayOut(t){return null!=w.getValue(t,p)}static hadZoomRelayout(t){return![null,d.ZOOM_PARENT].includes(w.getValue(t,p))}static hadConfig(t){return null!=w.getValue(t,h)}static timesBetween(t,e,n){return t/e<n&&e/t<n}static getInterval(t,e){return t[0]>t[1]||e[0]>e[1]?null:t[1]<e[0]||t[0]>e[1]?0:Math.min(t[1],e[1])-Math.max(t[0],e[0])}static MapAContainsMapB(t,e){for(const[n,o]of e.entries()){let e=t.get(n);if(e!==o&&(o!==u.delete||e))return!1}return!0}static isZoomParent(t){return w.getValue(t,p)===d.ZOOM_PARENT}static hadZoomLayout(t){const e=w.getValue(t,p);return null!=e&&e!==d.ZOOM_PARENT}static hadStretchedWidth(t){const e=w.getValue(t,p);return[d.ACROSS_COLUMN,d.ONE_LINE,d.EMPTY,d.COMMENT,d.SCROLL_LIST].includes(e)}static hadZoomConfig(t){const e=w.getValue(t,h);return null!=e&&e!==d.ZOOM_PARENT}static isInvisibleElement(t){if(c.computedStyle(t,u.display)===u.none)return!0;if(c.computedStyle(t,u.visibility)===u.hidden)return!0;return"0"===c.computedStyle(t,u.opacity)}static getAvailWidth(){return screen.availWidth}static ignoreEle(t){const e=[];if(!e.length)return!1;if(!t.className)return!1;for(let n=0;n<t.classList.length;n++)if(e.includes(t.classList[n]))return!0;return!1}static ignoreLocalName(t,e=[]){const n=[u.script,u.style,u.swiperBox,u.noscript].concat(e),o=c.localName(t);return n.includes(o)||o.startsWith(u.back)}static callRelayoutHappen(){R.hadCalledRelayoutHappen||(R.hadCalledRelayoutHappen=!0)}static isEmptyText(t){return!t||!/[^\t\n\r ]/.test(t)}static paddingFillHeight(t){const e=parseFloat(c.computedStyle(t,u.paddingTop)),n=parseFloat(c.computedStyle(t,u.paddingBottom));if(0===e&&0===n)return!1;if(e&&n)return!1;const o=Math.round(e||n);return c.offsetH(t)===o}static restoreLeftMarginSpace(t,e){}static getNumBetween(t,e,n){const o=Math.max(e,n),i=Math.min(e,n);return Math.min(Math.max(t,i),o)}static isImgCompleted(t){return!0}static hasSameSize(t,e){return!1}}R.TAG=i.util,R.hadCalledRelayoutHappen=!1;class E{static clearAllCache(){w.removeNextRoundTags(),this.bodyCache=void 0,this.documentCache=void 0}static clearStyleCache(){c.clearSpecCache()}static body_(){return this.bodyCache||(this.bodyCache=document.body),this.bodyCache}static documentElement_(){return this.documentCache||(this.documentCache=document.documentElement),this.documentCache}}E.bodyCache=void 0,E.documentCache=void 0;class I{}I.INDEX_IDX=0,I.STYLE_MAP_IDX=1,I.styleCache=new Map,I.styleFlushed=new Map,I.uniqueVirIdx=0,I.indexMappingList=[],I.styleDiv=null;class b{static reInit(){b.initFlag||(I.styleDiv=this.creatStyleDiv(),b.initFlag=!0)}static creatStyleDiv(){const t=document.createElement(u.style),e=document.head.appendChild(t);return b.styleNodeList.push(e),b.updateState(),e}static enableMedia(){if(!this.styleNodeList.length)return;let t;t=window.matchMedia(u.WIDE_SCREEN_MEDIA_EN_DEFAULT).matches?u.WIDE_SCREEN_MEDIA_EN_DEFAULT:"",i.cssSheetManage;for(let e=0;e<this.styleNodeList.length;e++)this.styleNodeList[e].setAttribute(u.media_,t)}static disableMedia(t=!1){if(!this.styleNodeList.length)return;const e=b.styleNodeList.some(t=>""===t.getAttribute(u.media_)),n=window.matchMedia(u.WIDE_SCREEN_MEDIA_EN_DEFAULT).matches;if(t||e||n)for(let o=0;o<this.styleNodeList.length;o++)this.styleNodeList[o].setAttribute(u.media_,u.WIDE_SCREEN_MEDIA_DIS)}static updateState(){R.isWideScreen()?b.enableMedia():b.disableMedia()}}b.initFlag=!1,b.styleNodeList=[];class _{static queryInsertRuleEle(){for(let[t,e]of this.insertRuleSelectorArr){const n=document.querySelectorAll(t);for(let t=0;t<n.length;t++){n[t];for(let t=0;t<e.length;t++){e[t]}}}}static appendRule(t,e){this.forceCSSAppendStyle;let n="",o=[];for(let s=0;s<e.length;s++){const t=e[s];o.push(t[0]),n+=`${t[0]}: ${t[1]}!important;`}const i=this.insertRuleSelectorArr.findIndex(e=>{const[n]=e;return n===t});-1!==i&&(this.forceCSSAppendStyle.sheet.deleteRule(i),this.insertRuleSelectorArr.splice(i,1)),this.insertRuleSelectorArr.push([t,o,n]),this.forceCSSAppendStyle.sheet.insertRule(`${t}{${n}} `,this.insertRuleSelectorArr.length-1)}static setStyle(t,e,n){if(this.hasForceCSS(t,e))return void i.styleSetter;i.styleSetter;const o=I.styleCache.get(t);o?o.set(e,n):I.styleCache.set(t,(new Map).set(e,n))}static setStyleByInsertRule(t,e,n){if(this.hasForceCSS(t,e))return void i.styleSetter;let o,s=`[class='${t.className}']`;t.style.position===u.fixed&&(s+='[style*="position: fixed;"]'),t.style.top&&(s+=`[style*='top: ${t.style.top};']`),t.id&&(s=`#${t.id}`+s),o=t.getAttribute(g)?t.getAttribute(g):"LayoutKey.INSERT_RULE"+I.uniqueVirIdx++,t.setAttribute(g,o),s+=`[${g}='${o}']`,t.setAttribute(g,o),this.appendRule(s,[[e,n]])}static hasForceCSS(t,e){const n=w.getValue(t,C);if(!n)return!1;return n.split(",").includes(e)}static flushAllStyles(){I.styleDiv.parentElement!==document.head&&(I.styleDiv=document.head.appendChild(I.styleDiv)),this.queryInsertRuleEle(),this.flushRemove(),this.flushCacheToCSSSheet(),this.checkAttr(),I.styleCache.clear()}static flushRemove(){for(let t=0;t<_.deleteList.length;t++)_.deleteList[t].remove();_.deleteList=[]}static removeEle(t){t&&_.deleteList.push(t)}static flushCacheToCSSSheet(){for(const[t,e]of I.styleCache.entries()){if(!t)continue;let n=I.styleFlushed.get(t);if(e.delete(u.delete)){if(n){const e=n[I.INDEX_IDX];this.deleteOldStyle(t,e),n=void 0}if(!e.size)continue}if(n||(n=[I.uniqueVirIdx,new Map],I.styleFlushed.set(t,n),I.uniqueVirIdx++),R.MapAContainsMapB(n[I.STYLE_MAP_IDX],e)){i.styleSetter;continue}const o=_.mergeStyle(e,n[I.STYLE_MAP_IDX]),s=n[I.INDEX_IDX];I.styleFlushed.set(t,[s,o]),this.setStoreStyleToCSSSheet(t,s,o)}}static mergeStyle(t,e){for(let[n,o]of t.entries())o===u.delete?e.delete(n):e.set(n,o);return e}static deleteOldStyle(t,e){I.styleFlushed.delete(t),_.delAttr(t);const n=_.findRuleIdxInList(e);-1!==n&&(I.styleDiv.sheet.deleteRule(n),_.delRuleIdxInList(n))}static setStoreStyleToCSSSheet(t,e,n){const o=_.getRulesStr(n),s=_.getSelectStr(t,e);_.setAttr(t,e);let a=_.findRuleIdxInList(e);-1!==a?I.styleDiv.sheet.deleteRule(a):a=_.addRuleIdxInList(e),I.styleDiv.sheet.insertRule(s+"{"+o+"}",a),i.styleSetter}static getRulesStr(t){let e="";for(const[n,o]of t)e+=n+":"+o+" "+u.important+";\n";return e}static getSelectStr(t,e){const n=_.getAttrSelectStr(e);return _.getIdSelect(t,n)+n}static getAttrSelectStr(t){let e="";const n=u.a_+t;for(let o=0;o<u.ATTR_NUM;o++){e+=`[${_.generateAttrKey(o)}=${n}]`}return e}static getIdSelect(t,e){let n="";const o=/^[a-zA-Z_.-][0-9a-zA-Z_.-]*$/g;for(o.test(t.id)&&(n+=`#${t.id}`.replace(/\./g,"\\.")),t=t.parentElement;t&&t!==E.body_();)o.test(t.id)&&(n=`#${t.id}`.replace(/\./g,"\\.")+" "+n),t=t.parentElement;return n&&(n+=e+","),n}static setAttr(t,e){const n=u.a_+e;for(let o=0;o<u.ATTR_NUM;o++){const e=_.generateAttrKey(o);t.setAttribute(e,n)}}static delAttr(t){for(let e=0;e<u.ATTR_NUM;e++){const n=_.generateAttrKey(e);t.removeAttribute(n)}}static checkAttr(){for(let t=0;t<this.observeList.length;t++){const e=this.observeList[t],n=I.styleFlushed.get(e);n&&this.setAttr(e,n[I.INDEX_IDX])}this.observeList=[]}static addRuleIdxInList(t){return I.indexMappingList.push(t),I.indexMappingList.length-1}static findRuleIdxInList(t){return I.indexMappingList.findIndex(e=>e===t)}static delRuleIdxInList(t){t<0||t>=I.indexMappingList.length||I.indexMappingList.splice(t,1)}static disableHandle(t){w.setValue(t,h,d.DISABLE),R.setParentTag(t.parentElement,p,d.ZOOM_PARENT),R.setParentTag(t.parentElement,h,d.ZOOM_PARENT)}static checkAndSetStyle(t,e,n){if(!t)return;const o=c.computedStyle(t,e);null!==o&&o!==u.num0px||_.setStyle(t,e,n)}static generateAttrKey(t){return u.hw_+String.fromCharCode(t+u.a_.charCodeAt(0))}}_.insertRuleSelectorArr=[],_.deleteList=[],_.observeList=[];class v{constructor(t,e){if(this.taskCount=0,this.isLocked=!1,this.timerId=null,v.TAG,"function"!=typeof e)throw s.e("任务参数必须是函数",v.TAG),new TypeError("Throttle: task must be a function");"number"!=typeof t||t<v.MIN_TIMEOUT?(s.w(`⚠️ timeout参数无效 (${t}ms)，使用最小值 ${v.MIN_TIMEOUT}ms`,v.TAG),this.timeout=v.MIN_TIMEOUT):this.timeout=t,this.taskToRun=e,this.timeout,e.name,v.TAG}postTask(){this.taskCount++,this.isLocked?(this.taskCount,v.TAG):(this.taskCount,v.TAG,this.executeTask())}cancel(){const t=this.taskCount;v.TAG,this.taskCount=0,null!==this.timerId&&(v.TAG,clearTimeout(this.timerId),this.timerId=null),t>0&&v.TAG}destroy(){v.TAG,this.cancel(),this.isLocked=!1,v.TAG}executeTask(){const t=Date.now();this.taskCount;v.TAG,this.lock();try{v.TAG,this.taskToRun();Date.now();v.TAG,this.scheduleUnlock(t)}catch(e){const n=Date.now()-t;s.e(`❌ 任务执行失败 (耗时: ${n}ms): ${e}`,v.TAG,e),s.w("紧急解锁以避免死锁",v.TAG),this.unlock()}}lock(){this.taskCount;this.isLocked=!0,this.taskCount=0,Date.now(),v.TAG}scheduleUnlock(t){const e=t+this.timeout,n=Date.now(),o=Math.max(0,e-n);this.timeout,v.TAG,null!==this.timerId&&(v.TAG,clearTimeout(this.timerId)),this.timerId=window.setTimeout(()=>{this.timerId=null,v.TAG,this.unlock()},o)}unlock(){if(this.isLocked=!1,this.taskCount>0){this.taskCount;Date.now(),v.TAG,this.executeTask()}else Date.now(),v.TAG}getState(){const t={isLocked:this.isLocked,taskCount:this.taskCount,timeout:this.timeout};return v.TAG,t}}v.TAG=i.throttle,v.MIN_TIMEOUT=10;class D{static removeAllStyle(t){i.styleCleaner;const e=(new Map).set(u.delete,u.true);I.styleCache.set(t,e)}static removeSingleStyle(t,e){i.styleCleaner,_.setStyle(t,e,u.delete)}static resetEle(t,e=!1){i.styleCleaner,w.getValue(t,p),i.styleCleaner,w.getValue(t,h),i.styleCleaner,D.resetChild(t,e),D.resetParent(t.parentElement)}static resetChild(t,e){if(t){if(w.getValue(t,f))return t.parentElement,i.styleCleaner,void t.remove();D.removeAllStyle(t),w.clearAllTag(t,e),[...t.children].forEach(t=>{D.resetChild(t,e)})}}static resetParent(t){if(t&&t!==E.documentElement_()&&(w.getValue(t,p)===d.ZOOM_PARENT||w.getValue(t,h)===d.ZOOM_PARENT)){for(let e=0;e<t.children.length;e++){const n=t.children[e];if(n&&(w.getValue(n,p)||w.getValue(n,h)))return}this.removeAllStyle(t),w.clearAllTag(t,!1),this.resetParent(t.parentElement)}}static resetParentRelayout(t){return!(!t||R.isZoomParent(t))&&(w.getValue(t,p),i.styleCleaner,w.getValue(t,p)===d.NEXT_ROUND||(R.hadZoomLayout(t)?(i.styleCleaner,R.hadStretchedWidth(t)?(i.styleCleaner,D.resetEle(t),tt.nextRoundAndPost(t),!0):(D.resetEle(t),!1)):D.resetParentRelayout(t.parentElement)))}static removeWidth(t){D.removeSingleStyle(t,u.width),D.removeSingleStyle(t,u.max_width),D.removeSingleStyle(t,u.flex_basis)}}var M,x,k;!function(t){t[t.Center=1]="Center",t[t.Center_Button_Overlap=2]="Center_Button_Overlap",t[t.Bottom=3]="Bottom",t[t.Picker=4]="Picker"}(M||(M={}));class L{static hasExplicitlyDefinedStyle(t,e,n,o){i.layoutUtils,t.className||t.tagName,i.layoutUtils;const s=t.style[e];if(s&&this.convertToPxUnits(s)===n)return i.layoutUtils,!0;i.layoutUtils;const a=this.findStyleInSheets(t,e,n);if(a.isFound)return i.layoutUtils,!0;if(!a.crossDomainSheetEncountered)return i.layoutUtils,!1;i.layoutUtils;const r=t.getBoundingClientRect();if("top"===e){const t=Math.abs(r[e]-parseFloat(n))<u.discrepancy;return r.top,Math.abs(r[e]-parseFloat(n)),i.layoutUtils,t}const l=Math.abs(r[e]-window.innerHeight)<u.discrepancy;return r.bottom,Math.abs(r[e]-window.innerHeight),i.layoutUtils,l}static findStyleInSheets(t,e,n){let o=!1;document.styleSheets.length,i.layoutUtils;for(const s of document.styleSheets){const a=this._processSingleSheet(s,t,e,n);if(a.error&&(o=!0),a.isFound)return i.layoutUtils,{isFound:!0,crossDomainSheetEncountered:o}}return i.layoutUtils,{isFound:!1,crossDomainSheetEncountered:o}}static _processSingleSheet(t,e,n,o){try{return{isFound:Array.from(t.cssRules).some(t=>this._isRuleMatch(t,e,n,o)),error:!1}}catch(a){return s.w(`无法访问跨域样式表，某些样式检查可能不准确: ${t.href}`,i.layoutUtils),{isFound:!1,error:!0}}}static _isRuleMatch(t,e,n,o){if(!(t instanceof CSSStyleRule&&t.selectorText&&e.matches(t.selectorText)))return!1;const i=t.style.getPropertyValue(n);return i&&L.convertToPxUnits(i)===o}static hasTopStyle(t,e,n){return this.hasExplicitlyDefinedStyle(t,"top",n,e)}static hasBottomStyle(t,e,n){return this.hasExplicitlyDefinedStyle(t,"bottom",n,e)}static convertToPxUnits(t){return t.endsWith("rem")?parseFloat(t)*parseFloat(getComputedStyle(document.documentElement).fontSize)+"px":t.endsWith("vw")||t.endsWith("%")?window.innerHeight*parseFloat(t)/100+"px":t}static isNodeTruncated(t,e){if(!(t instanceof HTMLElement))return!1;i.layoutUtils,t.className||t.tagName,i.layoutUtils;const n=window.innerHeight,o=t.getBoundingClientRect(),s=window.getComputedStyle(t),a=parseFloat(s.borderTopWidth),r=parseFloat(s.borderBottomWidth),l=parseFloat(s.paddingTop),c=parseFloat(s.paddingBottom),u=o.top+a+l,d=o.bottom-r-c;if(i.layoutUtils,u>=d)return i.layoutUtils,!1;const p=Math.round(u)<0,h=Math.round(d)>n;p&&(t.className,i.layoutUtils),h&&(t.className,i.layoutUtils);const m=p||h;return i.layoutUtils,m}static checkIfBackgroundImgTruncated(t){if(!(t instanceof HTMLElement))return!1;let e=getComputedStyle(t);const n="none"!==e.backgroundImage&&"cover"===e.backgroundSize;return n&&(t.className||t.tagName,i.layoutUtils),n}static getWidthAsPx(t,e){return window.getComputedStyle(t).getPropertyValue(e)}static canBeRelayout(t){const e=w.getValue(t,p);return[null,d.ZOOM_PARENT,d.HEADER,d.BOTTOM,d.VERTICAL_GRID].includes(e)}static getVisibleChildren(t){return Array.from(t.children).filter(t=>{if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity})}static findParentWithEqualChildren(t,e=5){if(!t||t.nodeType!==Node.ELEMENT_NODE)return null;if("none"===window.getComputedStyle(t).display)return null;const n=Array.from(t.children).filter(t=>{const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&"0"!==e.opacity});if(n.length>=2){const o=new Map,s=t=>Math.round(t/e)*e;for(const t of n){const e=t.getBoundingClientRect(),n=`${s(e.width)}, ${s(e.height)}`;o.set(n,(o.get(n)||0)+1)}if([...o.values()].some(t=>t>=2))return t.className||t.tagName,n.length,i.layoutUtils,t}for(const o of n){const n=this.findParentWithEqualChildren(o,e);if((t===n||!t.contains(n))&&n)return n}return null}static analyzeComputedBoxShadow(t){var e,n,o,s;if(i.layoutUtils,!t||"string"!=typeof t||"none"===t||""===t)return i.layoutUtils,null;const a=t.match(/(rgba?\(.*?\)|hsla?\(.*?\)|#[\da-f]{3,8}|[a-z]+)/i);if(!a)return i.layoutUtils,null;const r=a[0],l=t.replace(r,"").trim().split(/\s+/).filter(Boolean);if(l.length<2)return l.length,i.layoutUtils,null;const c={offsetX:null!==(e=l[0])&&void 0!==e?e:"0px",offsetY:null!==(n=l[1])&&void 0!==n?n:"0px",blurRadius:null!==(o=l[2])&&void 0!==o?o:"0px",spreadRadius:null!==(s=l[3])&&void 0!==s?s:"0px",color:r};c.offsetX,c.offsetY,c.blurRadius,c.spreadRadius,i.layoutUtils;const u=parseFloat(c.spreadRadius),d=Math.max(window.innerWidth,window.innerHeight),p=u>=d,h=c.offsetX.trim().startsWith("0")&&c.offsetY.trim().startsWith("0")&&c.blurRadius.trim().startsWith("0")&&p;return i.layoutUtils,h}static isBottomCloseButtonOverlap(t){if(i.layoutUtils,!t||!t.root_node)return i.layoutUtils,!1;const e=t.root_node.querySelectorAll('[class*="close"]');if(e.length,i.layoutUtils,1!==e.length)return i.layoutUtils,!1;const n=e[0],o=getComputedStyle(n),s=n.getBoundingClientRect();if(o.position,o.bottom,i.layoutUtils,this.isCloseButton(n)&&"absolute"===o.position&&parseFloat(o.bottom)<0){const t=s.top,e=n.parentElement.getBoundingClientRect().top,o=n.parentElement.getBoundingClientRect().bottom;if(i.layoutUtils,t<o&&t>(e+o)/2)return i.layoutUtils,!0}return i.layoutUtils,!1}static isCloseButton(t){const e=getComputedStyle(t).background.includes("url"),n="button"===t.getAttribute("role");return!(!e&&!n)&&(i.layoutUtils,!0)}static isAbsoluteButtonInBottom(t){t.root_node.querySelectorAll('[class*="button"]');return!1}static hasElementSiblings(t){return null!==t.previousElementSibling||null!==t.nextElementSibling}static getVisualBoundingRectForAll(t){if(i.layoutUtils,!t||"function"!=typeof t.getBoundingClientRect)return i.layoutUtils,null;const e=t.getBoundingClientRect();let n=e.top,o=e.bottom;const s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode(t){if(!(t instanceof HTMLElement))return NodeFilter.FILTER_REJECT;const e=window.getComputedStyle(t.parentElement).overflowY,n="scroll"===e||"auto"===e,o=t.parentElement.scrollHeight>t.parentElement.clientHeight;return n&&o?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let a=s.nextNode();for(;a;){let t=a.getBoundingClientRect().top,e=a.getBoundingClientRect().bottom;n=Math.min(n,t),o=Math.max(o,e),a=s.nextNode()}return i.layoutUtils,{top:n,bottom:o}}static getVisualBoundingRect(t,e,n){if(i.layoutUtils,t.className||t.tagName,i.layoutUtils,!t||"function"!=typeof t.getBoundingClientRect)return i.layoutUtils,null;const o=t.getBoundingClientRect();let s=null,a=0,r=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;0!==o.height&&0!==o.width&&(r=o.left,l=o.top,c=o.right,u=o.bottom,i.layoutUtils);const d=(t,o)=>{if(this.hasScrollbar(t))return void(t=>{if(s=t,t.className||t.tagName,i.layoutUtils,!e)return;const o=t.scrollHeight-t.getBoundingClientRect().height;i.layoutUtils,n===M.Bottom?(a-=o,i.layoutUtils):n!==M.Center&&n!==M.Center_Button_Overlap||(a-=o/2,i.layoutUtils)})(t);const p=window.getComputedStyle(t);if(!(t!==o&&"hidden"===p.overflowY&&t.scrollHeight>t.clientHeight)){(t=>{const e=t.getBoundingClientRect(),n=window.getComputedStyle(t);if(!(e.width>0&&e.height>0&&"none"!==n.display&&"hidden"!==n.visibility&&parseFloat(n.opacity)>0))return;const o=e.height/e.width;o>.1&&o<10&&(r=Math.min(r,e.left),l=Math.min(l,e.top),c=Math.max(c,e.right),u=Math.max(u,e.bottom))})(t);for(const e of t.children)e instanceof HTMLElement&&d(e,o)}};d(t,t);const p=c-r,h=u-l;return 0!==o.height&&0!==o.width&&(a+=l-o.top+(h-o.height)/2),i.layoutUtils,i.layoutUtils,s&&(s.className||s.tagName),i.layoutUtils,{left:r,top:l,right:c,bottom:u,width:p,height:h,offsetY:a,scrollElement:s}}static hasScrollbar(t){const e=window.getComputedStyle(t).overflowY;return"scroll"===e||"auto"===e}static getStackingContextChain(t){const e=[];let n=t;for(;n&&n!==document.documentElement;)L.isStackingContext(n)&&e.push({element:n,zIndex:L.getEffectiveZIndex(n)}),n=n.parentElement;return e.push({element:document.documentElement,zIndex:0}),e.reverse()}static isStackingContext(t){const e=window.getComputedStyle(t);return t===document.documentElement||("static"!==e.position&&"auto"!==e.zIndex||(parseFloat(e.opacity)<1||"none"!==e.transform||"none"!==e.filter||"isolate"===e.isolation||"normal"!==e.mixBlendMode||!("z-index"!==e.willChange&&!e.willChange.includes("transform")&&!e.willChange.includes("opacity"))))}static getEffectiveZIndex(t){const e=window.getComputedStyle(t);return"auto"===e.zIndex?0:parseInt(e.zIndex,10)||0}static compareZIndex(t,e){if(i.layoutUtils,t===e)return i.layoutUtils,0;const n=L.getStackingContextChain(t),o=L.getStackingContextChain(e);n.length,o.length,i.layoutUtils;let s=0;for(;s<n.length&&s<o.length;){const t=n[s],e=o[s];if(t.element!==e.element){const n=t.zIndex>e.zIndex?1:-1;return t.zIndex,e.zIndex,i.layoutUtils,n}s++}i.layoutUtils;const a=t.compareDocumentPosition(e);return a&Node.DOCUMENT_POSITION_FOLLOWING?(i.layoutUtils,-1):a&Node.DOCUMENT_POSITION_PRECEDING?(i.layoutUtils,1):(i.layoutUtils,0)}}class G{static isImageCanSafetyStrech(t){const e=getComputedStyle(t).backgroundImage;return!(!e||!e.includes("linear-gradient"))}static isPureText(t){return t.nodeType===Node.TEXT_NODE||1===t.childNodes.length&&t.firstChild.nodeType===Node.TEXT_NODE}static isImageContainer(t){var e;if("IMG"===t.tagName)return!0;if("img"===t.getAttribute("role"))return!0;const n=getComputedStyle(t).backgroundImage;if(n&&"none"!==n&&"initial"!==n)return!0;const o=getComputedStyle(t).webkitMaskImage;return!(!o||"none"===o||!o.includes("url"))||("SOURCE"===t.tagName&&"PICTURE"===(null===(e=t.parentElement)||void 0===e?void 0:e.tagName)||("image"===t.tagName&&"http://www.w3.org/2000/svg"===t.namespaceURI||("CANVAS"===t.tagName&&"container"===t.dataset.imageRole||(!!t.classList.contains("pseudo-image-container")||("IFRAME"===t.tagName&&"image-viewer"===t.dataset.role||!!t.classList.contains("a-lottie"))))))}static isObjectNode(t){return"object"===t.tagName}static copyEventListeners(t,e){const n=getEventListeners(t);for(const s in n)n[s].forEach(t=>{e.addEventListener(s,t.listener)});const o=t.children,i=e.children;for(let s=0;s<o.length;s++)G.copyEventListeners(o[s],i[s]);return e}static isOverFlowHidden(t,e){for(;t&&t!==e;){if("hidden"===getComputedStyle(t).overflow)return null==t||t.className,G.TAG,!0;t=t.parentElement}return!1}static pruneCommonAncestorsInTree(t,e){const n=new Set;n.add(e);for(const[o,i]of t){if(i)continue;let s=o.parentElement;for(;s&&s!==e;)t.has(s)&&n.add(s),s=s.parentElement}return n.forEach(e=>t.delete(e)),t}static getValidChildNodeLength(t){let e=0;return t&&t.childNodes&&t.childNodes.forEach(t=>{G.shouldSkip(t)||(e+=1)}),e}static getSwiperIndicator(t){if(t&&t.childNodes){const e=t.querySelectorAll('[class*="indicator"]');if(e&&1===e.length)return e[0]}return null}static findVisibleImageNode(t){for(;0!==G.getValidChildNodeLength(t);)for(const e of t.childNodes){const t=e;if(!G.shouldSkip(t))return G.isImageContainer(t)?t:G.findVisibleImageNode(t)}return null}static shouldSkip(t){return!t||t.nodeType!==Node.ELEMENT_NODE||(R.ignoreLocalName(t)?(null==t||t.className,G.TAG,!0):L.canBeRelayout(t)?!!R.isInvisibleElement(t)&&(null==t||t.className,G.TAG,!0):(null==t||t.className,G.TAG,!0))}static isElementVisible(t,e){if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const n=getComputedStyle(t);if("none"===n.display||"hidden"===n.visibility||"0"===n.opacity)return null==t||t.className,G.TAG,!1;const o=t.getBoundingClientRect();if(0===o.width||0===o.height)return null==t||t.className,G.TAG,!1;const i=t.parentElement;if("absolute"===n.position)if(G.isOverFlowHidden(i,e))return!1;return!0}static isElementInViewport(t){if(!t)return!1;const e=t.getBoundingClientRect();return e.width>0&&e.height>0&&e.top<window.innerHeight&&e.bottom>0&&e.left<window.innerWidth&&e.right>0}static getElementDepth(t){if(!t)return 0;let e=0,n=t;for(;n.parentElement;)e++,n=n.parentElement;return e}static zIndexToNumber(t){if(!t)return 0;if("auto"===t.toLowerCase())return 0;const e=parseInt(t,10);return isNaN(e)?0:e}static isColorTransparent(t){if(!t)return!1;if("transparent"===(t=t.toLowerCase().trim()))return!0;if(t.startsWith("rgba")||t.startsWith("hsla")){const e=parseFloat(t.split(",")[3]);return!isNaN(e)&&0===e}if(t.startsWith("#")&&(5===t.length||9===t.length)){const e=t.slice(1);if(4===e.length){return 0===parseInt(e[3]+e[3],16)/255}if(8===e.length){return 0===parseInt(e.slice(6,8),16)/255}}return!1}static isColorSemiTransparent(t){if(!t)return!1;t=t.toLowerCase().trim();const e=r.getInstance().getOpacityFilter();if("transparent"===t)return!1;if(t.startsWith("rgba")||t.startsWith("hsla")){const n=parseFloat(t.split(",")[3]);return!isNaN(n)&&n>e[0]/100&&n<e[1]/100}if(t.startsWith("#")&&(5===t.length||9===t.length)){const n=t.slice(1);if(4===n.length){const t=parseInt(n[3]+n[3],16)/255;return t>e[0]/100&&t<e[1]/100}if(8===n.length){const t=parseInt(n.slice(6,8),16)/255;return t>e[0]/100&&t<e[1]/100}}return!1}static hasSemiTransparentGradient(t){return!(!t||"none"===t)&&(!t.includes("transparent")&&!!/rgba$$.+?$$|hsla$$.+?$$/i.test(t))}static hasSemiTransparentFilter(t){if(!t)return!1;if(/opacity$$[^)]*$$/i.test(t)){const e=t.match(/opacity$$([^)]+)$$/),n=r.getInstance().getOpacityFilter();if(e){const t=parseFloat(e[1].trim());return t>n[0]/100&&t<n[1]/100}}return!1}static isBackgroundSemiTransparent(t){if(!t)return!1;if(G.isColorSemiTransparent(t.backgroundColor))return!0;const e=parseFloat(t.opacity),n=r.getInstance().getOpacityFilter();return e>n[0]/100&&e<n[1]/100||(!!G.hasSemiTransparentGradient(t.backgroundImage)||(!!G.hasSemiTransparentFilter(t.filter)||("none"!==t.backdropFilter||(!!/overlay|multiply|screen|soft-light/.test(t.mixBlendMode)||"none"!==t.mask))))}static isElementVisibleInViewPort(t){if(!t)return!1;const e=getComputedStyle(t);if("none"===e.display||"hidden"===e.visibility||0===parseFloat(e.opacity))return t.className,e.display,e.display,e.opacity,!1;const n=t.getBoundingClientRect();return n.width>0&&n.height>0}static getScreenAreaRatio(t){if(!t)return 0;const e=t.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;return Math.max(0,Math.min(e.right,n)-Math.max(e.left,0))*Math.max(0,Math.min(e.bottom,o)-Math.max(e.top,0))/(n*o)*100}static hasCloseButton(t){var e;if(!t)return!1;try{const n=t.classList?Array.from(t.classList).join(" ").toLowerCase():"",o=window.getComputedStyle(t).backgroundImage.toLowerCase();if(null===(e=r.getInstance().getcloseButtonPattern())||void 0===e?void 0:e.some(t=>n.includes(t)||o.includes(t)))return!0;for(const e of Array.from(t.children))if(G.hasCloseButton(e))return!0}catch(n){}return!1}static hasButton(t){var e;if(!t)return!1;try{const n=t.classList?Array.from(t.classList).join(" ").toLowerCase():"";if(null===(e=r.getInstance().getButtonPattern())||void 0===e?void 0:e.some(t=>n.includes(t)))return!0}catch(n){}return!1}static getVisibleSiblings(t){if(G.TAG,t.className||t.tagName,G.TAG,!t||!t.parentNode)return G.TAG,[];const e=Array.from(t.parentNode.children);e.length,G.TAG;const n=e.filter(e=>{if(e===t)return!1;const n=getComputedStyle(e);if("none"!==n.display&&"hidden"!==n.visibility&&0===parseFloat(n.opacity)){const t=Z.getDurationFromElement(e);t>0&&(e.className||e.tagName,n.display,n.visibility,n.opacity,G.TAG,tt.postTask())}return"none"!==n.display&&"hidden"!==n.visibility&&parseFloat(n.opacity)>0?(e.className||e.tagName,G.TAG,!0):(e.className||e.tagName,n.display,n.visibility,n.opacity,G.TAG,!1)});return G.TAG,n.length,n.length,G.TAG,n}static visualFilter(t){if(!t)return!1;const e=getComputedStyle(t);return 0!==t.offsetWidth&&0!==t.offsetHeight&&"none"!==e.display&&"hidden"!==e.visibility&&0!==parseFloat(e.opacity)}static findSiblingContent(t,e=3){const n=G.getVisibleSiblings(t);if(n.length>0)return n.length,[n,t.parentNode];if(t.children.length>0)return[[],null];let o=t.parentNode,i=1;for(;o&&o!==document.body&&i<=e;){const t=G.getVisibleSiblings(o);if(t.length>0)return t.length,[t,o.parentNode];o=o.parentNode,i++}return[[],null]}}G.TAG=i.util;class O{constructor(t){this.root=t,this.mDirty=!0,this.mComponent=t}static recognize(t){throw new Error("FATAL ERROR:Please Implement tis function in subclass")}isDirty(){return this.mDirty}setDirty(t){this.mDirty=t}contains(t){return this.mComponent.contains(t)}}class F{constructor(){this.originalLayoutState=null}static getInstance(){return F.instance||(F.instance=new F),F.instance}recordOriginalPosition(t){if(this.originalLayoutState&&this.originalLayoutState.metrics.has(t))return;const e=new Map;e.set(t,this.getLayoutMetrics(t));t.querySelectorAll("*").forEach(t=>{e.set(t,this.getLayoutMetrics(t))}),this.originalLayoutState={metrics:e,screenSize:{width:window.innerWidth,height:window.innerHeight}}}getLayoutMetrics(t){const e=t.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height,right:e.right,bottom:e.bottom}}}F.minGap=-1,F.minInterWH=Number((48/Math.max(window.devicePixelRatio,1)).toFixed(2)),F.empiricalCoefficient=.022,F.maxProportion=0,F.minAlignment=Number((20/Math.max(window.devicePixelRatio,1)).toFixed(2)),F.tolerance=Number((20/Math.max(window.devicePixelRatio,1)).toFixed(2)),F.relativeOffset=.05,F.maxOffset=.5;class B{static detectLayoutConstraintMetrics(t,e){if(i.layoutConstraintDetector,!e||0===e.size)return s.e("无效的根节点列表",i.layoutConstraintDetector),this.createErrorReport("无效的根节点列表");e.size,i.layoutConstraintDetector;const n=[],o=performance.now();let a=0,r="",l=!0,c=!0;for(const h of e){if(h.tagName,h.className,i.layoutConstraintDetector,!(h&&h instanceof HTMLElement)){s.e(`无效的根节点: ${h}`,i.layoutConstraintDetector);continue}const t=this.collectLayoutMetrics(h);t.size,i.layoutConstraintDetector,t.has(h)||(s.w("根节点布局数据缺失，重新获取",i.layoutConstraintDetector),this.addRootNodeMetrics(h,t)),i.layoutConstraintDetector;const e=this.detectSafeAreaGaps(h,t,n);Object.values(e).every(t=>t>=F.minGap)?i.layoutConstraintDetector:(s.w(`安全间隙检测失败: 左${e.left.toFixed(1)} 上${e.top.toFixed(1)} 右${e.right.toFixed(1)} 下${e.bottom.toFixed(1)}`,i.layoutConstraintDetector),a=Math.max(a,u.ERR_CODE_GAPS),l=!1),i.layoutConstraintDetector;const o=this.detectContainerOverflowRate(h,t,n);o>0?(s.w(`元素溢出率检测失败: ${o.toFixed(1)}%`,i.layoutConstraintDetector),a=Math.max(a,u.ERR_CODE_OVERFLOW),c=!1):i.layoutConstraintDetector}l||(r+="四边安全间隙检测 FAIL."),c||(r+="元素溢出率检测 FAIL."),i.layoutConstraintDetector,L.isBottomCloseButtonOverlap(t)?(s.w("关闭按钮重叠检测失败",i.layoutConstraintDetector),a=Math.max(a,u.ERR_CODE_CLOSE_BTN_OVERLAP),r+="关闭按钮重叠检测 FAIL."):i.layoutConstraintDetector;const d=this.generateFinalReport(n,a),p=performance.now()-o;return p.toFixed(2),i.layoutConstraintDetector,i.layoutConstraintDetector,i.layoutConstraintDetector,{resultCode:a,errorMsg:r,duration:p,report:d}}static generateFinalReport(t,e){return`# 布局约束指标检测报告\n\n## 总体状态: ${0===e?"✅ 通过":"❌ 未通过"}\n\n`+t.join("\n\n")+("\n\n---\n*检测标准:*\n- 安全间隙 ≥ "+F.minGap+"\n- 元素溢出率 ≤ "+F.maxProportion+".\n")}static createErrorReport(t){return{resultCode:-1,errorMsg:"",duration:0,report:`### 布局约束指标检测\n❌ 错误: ${t}`}}static addRootNodeMetrics(t,e){const n=t.getBoundingClientRect();e.set(t,{top:n.top,left:n.left,width:n.width,height:n.height,right:n.right,bottom:n.bottom})}static collectLayoutMetrics(t){t.tagName,t.className,i.layoutConstraintDetector;const e=new Map;this.addRootNodeMetrics(t,e);const n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});let o=n.nextNode();for(;o;){const i=o;if(i!==t){const t=i.getBoundingClientRect();e.set(i,{top:t.top,left:t.left,width:t.width,height:t.height,right:t.right,bottom:t.bottom})}o=n.nextNode()}return e.size,i.layoutConstraintDetector,e}static detectSafeAreaGaps(t,e,n){const o=e.get(t);if(!o)return s.e("无法获取根节点布局指标",i.layoutConstraintDetector),n.push("### 安全区域间隙检测\n❌ 错误: 无法获取根节点布局指标"),{left:0,top:0,right:0,bottom:0};o.left.toFixed(1),o.top.toFixed(1),o.right.toFixed(1),o.bottom.toFixed(1),i.layoutConstraintDetector,o.width.toFixed(1),o.height.toFixed(1),i.layoutConstraintDetector;const a=Object.assign({top:0,left:0,bottom:0,right:0},window.safeAreaInsets);a.left,a.top,a.right,a.bottom,i.layoutConstraintDetector;const r={left:a.left,top:a.top,right:window.innerWidth-a.right,bottom:window.innerHeight-a.bottom},l={left:o.left-a.left,top:o.top-a.top,right:r.right-o.right,bottom:r.bottom-o.bottom};F.minGap,l.left.toFixed(1),l.top.toFixed(1),l.right.toFixed(1),l.bottom.toFixed(1),i.layoutConstraintDetector;const c={left:l.left>=F.minGap,top:l.top>=F.minGap,right:l.right>=F.minGap,bottom:l.bottom>=F.minGap},u=Object.entries(c).filter(([t,e])=>!e).map(([t,e])=>t);u.length>0&&(u.join("、"),i.layoutConstraintDetector);const d=t=>t?"✅ 通过":"❌ 未通过",p=`### 1. 安全间隙检测(弹窗距离屏幕)\n- **要求**: 弹窗四边到安全区域边缘 ≥ ${F.minGap}\n- **屏幕尺寸**: ${window.innerWidth}×${window.innerHeight}\n- **安全区域**: [T:${a.top}, R:${a.right}, B:${a.bottom}, L:${a.left}]\n- **有效区域**: [L:${r.left.toFixed(1)}, T:${r.top.toFixed(1)}, R:${r.right.toFixed(1)}, B:${r.bottom.toFixed(1)}]\n- **弹窗位置**: [L:${o.left.toFixed(1)}, T:${o.top.toFixed(1)}, R:${o.right.toFixed(1)}, B:${o.bottom.toFixed(1)}]\n\n| 方向 | 要求 | 实际值 | 状态 |\n|------|------|--------|------|\n| 左侧 | ≥ ${F.minGap} | ${l.left.toFixed(1)} | ${d(c.left)} |\n| 顶部 | ≥ ${F.minGap} | ${l.top.toFixed(1)} | ${d(c.top)} |\n| 右侧 | ≥ ${F.minGap} | ${l.right.toFixed(1)} | ${d(c.right)} |\n| 底部 | ≥ ${F.minGap} | ${l.bottom.toFixed(1)} | ${d(c.bottom)} |\n\n- **整体状态**: ${Object.values(c).every(t=>t)?"✅ 全部通过":"⚠️ 部分未通过"}\n`;return n.push(p),l}static detectContainerOverflowRate(t,e,n){const o=Object.assign({top:0,left:0,bottom:0,right:0},window.safeAreaInsets),s={left:o.left,top:o.top,right:window.innerWidth-o.right,bottom:window.innerHeight-o.bottom},a=this.collectInteractiveElements(t);a.length,i.layoutConstraintDetector;let r=0;const l=[];a.forEach((n,o)=>{if(n===t)return;const a=e.get(n);if(!a||0===a.width||0===a.height)return;const c=Math.round(a.left)<Math.round(s.left),u=Math.round(a.right)>Math.round(s.right),d=Math.round(a.top)<Math.round(s.top),p=Math.round(a.bottom)>Math.round(s.bottom);if(c||u||d||p){if(this.isScrollableList(n,t)||this.isSwiperComponent(n))return n.tagName,n.className,void i.layoutConstraintDetector;r++;const e=[];c&&e.push("左"),u&&e.push("右"),d&&e.push("上"),p&&e.push("下");const o=`${n.tagName}.${n.className}: ${e.join("、")}侧溢出`;i.layoutConstraintDetector,l.push(`  - ${o}`)}});const c=a.length>0?r/a.length*100:0,u=0===c?"✅ 通过":"❌ 未通过";a.length,c.toFixed(1),i.layoutConstraintDetector;const d=`### 3.  元素溢出率检测(弹窗内控件是否溢出弹窗)\n- **要求**: 元素溢出率 ≤ ${F.maxProportion}}\n- **实际值**: ${c.toFixed(1)}%\n- **状态**: ${u}\n- **详情**:\n  - 总元素数: ${a.length}\n  - 溢出元素数: ${r}\n`;return l.length>0?n.push(d+`  - **溢出元素**:\n${l.join("\n")}`):n.push(d),c}static collectInteractiveElements(t){t.tagName,t.className,i.layoutConstraintDetector;const e=new Set(["button:not([disabled])","a[href]:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[role="button"]:not([disabled])','[role="link"]:not([disabled])','[role="menuitem"]','[role="option"]','[role="img"]','[tabindex]:not([tabindex="-1"])',".a-text.iconfont",".a-view.iconfont",'.iconfont[data-action="close"]','.iconfont[data-role="button"]',".iconfont[onclick]",'.iconfont[role="button"]',".icon-close",".icon-close-circle",".icon-close_circle",".icon-guanbi",".icon-shutdown",'[class*="close"]','[class*="guanbi"]']),n=Array.from(e).join(","),o=Array.from(t.querySelectorAll(n));var s;return s=t,Array.from(e).some(t=>s.matches(t))&&(o.unshift(t),i.layoutConstraintDetector),o.length,i.layoutConstraintDetector,o}static isScrollableList(t,e){const n=t=>{const e=window.getComputedStyle(t),n=e.overflow,o=e.overflowY;return"auto"===n||"scroll"===n||"auto"===o||"scroll"===o};if(n(t))return!0;let o=t.parentElement;for(;o!==e.parentElement;){if(n(o))return!0;o=o.parentElement}return!1}static isSwiperComponent(t){const e=/swiper/,n=e.test(t.className);let o=t.parentElement;for(;o;){if(e.test(o.className))return!0;o=o.parentElement}return n}}!function(t){t[t.A=1]="A",t[t.B=2]="B",t[t.C=3]="C",t[t.Unknown=20]="Unknown"}(x||(x={}));class P{static hasOverlappingCloseButton(t,e,n){var o;const s=P.getCloseButtons(t,e);if(0===s.length)return i.popupDecisionTree,!1;const a=P.isCloseElementAbsolute(s,t,n);return s.some((t,e)=>a[e]&&P.hasOverlapWithSiblings(t))?(null===(o=null==n?void 0:n.root_node)||void 0===o||o.className,i.popupDecisionTree,!0):(i.popupDecisionTree,!1)}static judgePopupDecisionTreeType(t,e){const n=e.root_node;if(P.isTimePickerPopup(n))return M.Picker;return P.isModalWin(t,n,e)?(window.popWin="bottom",i.popupDecisionTree,M.Bottom):(window.popWin="center",i.popupDecisionTree,this.hasOverlappingCloseButton(n,t,e)?M.Center_Button_Overlap:M.Center)}static getCloseButtons(t,e){const n=e.filter(e=>{var n,o,i,s,a;if(!t.contains(e))return!1;const l=e.classList?Array.from(e.classList).join(" ").toLowerCase():"",c=window.getComputedStyle(e),u=null!==(i=null===(o=null===(n=c.backgroundImage)||void 0===n?void 0:n.toLowerCase)||void 0===o?void 0:o.call(n))&&void 0!==i?i:"",d=null!==(s=c.backgroundImage)&&void 0!==s?s:"",p=null!==(a=r.getInstance().getcloseButtonPattern())&&void 0!==a?a:[],h=p.some(t=>l.includes(t)||u.includes(t)),m=!h&&p.some(t=>d.includes(t)),g="IMG"===e.tagName&&p.some(t=>e.src.includes(t));return h||m||g});return this.filterContainedNodes(n)}static filterContainedNodes(t){const e=new Set(t),n=[];for(const o of t){let t=o.parentElement,i=!1;for(;null!==t;){if(e.has(t)){i=!0;break}t=t.parentElement}i||n.push(o)}return n}static isElementOrAncestorAbsolute(t,e){let n=window.getComputedStyle(t);if("absolute"===n.position)return!0;let o=t.parentElement;for(;o&&o!==e;){n=window.getComputedStyle(o);const t=o.getBoundingClientRect();if("absolute"===n.position&&t.height<50&&t.width<50)return!0;o=o.parentElement}return!1}static isCloseElementAbsolute(t,e,n){const{popup_type:o,mask_node:i}=n,s=o===x.B||o===x.C?e:i;return t.map(t=>this.isElementOrAncestorAbsolute(t,s))}static hasOverlapWithSiblings(t){if(!t||!t.parentElement)return!1;const e=Array.from(t.parentElement.children).indexOf(t),n=G.getVisibleSiblings(t);let o=[];return n.forEach(t=>{const n=Array.from(t.parentElement.children).indexOf(t);n!==e-1&&n!==e+1||o.push({index:n,element:t})}),0!==o.length&&o.some(n=>{if("absolute"===window.getComputedStyle(n.element).position){const e=this.calOverlapAreaRatio(n.element,t);return this.hasOverlap(n.element,t)&&e>.2&&e<1}if(n.index===e-1){const e=this.findLastChild(n.element),o=this.calOverlapAreaRatio(e,t);return this.hasOverlap(e,t)&&o>.2&&o<1}{const e=this.findFirstChild(n.element),o=this.calOverlapAreaRatio(e,t);return this.hasOverlap(e,t)&&o>.2&&o<1}})}static findFirstChild(t){if(!t||!t.lastElementChild)return null;let e=t.lastElementChild;for(;e.firstElementChild;)e=e.firstElementChild;return e}static findLastChild(t){if(!t||!t.lastElementChild)return null;let e=t.lastElementChild;for(;e.lastElementChild;)e=e.lastElementChild;return e}static hasOverlap(t,e){if(null===t)return!1;const n=t.getBoundingClientRect(),o=e.getBoundingClientRect();return!(o.right<n.left||o.left>n.right||o.bottom<n.top||o.top>n.bottom)}static calOverlapAreaRatio(t,e){if(null===t)return 0;const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),i=Math.max(n.left,o.left),s=Math.min(n.right,o.right),a=Math.max(n.top,o.top),r=Math.min(n.bottom,o.bottom),l=Math.max(0,s-i),c=Math.max(0,r-a),u=o.width*o.height;return u>0?l*c/u:0}static getTopmostChildren(t,e){const n=Array.from(t.children).filter(t=>{const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&t instanceof HTMLElement&&1===parseFloat(e.opacity)&&!G.isBackgroundSemiTransparent(e)});if(0===n.length)return[];let o=window.getComputedStyle(e.mask_node).zIndex;o=e.popup_type===x.C||e.popup_type===x.A?-1:"auto"===o?0:parseInt(o,10);const s=n.map(t=>{let e=window.getComputedStyle(t).zIndex;return e="auto"===e?0:parseInt(e,10),{element:t,zIndex:e,domOrder:n.indexOf(t)}}).filter(t=>t.zIndex>=o);s.sort((t,e)=>t.zIndex!==e.zIndex?e.zIndex-t.zIndex:e.domOrder-t.domOrder);const a=s.map(t=>t.element);return a.length,i.popupDecisionTree,a}static isTimePickerPopup(t){let e=!1,n=!1,o=!1;const i=t.querySelectorAll("*");for(const s of Array.from(i))if(s instanceof HTMLElement&&(e||(e=this.checkPickerClass(s)),n||(n=this.checkUniformInlineHeight(s)),o||(o=this.checkLinearGradient(s)),e&&n&&o))break;return e&&n&&o}static checkPickerClass(t){return"string"==typeof t.className&&t.className.includes("picker")}static checkUniformInlineHeight(t){const e=t.children;if(e.length<2)return!1;const n=e[0];if(!n.style||!n.style.height)return!1;const o=n.style.height;for(let i=1;i<e.length;i++){const t=e[i];if(!t.style||t.style.height!==o)return!1}return!0}static checkLinearGradient(t){const e=window.getComputedStyle(t).backgroundImage;if(!e.includes("linear-gradient"))return!1;const n=e.match(/(rgba?\(.*?\)|hsla?\(.*?\)|#\w{3,8}|transparent)/gi);return!!n&&n.some(t=>G.isColorSemiTransparent(t))}static isModalWin(t,e,n){const o=this.findMainContentNode(e,n);if(!o)return!1;if(this.CheckCenterCloseButton(o,t))return!1;switch(n.content_node=o,n.popup_type){case x.C:return P.isModalForTypeC(n);case x.B:return P.isModalForTypeB(n);default:return!1}}static CheckCenterCloseButton(t,e){const n=P.getCloseButtons(t,e);if(n.length<1)return!1;const o=n[0].getBoundingClientRect();return 1===n.length&&o.height<window.innerHeight*u.maxCloseButtonSizeRatio&&o.bottom>window.innerHeight*u.bottomCloseButtonRatio}static isModalForTypeC(t){const e=t.root_node,n=t.content_node;return this.judgeModalConditions(e,n)}static isModalForTypeB(t){const e=t.root_node,n=t.content_node,o=P.judgeModalConditions(e,n);return n.children.length>0?!!o||Array.from(n.children).some(t=>P.judgeModalConditions(e,t)):o}static findMainContentNode(t,e){let n=e.mask_node;if(e.popup_type===x.B)for(;n.parentElement!==t;)if(n=n.parentElement,!n)return null;const o=Array.from(t.children).filter(t=>t!==n);if(0===o.length)return null;if(1===o.length)return o[0];let i=null,s=-1/0,a=0;for(const r of o){const t=window.getComputedStyle(r),e="auto"===t.zIndex?0:parseFloat(t.zIndex);e>s?(s=e,i=r,a=1):e===s&&a++}return 1===a?i:null}static judgeModalConditions(t,e){if(P.specialCenterCondition(e))return!1;if(P.specialBottomCondition(t,e))return!0;const n=window.getComputedStyle(e),{position:o,bottom:i,top:s}=n,a=e.getBoundingClientRect(),r=P.equalToScreenWidth(e,u.discrepancy),l=Math.abs(a.bottom-window.innerHeight)<u.discrepancy,c=Math.abs(a.top)<u.discrepancy;if(!r)return!1;if(o===u.static&&"auto"===i)return l&&!c;if(0!==parseFloat(i))return!1;if(!L.hasBottomStyle(e,o,i))return!1;if(s.endsWith("px")){if(0!==parseFloat(s))return!0;if(L.hasTopStyle(e,o,s))return!1}return l}static specialBottomCondition(t,e){const n=window.getComputedStyle(e),o=window.getComputedStyle(t);return"column"===n.flexDirection&&("flex-end"===n.justifyContent||"end"===n.justifyContent)||"row"===n.flexDirection&&("flex-end"===n.alignItems||"end"===n.alignItems)||"column"===o.flexDirection&&("flex-end"===o.justifyContent||"end"===o.justifyContent)||"row"===o.flexDirection&&("flex-end"===o.alignItems||"end"===o.alignItems)}static specialCenterCondition(t){const e=window.getComputedStyle(t);return"row"===e.flexDirection&&"center"===e.alignItems||"column"===e.flexDirection&&"center"===e.justifyContent}static equalToScreenWidth(t,e){const n=window.getComputedStyle(t),{paddingLeft:o,paddingRight:i,width:s,boxSizing:a,borderLeft:r,borderRight:l}=n;return"border-box"===a?Math.abs(parseFloat(s)-window.innerWidth)<e:!(isNaN(parseFloat(o))||isNaN(parseFloat(i))||isNaN(parseFloat(r))||isNaN(parseFloat(l))||"content-box"!==a)&&Math.abs(parseFloat(s)+parseFloat(o)+parseFloat(i)-window.innerWidth)<e}}!function(t){t.IDLE="IDLE",t.WAITING_ANIMATION="WAITING_ANIMATION",t.LAYOUTING="LAYOUTING",t.WAITING_VALIDATION="WAITING_VALIDATION",t.VALIDATING="VALIDATING",t.COMPLETED="COMPLETED",t.RESTORED="RESTORED",t.FAILED="FAILED"}(k||(k={}));const H={[k.IDLE]:[k.WAITING_ANIMATION,k.LAYOUTING,k.FAILED],[k.WAITING_ANIMATION]:[k.LAYOUTING,k.IDLE,k.FAILED],[k.LAYOUTING]:[k.WAITING_VALIDATION,k.IDLE,k.COMPLETED,k.FAILED],[k.WAITING_VALIDATION]:[k.VALIDATING,k.IDLE,k.FAILED],[k.VALIDATING]:[k.COMPLETED,k.RESTORED,k.IDLE,k.FAILED],[k.COMPLETED]:[k.IDLE],[k.RESTORED]:[k.IDLE],[k.FAILED]:[k.IDLE]};function W(t){return{[k.IDLE]:"未布局",[k.WAITING_ANIMATION]:"等待动画完成",[k.LAYOUTING]:"布局中",[k.WAITING_VALIDATION]:"等待验证",[k.VALIDATING]:"验证中",[k.COMPLETED]:"已完成",[k.RESTORED]:"已恢复",[k.FAILED]:"失败"}[t]}function $(t){return{[k.IDLE]:"⚪",[k.WAITING_ANIMATION]:"⏳",[k.LAYOUTING]:"🔄",[k.WAITING_VALIDATION]:"⏰",[k.VALIDATING]:"🔍",[k.COMPLETED]:"✅",[k.RESTORED]:"↩️",[k.FAILED]:"❌"}[t]}class U{static getState(t){if(!t)return s.w("获取状态失败：弹窗根节点为空",U.TAG),k.IDLE;return this.stateMap.get(t)||k.IDLE}static setState(t,e,n){if(!t)return s.w("设置状态失败：弹窗根节点为空",U.TAG),!1;const o=this.getState(t);if(o===e)return $(e),W(e),U.TAG,!0;if(i=e,!H[o].includes(i))return s.e(`❌ 非法状态转换: ${$(o)} ${W(o)} -> ${$(e)} ${W(e)}`,U.TAG),!1;var i;this.stateMap.set(t,e),this.timestampMap.set(t,Date.now());return $(o),W(o),$(e),W(e),U.TAG,!0}static resetState(t,e){if(!t)return;const n=this.getState(t);$(n),W(n),$(k.IDLE),W(k.IDLE),U.TAG,this.stateMap.set(t,k.IDLE),this.timestampMap.set(t,Date.now())}static clearState(t){if(!t)return;const e=this.getState(t);$(e),W(e),U.TAG,this.stateMap.delete(t),this.timestampMap.delete(t)}static canStartLayout(t){const e=this.getState(t),n=e===k.IDLE;return n||($(e),W(e),U.TAG),n}static isProcessing(t){const e=this.getState(t);return e===k.WAITING_ANIMATION||e===k.LAYOUTING||e===k.WAITING_VALIDATION||e===k.VALIDATING}static isCompleted(t){const e=this.getState(t);return e===k.COMPLETED||e===k.RESTORED}static getStateDuration(t){if(!t)return 0;const e=this.timestampMap.get(t);return e?Date.now()-e:0}static printState(t,e){if(!t)return;const n=this.getState(t);this.getStateDuration(t);$(n),W(n),U.TAG}}U.TAG=i.popupStateManager,U.stateMap=new WeakMap,U.timestampMap=new WeakMap;class V extends O{resetStyle(){throw new Error("Method not implemented.")}constructor(t){super(t.root_node),this.cancellationToken={cancelled:!1,generation:0},this.scale=1,this.minTop=1/0,this.maxBottom=-1/0,this.truncateNodes=[],this.truncateBkgImgNodes=[],this.bottomNode=null,this.needRestoreStyleNodes=new Set,this.needLayoutConstraintNodes=new Set,this.layoutConstraintResult=null,this.visualHeight=window.innerHeight,this.isCloseButtonTruncatedByScroll=!1,this.popupDecisionTreeType=M.Center,this.minScaleFactor=r.getInstance().getMinScaleFactor()/100,this.scaleAnimationDuration=r.getInstance().getScaleAnimationDuration(),this.popupInfo=t}printTree(t=!1){}setDirty(t){this.mDirty=t}intelligenceLayout(){null!==this.mComponent?(this.visualHeight=window.innerHeight-this.popupInfo.stickyBottom_height-this.popupInfo.stickyTop_height,this.mComponent.className,window.innerWidth,window.innerHeight,this.visualHeight,i.popupRelayout,this.popupInfo.popup_type,this.popupInfo.stickyTop_height,this.popupInfo.stickyBottom_height,i.popupRelayout,this.relayout()):i.popupRelayout}cancelPendingValidation(){this.cancellationToken.cancelled=!0,this.cancellationToken.generation,i.popupRelayout}relayout(){i.popupRelayout,this.cancellationToken={cancelled:!1,generation:Date.now()};const t=this.cancellationToken;t.generation,i.popupRelayout;const e=this.traverseTree(this.mComponent,[]);if(e.length,i.popupRelayout,this.findTruncateNodes(e),0===this.truncateNodes.length){i.popupRelayout;let t={resultCode:-1,errorMsg:"no truncateNodes found",duration:0,report:"no truncateNodes found"};return void(window.layoutConstraintResult=t)}if(this.truncateNodes.length,i.popupRelayout,this.popupDecisionTreeType=P.judgePopupDecisionTreeType(e,this.popupInfo),this.popupDecisionTreeType,i.popupRelayout,0!==this.truncateBkgImgNodes.length&&(this.truncateBkgImgNodes.length,i.popupRelayout,this.resetTruncateBkgImgNodes()),this.calScale(),F.getInstance().recordOriginalPosition(this.popupInfo.content_node),this.scale>1)return this.scale.toFixed(3),void i.popupRelayout;this.scale.toFixed(3),i.popupRelayout,i.popupRelayout,this.resetByScale(),this.popupDecisionTreeType===M.Center_Button_Overlap&&(i.popupRelayout,this.fixButtonOverlap()),_.flushAllStyles(),i.popupRelayout,i.popupRelayout,this.getLayoutConstraintReport(t)}getTopmostChildren(t,e){const n=Array.from(t.children).filter(t=>{const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&t instanceof HTMLElement&&1===parseFloat(e.opacity)&&!G.isBackgroundSemiTransparent(e)});if(0===n.length)return[];let o=window.getComputedStyle(this.popupInfo.mask_node).zIndex;o=e===x.C||e===x.A?-1:"auto"===o?0:parseInt(o,10);const i=n.map(t=>{let e=window.getComputedStyle(t).zIndex;return e="auto"===e?0:parseInt(e,10),{element:t,zIndex:e,domOrder:n.indexOf(t)}}).filter(t=>t.zIndex>=o);i.sort((t,e)=>t.zIndex!==e.zIndex?e.zIndex-t.zIndex:e.domOrder-t.domOrder);const s=i.map(t=>t.element);return s.length,s}getValidGrandChildren(t){return t.filter(t=>{const e=getComputedStyle(t).transform.match(/matrix\((.*?),(.*?),(.*?),(.*?),(.*?),(.*?)\)/),n=e?parseFloat(e[6]):0;return Math.abs(n)<=window.innerHeight})}calScale(){i.popupRelayout,this.truncateNodes.forEach(t=>{t.className,i.popupRelayout;let e=t.getBoundingClientRect();this.minTop=Math.min(this.minTop,e.top),e.bottom>this.maxBottom&&(this.bottomNode=t,this.maxBottom=e.bottom);let n=t;n=t===this.mComponent?t:t.parentElement;const o=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode(t){if(!(t instanceof HTMLElement))return NodeFilter.FILTER_REJECT;const e=window.getComputedStyle(t.parentElement).overflowY,n="scroll"===e||"auto"===e,o=t.parentElement.scrollHeight>t.parentElement.clientHeight;return n&&o?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let s=o.nextNode();for(;s;){let t=s.getBoundingClientRect().top,e=s.getBoundingClientRect().bottom;this.minTop=Math.min(this.minTop,t),e>this.maxBottom&&(this.bottomNode=s,this.maxBottom=e),s=o.nextNode()}});let t=this.maxBottom-this.minTop,e=this.visualHeight;this.scale=.7*e/t,this.scale=Math.max(this.scale,this.minScaleFactor),this.scale,this.bottomNode.className}resetByScale(){if(x[this.popupInfo.popup_type],i.popupRelayout,this.popupInfo.popup_type===x.C){i.popupRelayout;let t=this.getTopmostChildren(this.mComponent,this.popupInfo.popup_type);t.length,i.popupRelayout;for(let e of t){const n=e.children.length>0?getComputedStyle(e.children[0]):null,o=e.getBoundingClientRect(),i=!!n&&("fixed"===n.position||"absolute"===n.position),s=0===o.width||0===o.height;this.scaleChildForTypeC(n,i,s,e,t)}}else if(this.popupInfo.popup_type===x.B){i.popupRelayout,this.equivalentMask=this.getEquivalentMask(),this.equivalentMask.className,i.popupRelayout;let t=this.getTopmostChildren(this.equivalentMask.parentElement,this.popupInfo.popup_type);t.filter(t=>t!==this.equivalentMask),t.length,i.popupRelayout;for(let e of t){if(this.equivalentMask.contains(e))continue;const n=e.children.length>0?getComputedStyle(e.children[0]):null,o=e.getBoundingClientRect(),i=!!n&&("fixed"===n.position||"absolute"===n.position),s=0===o.width||0===o.height;n&&i&&s?this.scaleGrandChildrenForTypeB(e,t):this.scaleChildForTypeB(e,t)}}else if(this.popupInfo.popup_type===x.A){i.popupRelayout;let t=this.getTopmostChildren(this.popupInfo.mask_node,this.popupInfo.popup_type);t.length,i.popupRelayout;for(let e of t)this.scaleByTransform(e,this.scale,!1,t,!1,[]),e.className,i.popupRelayout}i.popupRelayout}scaleChildForTypeB(t,e){this.popupDecisionTreeType===M.Bottom?(t.className,i.popupRelayout,this.scaleByTransform(t,this.scale,!1,e,!1,[])):(t.className,e.length,i.popupRelayout,this.scaleByTransform(t,this.scale,e.length>1,e,!1,[]))}scaleGrandChildrenForTypeB(t,e){const n=this.getValidGrandChildren(Array.from(t.children));t.className,n.length,i.popupRelayout;for(let o=0;o<n.length;o++){const t=n[o];this.popupDecisionTreeType===M.Bottom?this.scaleByTransform(t,this.scale,!1,e,n.length>1,n):this.scaleByTransform(t,this.scale,e.length>1,e,n.length>1,n),t.className,i.popupRelayout}}scaleChildForTypeC(t,e,n,o,s){if(t&&e&&n){o.className,i.popupRelayout;const t=this.getValidGrandChildren(Array.from(o.children));t.length,i.popupRelayout;for(let e=0;e<t.length;e++){const n=t[e];this.scaleByTransform(n,this.scale,s.length>1,s,t.length>1,t),n.className,i.popupRelayout}}else o.className,i.popupRelayout,this.scaleByTransform(o,this.scale,s.length>1,s,!1,[])}getEquivalentMask(){let t=this.popupInfo.mask_node;if(this.popupInfo.popup_type!==x.B)return t;let e=t;if(t!==this.mComponent&&t.parentElement!==this.mComponent&&!L.hasElementSiblings(t)){let n=t.parentElement;for(;n!==this.mComponent&&!L.hasElementSiblings(n);)n=n.parentElement;e=n}return e}resetTruncateBkgImgNodes(){this.truncateBkgImgNodes.forEach(t=>{t!==this.popupInfo.mask_node&&(_.setStyle(t,u.background_size,"contain"),this.needRestoreStyleNodes.add(t))})}makeAllOverflowVisible(t){for(;t&&t!==document.documentElement;){"visible"!==window.getComputedStyle(t).overflow&&(_.setStyle(t,u.overflow,"visible"),this.needRestoreStyleNodes.add(t)),t=t.parentElement}}handleScrollbar(t){t.forEach(t=>{const e=window.getComputedStyle(t.parentElement).overflowY;!G.hasCloseButton(t)||"auto"!==e&&"scroll"!==e||(_.setStyle(t.parentElement,u.overflow,"visible"),this.isCloseButtonTruncatedByScroll=!0,this.makeAllOverflowVisible(t.parentElement),this.needRestoreStyleNodes.add(t.parentElement))})}findTruncateNodes(t){i.popupRelayout;const e=t.filter(t=>L.isNodeTruncated(t,this.popupInfo));e.length,i.popupRelayout,this.truncateBkgImgNodes=t.filter(t=>L.checkIfBackgroundImgTruncated(t)),this.truncateBkgImgNodes.length,i.popupRelayout,this.handleScrollbar(e),this.truncateNodes=this.filterContainedNodes(e),this.truncateNodes.length,i.popupRelayout,this.truncateNodes.forEach(t=>{t.className,i.popupRelayout})}traverseTree(t,e){e.push(t);for(let n=0;n<t.childNodes.length;n++)t.childNodes[n]instanceof HTMLElement&&this.traverseTree(t.childNodes[n],e);return e}async getLayoutConstraintReport(t){if(0!==this.needLayoutConstraintNodes.size)try{if(!U.setState(this.popupInfo.root_node,k.WAITING_VALIDATION,"开始等待验证"))return void i.popupRelayout;this.needLayoutConstraintNodes.size,i.popupRelayout;const e=26;if(await this.forceLayoutUpdate(e),t.cancelled)return t.generation,void i.popupRelayout;const n=U.getState(this.popupInfo.root_node);if(n!==k.WAITING_VALIDATION)return void i.popupRelayout;if(!U.setState(this.popupInfo.root_node,k.VALIDATING,"开始验证"))return void i.popupRelayout;if(this.layoutConstraintResult=B.detectLayoutConstraintMetrics(this.popupInfo,this.needLayoutConstraintNodes),this.layoutConstraintResult.resultCode,i.popupRelayout,t.cancelled)return void i.popupRelayout;this.layoutConstraintResult.resultCode===u.ERR_CODE_GAPS||this.layoutConstraintResult.resultCode===u.ERR_CODE_OVERFLOW?(this.layoutConstraintResult.resultCode,i.popupRelayout,this.restoreStyles(),U.setState(this.popupInfo.root_node,k.RESTORED,"验证失败，已恢复")):(i.popupRelayout,U.setState(this.popupInfo.root_node,k.COMPLETED,"验证通过")),this.needLayoutConstraintNodes.clear(),window.layoutConstraintResult=this.layoutConstraintResult,i.popupRelayout}catch(e){t.cancelled||(s.e("布局约束验证失败",i.popupRelayout,e),U.setState(this.popupInfo.root_node,k.FAILED,`验证异常: ${e}`),this.restoreStyles())}else i.popupRelayout}async forceLayoutUpdate(t=1){const e=()=>new Promise(t=>requestAnimationFrame(t));if(!(t<=0)){await e(),document.body.offsetHeight;for(let n=1;n<t;n++)await e(),await e(),document.body.offsetHeight}}filterContainedNodes(t){const e=new Set(t),n=[];for(const o of t){let t=o.parentElement,i=!1;for(;null!==t;){if(e.has(t)){i=!0;break}t=t.parentElement}i||n.push(o)}return n}calculateGroupCenter(t,e){if(!t)return{centerX:0,centerY:0};if(!t.parentNode)return{centerX:0,centerY:0};const n=e.filter(t=>{const e=t.getBoundingClientRect();return e.width>0&&e.height>0}).map(t=>t.getBoundingClientRect()),o=Math.min(...n.map(t=>t.top)),i=Math.max(...n.map(t=>t.bottom)),s=Math.min(...n.map(t=>t.left));return{centerX:s+(Math.max(...n.map(t=>t.right))-s)/2,centerY:o+(i-o)/2}}scaleByTransform(t,e,n,o,s,a){if(null==t||t.className,e.toFixed(3),i.popupRelayout,this._shouldSkipScaling(t))return null==t||t.className,void i.popupRelayout;const r=window.getComputedStyle(t),l=L.getVisualBoundingRect(t,this.isCloseButtonTruncatedByScroll,this.popupDecisionTreeType);this.needLayoutConstraintNodes.add(t);let c=this._calculateOffsetY(t,l,e,{hasBrother:n,brotherNodes:o,hasGrandChild:s,grandChildNodes:a});c.toFixed(2),t.className,i.popupRelayout,this._applyStyleFixes(t,r),this._applyTransform(t,r,c,e),t.className,i.popupRelayout}_shouldSkipScaling(t){const e=window.getComputedStyle(t),n=L.getVisualBoundingRect(t,this.isCloseButtonTruncatedByScroll,this.popupDecisionTreeType),o=e.transform.match(/matrix\((.*?),(.*?),(.*?),(.*?),(.*?),(.*?)\)/),s=o?parseFloat(o[6]):0;if(Math.abs(s)>window.innerHeight&&!this._isElementInViewport(n))return!0;if(this.popupDecisionTreeType===M.Bottom&&n.scrollElement){const t=n.scrollElement.getBoundingClientRect();if(!this._isElementInViewport(t))return!0;{const e=(window.innerHeight-t.top)/window.innerHeight*100;e.toFixed(2),i.popupRelayout,_.setStyle(n.scrollElement,u.max_height,`${e}vh`),this.needRestoreStyleNodes.add(n.scrollElement)}}return this.popupDecisionTreeType===M.Picker}_isElementInViewport(t){return t.top<window.innerHeight&&t.left<window.innerWidth&&t.bottom>0&&t.right>0}_calculateOffsetY(t,e,n,o){let i=0;const s=e.top+e.height/2;switch(this.popupDecisionTreeType){case M.Bottom:i=window.innerHeight-(s+e.height/2*n);break;case M.Center:case M.Center_Button_Overlap:i=this._calculateCenterOffsetY(t,s,n,o),i-=this.popupInfo.stickyBottom_height/2,i+=this.popupInfo.stickyTop_height/2}return i+=n*e.offsetY,i}_calculateCenterOffsetY(t,e,n,o){let s=0;if(o.hasBrother){const a=this.calculateGroupCenter(t,o.brotherNodes).centerY;s=window.innerHeight/2-a+(e-a)*(n-1),a.toFixed(0),s.toFixed(2),i.popupRelayout}else s=window.innerHeight/2-e,s.toFixed(2),i.popupRelayout;if(o.hasGrandChild){const a=(this.calculateGroupCenter(t,o.grandChildNodes).centerY-e)*(n-1);s+=a,a.toFixed(2),i.popupRelayout}return s}_applyStyleFixes(t,e){"inline"===e.display&&(_.setStyle(t,u.display,"block"),this.needRestoreStyleNodes.add(t));for(let n of t.children)""!==n.style.bottom&&"auto"!==n.style.bottom&&(_.setStyle(n,u.bottom,"unset"),this.needRestoreStyleNodes.add(n));this.adjustChildWidths(t)}_applyTransform(t,e,n,o){const i=e.transform===u.none?"":e.transform;_.setStyle(t,u.transform,`${i} translate(0px, ${n}px) scale(${o})`),_.setStyle(t,u.transition,`all ${this.scaleAnimationDuration}ms ease-in`),this.needRestoreStyleNodes.add(t)}adjustChildWidths(t){const e=window.getComputedStyle(t);if(0===parseFloat(e.width))return;const n=t.children;for(let o=0;o<n.length;o++){const t=n[o],e=window.getComputedStyle(t);0===parseFloat(e.width)&&(_.setStyle(t,u.width,u.num100percent),this.needRestoreStyleNodes.add(t))}}restoreStyles(){this.needRestoreStyleNodes.size,i.popupRelayout,this.needRestoreStyleNodes.forEach((t,e)=>{D.removeAllStyle(e)}),_.flushAllStyles(),this.needRestoreStyleNodes.clear(),i.popupRelayout}fixFlexShrink(t){const e=[];window.getComputedStyle(this.mComponent).display.includes(u.flex)&&e.push(this.mComponent),this.mComponent.querySelectorAll("*").forEach(t=>{window.getComputedStyle(t).display.includes(u.flex)&&e.push(t)});e.forEach(t=>{Array.from(t.children).forEach(e=>{if(getComputedStyle(t).flexDirection===u.column&&(_.setStyle(e,u.flex_shrink,"0"),this.needRestoreStyleNodes.add(e)),t.clientWidth>0&&t.clientHeight>0&&(_.setStyle(e,u.max_width,"100%"),this.needRestoreStyleNodes.add(e)),G.hasButton(e)){const t=window.getComputedStyle(e).width;_.setStyle(e,u.width,t),this.needRestoreStyleNodes.add(e)}0})}),e.length}fixButtonOverlap(){i.popupRelayout;const t=this.mComponent.querySelectorAll('[class*="close"]');if(1!==t.length)return t.length,void i.popupRelayout;const e=t[0];e.className,i.popupRelayout;const n=getComputedStyle(e);this.needLayoutConstraintNodes.add(e);const o=n.transform===u.none?"":n.transform;let s=0;const a=e.getBoundingClientRect().top,r=getComputedStyle(this.bottomNode),l=this.bottomNode.getBoundingClientRect().bottom;e===this.bottomNode?(s=parseFloat(r.height),s.toFixed(2),i.popupRelayout):(s=l-a,s.toFixed(2),l.toFixed(0),a.toFixed(0),i.popupRelayout),s/=this.scale;let c=`${o} translate(0px, ${s}px)`;_.setStyle(e,u.transform,c),_.setStyle(e,u.transition,`all ${this.scaleAnimationDuration}ms ease-in`),this.needRestoreStyleNodes.add(e),s.toFixed(2),i.popupRelayout}}const z={features:["root_position","has_mask","root_screen_area_ratio","root_is_visiable","has_close_button","mask_area_ratio","mask_position"],coefficients:[-.008,.565,1.012,-.214,.377,2.006,.868],intercept:3.593,scalerMean:[3.546,.948,47.741,.588,.856,80.64,4.165],scalerScale:[.557,.221,48.176,.492,.351,38.879,.621]},j={sticky:1,relative:2,static:3,fixed:4,absolute:5};class Y{static preprocessFeatures(t){var e,n;const o={},i=String(t.root_position).toLowerCase();o.root_position=null!==(e=j[i])&&void 0!==e?e:NaN;const s=String(t.mask_position).toLowerCase();return o.mask_position=null!==(n=j[s])&&void 0!==n?n:NaN,o.has_mask=t.has_mask?1:0,o.root_is_visiable=t.root_is_visiable?1:0,o.has_close_button=t.has_close_button?1:0,o.root_screen_area_ratio=t.root_screen_area_ratio,o.mask_area_ratio=t.mask_area_ratio,o}static predictIsPopup(t){const e=Y.preprocessFeatures(t);let n=z.intercept;for(let r=0;r<z.features.length;r++){const t=z.features[r],o=e[t];if(void 0===o||isNaN(o))return s.w(`预处理后的特征 '${t}' 是 undefined 或 NaN，返回非弹窗预测`,i.popupRecog),{prediction:0,probability:0};{const t=(o-z.scalerMean[r])/z.scalerScale[r];n+=z.coefficients[r]*t}}const o=(a=n,1/(1+Math.exp(-a)));var a;return{prediction:o>=.5?1:0,probability:o}}}class q{static isStickyComponentVisiable(t){const e=[t,...t.children];for(;e.length>0;){const t=e.shift();if(!(t instanceof HTMLElement))continue;const n=getComputedStyle(t),o=t.offsetWidth,i=t.offsetHeight;if("none"===n.display||"hidden"===n.visibility||0===parseFloat(n.opacity))continue;if(0===o||0===i||G.isColorTransparent(n.backgroundColor)&&!n.backgroundImage.includes("url")){e.push(...t.children);continue}return Math.abs(o-screen.availWidth)<2}return!1}static getPotentialElements(t){const e=Array.from(t.getElementsByTagName("*")).filter(t=>t.nodeType===Node.ELEMENT_NODE);let n=new Array,o=null,i=null;for(const s of e){const t=getComputedStyle(s);if(!this.isElementQualified(s,t))continue;if(this.isPotentialMask(s,t)){n.push(s);continue}const e=this.checkStickyElement(s,t,o,i);o=e.potentialStickyTop,i=e.potentialStickyBottom}return{potentialMasks:n,potentialStickyTop:o,potentialStickyBottom:i}}static isElementQualified(t,e){const n=t.offsetWidth>0&&t.offsetHeight>0&&"none"!==e.display&&"hidden"!==e.visibility&&parseFloat(e.opacity)>0,o="hidden"!==e.visibility&&0===parseFloat(e.opacity)&&G.isColorSemiTransparent(e.backgroundColor);return!(!n&&!o)&&!(Math.abs(t.offsetWidth-window.innerWidth)>=2)}static isPotentialMask(t,e){const n=G.getScreenAreaRatio(t),o=r.getInstance().getMinMaskAreaRatioThreshold();if(n>o&&G.isBackgroundSemiTransparent(e))return t.className,n.toFixed(2),i.popupDetector,!0;if(n>o&&e.position===u.fixed&&1===t.children.length){const e=t.children[0];if(getComputedStyle(e).position===u.absolute&&G.getScreenAreaRatio(e)>r.getInstance().getMinContentAreaRatioThreshold()&&G.hasCloseButton(e))return t.className,i.popupDetector,!0}return!("fixed"!==e.position||!L.analyzeComputedBoxShadow(e.boxShadow))&&(t.className,i.popupDetector,!0)}static checkStickyElement(t,e,n,o){let i=n,s=o;const a=G.getScreenAreaRatio(t);return"fixed"===e.position&&0===parseInt(e.left)&&a>r.getInstance().getMinSARTofStickyComponent()&&a<r.getInstance().getMaxSARTofStickyComponent()&&q.isStickyComponentVisiable(t)?(0===parseInt(e.top)&&(t.className,(null===i||q.isFirstElementOnTop(t,i))&&(i=t)),0===parseInt(e.bottom)&&(t.className,(null===s||q.isFirstElementOnTop(t,s))&&(s=t)),{potentialStickyTop:i,potentialStickyBottom:s}):{potentialStickyTop:n,potentialStickyBottom:o}}static isFirstElementOnTop(t,e){if(!t||!e)return!1;const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),i=Math.max(n.left,o.left),s=Math.max(n.top,o.top),a=Math.min(n.right,o.right),r=Math.min(n.bottom,o.bottom);if(a<=i||r<=s)return!1;const l=i+(a-i)/2,c=s+(r-s)/2,u=document.elementFromPoint(l,c);return!!u&&(u!==e&&!e.contains(u))}static findPopups(t){i.popupDetector;const e=q.getPotentialElements(t);e.potentialMasks.length,i.popupDetector,e.potentialStickyTop&&(e.potentialStickyTop.className,i.popupDetector),e.potentialStickyBottom&&(e.potentialStickyBottom.className,i.popupDetector);const n=q.findPopupsInternal(e);return i.popupDetector,n}static findTopMostPopup(t){return t&&0!==t.length?t.reduce((t,e)=>L.compareZIndex(t.root_node,e.root_node)>=0?t:e):null}static findBestCandidateInSibling(t,e,n){i.popupDetector,t.className||t.tagName,i.popupDetector,e.className||e.tagName,i.popupDetector;let o=null,s=0;const a=[t,...Array.from(t.querySelectorAll("*"))];i.popupDetector;const r=q.isPreviousElementSibling(e,t),l=r?1:0;i.popupDetector,i.popupDetector;for(const c of a){const t=G.zIndexToNumber(window.getComputedStyle(c).zIndex);if(t>=n+l){0;const t=G.getScreenAreaRatio(c);if(t>s){o&&(o.className||o.tagName,s.toFixed(2));s=t,o=c,c.className||c.tagName,t.toFixed(2),i.popupDetector}}else 0}return i.popupDetector,o?(o.className||o.tagName,s.toFixed(2),i.popupDetector):i.popupDetector,{candidate:o,ratio:s}}static findBestSiblingContent(t){t.className,i.popupDetector;let e=null,n=0;const o=G.zIndexToNumber(window.getComputedStyle(t).zIndex),[s,a]=G.findSiblingContent(t);s.length,i.popupDetector;for(const r of s){const s=this.findBestCandidateInSibling(r,t,o);s.ratio>n&&(n=s.ratio,e=s.candidate,n.toFixed(2),i.popupDetector)}const l=n>=r.getInstance().getMinContentAreaRatioThreshold();return i.popupDetector,l?[e,a]:[null,null]}static findPopupsInternal(t){const{potentialMasks:e,potentialStickyTop:n,potentialStickyBottom:o}=t;if(!e||0===e.length)return i.popupDetector,null;e.sort((t,e)=>G.getElementDepth(e)-G.getElementDepth(t)),G.getElementDepth(e[0]),i.popupDetector;const s=e.map(t=>this.identifyPopupFromMask(t)).filter(t=>null!==t);if(0===s.length)return i.popupDetector,null;s.length,i.popupDetector;const a=this.filterNestedPopups(s),r=this.filterByPrediction(a),l=q.findTopMostPopup(r);return l?(l.root_node.className,l.popup_type,i.popupDetector,this.updateStickyHeights(l,{potentialStickyTop:n,potentialStickyBottom:o}),l):(i.popupDetector,null)}static identifyPopupFromMask(t){t.className,i.popupDetector;const e=this.determinePopupStructure(t);if(!e)return i.popupDetector,null;const{rootNode:n,contentNode:o,popupType:s}=e;return n.className,i.popupDetector,{info:this.createPopupInfo(n,t,o,s),node:n}}static determinePopupStructure(t){const[e,n]=q.findBestSiblingContent(t);if(e&&n){const o=t.parentNode;if(!(o&&o instanceof Element))return null;const i=getComputedStyle(o);return!("none"===i.display||"hidden"===i.visibility||0===parseFloat(i.opacity))?{contentNode:e,rootNode:n,popupType:x.B}:null}return this.findDescendantBasedPopup(t)}static findDescendantBasedPopup(t){const e=q.findBestDescendantContent(t);if(!e||!G.visualFilter(t))return i.popupDetector,null;const n=window.getComputedStyle(t).position;if(i.popupDetector,"fixed"===n||"absolute"===n)return i.popupDetector,{contentNode:e,rootNode:t,popupType:x.C};{const n=this.findPositionedAncestor(t)||t.parentElement;if(n)return n.className,i.popupDetector,{contentNode:e,rootNode:n,popupType:x.A}}return null}static findPositionedAncestor(t){let e=t.parentElement;for(;e&&e!==document.body;){const t=window.getComputedStyle(e).position;if("fixed"===t||"absolute"===t)return e;e=e.parentElement}return null}static filterNestedPopups(t){t.length,i.popupDetector;const e=new Set;for(const o of t)for(const n of t){if(o===n)continue;let t=!1;if(o.node!==n.node)t=o.node.contains(n.node);else{const e=o.info.mask_node,i=n.info.mask_node;t=e!==i&&e.contains(i)}if(t){e.add(o.info),o.node.className,i.popupDetector;break}}const n=t.map(t=>t.info).filter(t=>!e.has(t));return n.length,i.popupDetector,n}static filterByPrediction(t){t.length,i.popupDetector;const e=t.filter(t=>{if(t.has_mask&&t.mask_area_ratio>95&&("fixed"===t.mask_position||"absolute"===t.mask_position))return t.root_node.className,i.popupDetector,!0;const e=Y.predictIsPopup(t);return e.prediction,t.root_node.className,i.popupDetector,e.prediction});return e.length,i.popupDetector,e}static updateStickyHeights(t,e){const{potentialStickyTop:n,potentialStickyBottom:o}=e;n&&L.compareZIndex(t.mask_node,n)<=0&&(t.stickyTop_height=parseInt(getComputedStyle(n).height,10)||0),o&&L.compareZIndex(t.mask_node,o)<=0&&(t.stickyBottom_height=parseInt(getComputedStyle(o).height,10)||0)}static createPopupInfo(t,e,n,o){const i=window.getComputedStyle(t),s=window.getComputedStyle(e);return{root_node:t,mask_node:e,content_node:n,popup_type:o,root_position:i.position,root_zindex:G.zIndexToNumber(i.zIndex),has_mask:!0,root_screen_area_ratio:G.getScreenAreaRatio(t),root_is_visiable:G.isElementVisibleInViewPort(t),has_close_button:G.hasCloseButton(n||t),mask_area_ratio:G.getScreenAreaRatio(e),mask_position:s.position,mask_zindex:G.zIndexToNumber(s.zIndex),stickyTop_height:0,stickyBottom_height:0}}static isPreviousElementSibling(t,e){if(!t||!e||t.parentNode!==e.parentNode)return!1;let n=t.previousElementSibling;for(;n;){if(n===e)return!0;n=n.previousElementSibling}return!1}}q.findBestDescendantContent=t=>{t.className,i.popupDetector;let e=null,n=0;const o=Array.from(t.querySelectorAll("*"));o.length,i.popupDetector;for(const i of o){if(!1===G.visualFilter(i))continue;const t=G.getScreenAreaRatio(i);t>n&&(n=t,e=i)}const s=n>=r.getInstance().getMinContentAreaRatioThreshold();return n.toFixed(2),i.popupDetector,s?e:null};class X{static relayoutForPopWin(){X.TAG;let t=null;t=X.popWindowMap.size>0?X.popWindowMap.keys().next().value:q.findPopups(document.body),null!=t&&X.calculateForPopWin(t)}static intelligentLayout(t){var e;X.TAG;let n=X.popWindowMap.size>0?X.popWindowMap.keys().next().value:q.findPopups(t);null===(e=null==n?void 0:n.root_node)||void 0===e||e.className,X.TAG,null!=n&&X.calculateForPopWin(n),X.TAG}static recoverPopwinStyle(){for(const t of X.popWindowMap.values())t instanceof V&&t.restoreStyles();X.popWindowMap.clear()}static removePopwinCache(t){let e=!1;for(const[n,o]of X.popWindowMap.entries())t.contains(n.root_node)&&(n.root_node,X.TAG,U.clearState(n.root_node),X.popWindowMap.delete(n),e=!0);return e}static calculateForPopWin(t){var e;if(null===(e=null==t?void 0:t.root_node)||void 0===e||e.className,X.TAG,!U.canStartLayout(t.root_node))return void U.printState(t.root_node,"跳过布局 - 弹窗正在处理中");U.setState(t.root_node,k.LAYOUTING,"开始布局");const n=X.popWindowMap.has(t)?X.popWindowMap.get(t):new V(t);if(n&&n.isDirty())try{n.intelligenceLayout(),n.setDirty(!1)}catch(o){U.setState(t.root_node,k.FAILED,`布局失败: ${o}`),s.e(`布局失败: ${o}`,X.TAG)}n&&!X.popWindowMap.has(t)&&X.popWindowMap.set(t,n),window.popupInfo=t}static markDirty(t){if(t&&!G.shouldSkip(t))for(const[e,n]of X.popWindowMap.entries())n.isDirty()||e&&e.root_node&&n&&e.root_node.contains(t)&&n.setDirty(!0)}static resetAllPopWindows(){var t;X.TAG;for(const[e,n]of X.popWindowMap.entries())null===(t=e.root_node)||void 0===t||t.className,X.TAG,n instanceof V&&n.cancelPendingValidation(),U.resetState(e.root_node,"窗口尺寸变化"),n instanceof V&&n.restoreStyles(),n.setDirty(!0);X.popWindowMap.clear(),X.TAG}static reInit(){X.recoverPopwinStyle(),X.popWindowMap.clear()}}X.TAG=i.intelligentLayout,X.popWindowMap=new Map;class Z{static reInit(){Z.TAG,Z.modifyObserver&&(Z.TAG,Z.modifyObserver.disconnect()),document.body.id,Z.TAG,Z.TAG,Z.modifyObserver=new MutationObserver(Z.onElementModify),Z.modifyObserver.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0}),Z.addAnimationListeners(),Z.TAG}static cancelAllAnimationTimeouts(){const t=Z.activeAnimationTimeouts.size;if(t>0){Z.TAG;for(const[t,e]of Z.activeAnimationTimeouts.entries())clearTimeout(t),e.tagName,e.className,Z.TAG;Z.activeAnimationTimeouts.clear(),Z.TAG}}static addAnimationListeners(){Z.animationListenerAdded||(Z.TAG,Z.animationStartHandler=t=>{Z.handleAnimationEvent(t,"animation")},Z.transitionStartHandler=t=>{Z.handleAnimationEvent(t,"transition")},document.body.addEventListener("animationstart",Z.animationStartHandler,!0),document.body.addEventListener("transitionstart",Z.transitionStartHandler,!0),Z.animationListenerAdded=!0),Z.TAG}static handleAnimationEvent(t,e){const n=t.target;"animation"===e&&t instanceof AnimationEvent?(n.tagName,n.className,t.animationName,Z.TAG):"transition"===e&&t instanceof TransitionEvent&&(n.tagName,n.className,t.propertyName,Z.TAG);const o=Z.findPopupRoot(n);Z.updatePopupStateOnAnimationStart(o,e);const i=Z.getDurationFromElement(n);Z.createAnimationTimeout(n,o,i,e)}static updatePopupStateOnAnimationStart(t,e){if(!t)return;const n=U.getState(t);if(n===k.IDLE){const n="animation"===e?"检测到动画开始":"检测到过渡开始";U.setState(t,k.WAITING_ANIMATION,n)}else k[n],Z.TAG}static createAnimationTimeout(t,e,n,o){if(n<=0)return;Z.TAG;const i=setTimeout(()=>{Z.activeAnimationTimeouts.delete(i);if(Z.TAG,e&&U.getState(e)===k.WAITING_ANIMATION){const t="animation"===o?"动画完成":"过渡完成";U.setState(e,k.IDLE,t)}tt.postTask()},n);Z.activeAnimationTimeouts.set(i,t)}static findPopupRoot(t){for(const[e]of X.popWindowMap.entries())if(e.root_node&&e.root_node.contains(t))return e.root_node;return null}static disconnect(){var t;Z.TAG;const e=Z.pendingRecords.length;e>0&&s.w(`清理 ${e} 个待处理的变更记录`,Z.TAG),null===(t=Z.modifyObserver)||void 0===t||t.disconnect(),Z.modifyObserver=null,Z.pendingRecords=[],Z.scheduledWork=!1,Z.cancelAllAnimationTimeouts(),Z.animationListenerAdded&&(Z.TAG,Z.animationStartHandler&&(document.body.removeEventListener("animationstart",Z.animationStartHandler,!0),Z.animationStartHandler=null),Z.transitionStartHandler&&(document.body.removeEventListener("transitionstart",Z.transitionStartHandler,!0),Z.transitionStartHandler=null),Z.animationListenerAdded=!1,Z.TAG),Z.TAG}static handleRemove(t){if(0===t.length)return!1;t.length,Z.TAG;let e=!1;for(const n of t){for(let t=0;t<n.removedNodes.length;t++){let o=n.removedNodes[t];if(o.nodeType!==Node.ELEMENT_NODE)continue;0;const i=X.removePopwinCache(o);i&&(o.tagName,o.className,Z.TAG),e=e||i,D.resetEle(o,!0)}D.resetParent(n.target)}return Z.TAG,e}static checkElementAddNeedPostTask(t){let e=!1,n=0,o=0;for(let i=0;i<t.addedNodes.length;i++){const s=t.addedNodes[i];s.nodeType===Node.ELEMENT_NODE&&(s.tagName,s.className,Z.TAG,s.style.display!==u.none?(s.tagName,s.className,Z.TAG,n++,e=!0):(s.tagName,s.className,Z.TAG,o++))}return(n>0||o>0)&&Z.TAG,e}static onElementModify(t){t.length,Z.TAG,Z.pendingRecords.push(...t),Z.scheduledWork?(Z.pendingRecords.length,Z.TAG):(Z.TAG,Z.scheduledWork=!0,queueMicrotask(()=>{const t=Z.pendingRecords;Z.pendingRecords=[],Z.scheduledWork=!1,t.length,Z.TAG,Z.processBatch(t)}))}static processBatch(t){if(0===t.length)return void Z.TAG;t.length,Z.TAG;const e=[],n=[],o=[];for(let r=0;r<t.length;r++){const i=t[r];i.removedNodes.length>0&&e.push(i),i.addedNodes.length>0&&n.push(i),"attributes"===i.type&&o.push(i)}e.length,n.length,o.length,Z.TAG;const i=Z.handleRemove(e);Z.TAG;let s=Z.calculateAnimationDuration(n,o);if(s>0){Z.TAG;const t=setTimeout(()=>{Z.activeAnimationTimeouts.delete(t),Z.TAG,tt.postTask()},s);Z.activeAnimationTimeouts.set(t,document.body)}Z.TAG;const a=Z.handleAddedNodes(n);0===s&&(i||a)?(Z.TAG,tt.postTask()):Z.TAG,Z.TAG}static handleAddedNodes(t){let e=!1;if(0===t.length)return Z.TAG,!1;t.length,Z.TAG;for(let n=0;n<t.length;n++){Z.checkElementAddNeedPostTask(t[n])&&(e=!0,X.markDirty(t[n].target))}return Z.TAG,e}static calculateAnimationDuration(t,e){let n=0;if(0===t.length&&0===e.length)return Z.TAG,n;t.length,e.length,Z.TAG;const o=new Set;return n=Z.getAnimationDurationInAttriChange(e,o,n),n=Z.getAnimationDurationInAddNodes(t,o,n),n>0?(o.size,Z.TAG):Z.TAG,n}static processAddedNode(t,e,n){if(!(t instanceof HTMLElement)||e.has(t))return{newDuration:n,detected:!1};e.add(t);const o=Z.getDurationFromElement(t);let i=!1;return o>0&&(t.tagName,t.className,Z.TAG,i=!0),{newDuration:Math.max(o,n),detected:i}}static getAnimationDurationInAddNodes(t,e,n){let o=0;for(let i=0;i<t.length;i++){const s=t[i].addedNodes;for(let t=0;t<s.length;t++){const i=Z.processAddedNode(s[t],e,n);n=i.newDuration,i.detected&&o++}}return o>0&&Z.TAG,n}static getAnimationDurationInAttriChange(t,e,n){let o=0;for(let i=0;i<t.length;i++){const s=t[i].target;t[i].attributeName;if(s instanceof HTMLElement&&!e.has(s)){e.add(s);const t=Z.getDurationFromElement(s);t>0&&(s.tagName,s.className,Z.TAG,o++),t>n&&(n=t,X.markDirty(s))}}return o>0&&Z.TAG,n}static getDurationFromElement(t){const e=Z.getAnimDurations(t),n=Math.max(e.animationDur,e.transitionDur);return n>0&&(e.animationDur,e.transitionDur,Z.TAG),n}static cssTimeToMs(t){if(!t||"0s"===t||"0ms"===t)return 0;const e=t.trim().match(/^([\d.]+)(s|ms)$/);if(!e)return Z.TAG,0;const[,n,o]=e;return"s"===o?1e3*parseFloat(n):parseFloat(n)}static getAnimDurations(t){const e=getComputedStyle(t),n=Z.cssTimeToMs(e.animationDuration),o=Z.cssTimeToMs(e.transitionDuration),i=n+o;return i>0&&(t.tagName,t.className,e.animationDuration,e.transitionDuration,Z.TAG),{animationDur:n,transitionDur:o,total:i}}}Z.TAG=i.modifyObserver,Z.pendingRecords=[],Z.scheduledWork=!1,Z.animationListenerAdded=!1,Z.animationStartHandler=null,Z.transitionStartHandler=null,Z.activeAnimationTimeouts=new Map;class J{static reInit(){J.TAG,J.TAG,J.contentReady=!1,J.disconnect(),J.TAG}static isContentReady(){if(J.TAG,J.contentReady)return J.TAG,!0;J.TAG;return J.checkPageContent()?(J.TAG,J.contentReady=!0,J.disconnect(),!0):(s.w("⚠️ 页面内容未就绪（骨架屏/白屏状态）",J.TAG),!1)}static startObserving(){if(J.observer)return void J.TAG;J.TAG,J.TAG;J.observer=new MutationObserver(()=>{J.TAG,J.checkPageContent()?(J.TAG,J.contentReady=!0,J.disconnect(),J.TAG,tt.postTask()):J.TAG}),document.body?(J.observer.observe(document.body,{childList:!0,subtree:!0}),J.TAG):s.e("document.body不存在，无法启动观察器",J.TAG)}static disconnect(){J.observer&&(J.TAG,J.observer.disconnect(),J.observer=null)}static checkPageContent(){J.TAG;const t=document.body;if(!t)return s.e("document.body不存在",J.TAG),!1;const e=performance.now();let n=J.checkMeaningfulNodeRecursive(t);(performance.now()-e).toFixed(2);const o=n>J.MIN_NODE_THRESHOLD;return J.MIN_NODE_THRESHOLD,J.TAG,o}static checkMeaningfulNodeRecursive(t,e=0){let n=0;if(t instanceof HTMLElement){const o=getComputedStyle(t);if("none"===o.display||"hidden"===o.visibility||"0"===o.opacity)return 0===e&&(t.tagName,t.className,J.TAG),n}if(["DIV","P","SPAN","A","IMG","BUTTON","INPUT","TEXTAREA","UL","LI","H1","H2","H3","H4","H5","H6","SECTION","ARTICLE","NAV","HEADER","FOOTER","MAIN"].includes(t.tagName)&&(n++,n>J.MIN_NODE_THRESHOLD))return J.TAG,n;if(t.children.length>0&&n<=J.MIN_NODE_THRESHOLD){const o=Math.min(t.children.length,J.MAX_CHECK_CHILDREN);t.children.length>o&&(t.tagName,t.children.length,J.TAG);for(let i=0;i<o&&(n+=J.checkMeaningfulNodeRecursive(t.children[i],e+1),!(n>J.MIN_NODE_THRESHOLD));i++);}return n}static reset(){J.TAG,J.contentReady=!1,J.disconnect()}}J.TAG="PageContentObserver",J.contentReady=!1,J.observer=null,J.MIN_NODE_THRESHOLD=9,J.MAX_CHECK_CHILDREN=50;class K{static bodyReady(t){i.framework,function e(){if(!document.body||innerWidth<=100){document.body&&innerWidth;return K.tryTimes,i.framework,K.tryTimes>=0?setTimeout(e,50):s.e("❌ Body就绪检测超时，已达最大尝试次数",i.framework),void K.tryTimes--}innerWidth,i.framework,K.hasBodyReady=!0,i.framework,t()}()}static viewportReady(t){let e;function n(){let n=document.querySelector('meta[name="viewport"]');if(!n)return i.framework,!1;n.getAttribute("content");return i.framework,e&&(i.framework,e.disconnect(),e=null),i.framework,t(),!0}i.framework,n()||(i.framework,e=new MutationObserver(()=>{i.framework,n()}),e.observe(document.head,{childList:!0}))}static checkDOMReady(t){if(!t)return i.framework,!1;t.children.length;return i.framework,!0}static waitForSystemReady(){i.framework,K.sysReady=K.checkDOMReady(document.body),!1===K.sysReady?(i.framework,setTimeout(K.waitForSystemReady,200)):(i.framework,nt.start_())}static headReady(t){if(i.framework,K.tryHead--,K.tryHead<0)return void s.e("❌ Head就绪检测超时，已达最大尝试次数",i.framework);if(!document.head)return K.tryHead,i.framework,void setTimeout(()=>{this.headReady(t)},10);document.head.querySelectorAll("link").length,document.head.querySelectorAll("style").length;i.framework,i.framework,t()}static configReady(t){i.framework,i.framework,t()}}K.tryTimes=1e3,K.hasBodyReady=!1,K.tryHead=100,K.sysReady=!1,K.elementCount=0;class Q{static init_(){Q.TAG,Q.init||(Q.init=!0,window.innerWidth,window.innerHeight,Q.TAG,Q.TAG,window.addEventListener(u.resize,Q.resizeCallback)),Q.TAG}static resizeCallback(){if(Q.TAG,window.innerWidth,window.innerHeight,Q.TAG,window.innerWidth,window.innerHeight,screen.width,screen.height,Q.TAG,nt.initFlag)return Q.TAG,void Q.onResize();s.w("系统未初始化，触发重启",Q.TAG),nt.restart()}static onResize(){Q.TAG,K.hasBodyReady?(Q.TAG,Z.cancelAllAnimationTimeouts(),Q.TAG,X.resetAllPopWindows(),Q.TAG,et.headReadyTask(),Q.TAG,tt.updateObserver(),s.checkState("after updateObserver"),Q.TAG,b.updateState(),Q.TAG,tt.postTask(),Q.TAG):s.w("document.body未就绪，跳过resize处理",Q.TAG)}static removeListener(){Q.TAG,Q.init?(Q.TAG,Q.init=!1,removeEventListener(u.resize,Q.resizeCallback),Q.TAG):Q.TAG}}Q.TAG=i.resizeObserver,Q.init=!1;class tt{static postTask(){tt.relayoutHandler.postTask(),i.observerHandler}static reInit(){i.observerHandler,i.observerHandler,Z.reInit(),i.observerHandler,J.reInit(),i.observerHandler,Q.init_(),tt.relayoutHandler||(tt.TIMEOUT,i.observerHandler,tt.relayoutHandler=new v(tt.TIMEOUT,et.mainTask)),i.observerHandler,setTimeout(()=>{tt.postTask()},400),i.observerHandler}static updateObserver(){i.observerHandler,et.stopFlag&&(s.w("Framework已停止，移除尺寸监听器",i.observerHandler),Q.removeListener()),R.isWideScreen()?i.observerHandler:(s.w(`窄屏检测: ${screen.availWidth}×${screen.availHeight}，移除观察器`,i.observerHandler),tt.removeObserver())}static removeObserver(){i.observerHandler,i.observerHandler,Z.disconnect(),i.observerHandler,J.disconnect(),i.observerHandler}static nextRoundAndPost(t){t.tagName,t.className,i.observerHandler,tt.nextRound(t),tt.postTask()}static nextRound(t){t.tagName,t.className,i.observerHandler,w.setValue(t,p,d.NEXT_ROUND),w.nextRoundCache.push(t),w.nextRoundCache.length,i.observerHandler}}tt.TIMEOUT=200;class et{static isAvailable(){return!et.stopFlag||(et.TAG,!1)}static taskinit(){et.TAG,et.startTime||(et.startTime=(new Date).getTime(),et.startTime,et.TAG);const t=R.isWideScreen(),e=et.isAvailable();if(et.TAG,!t||!e)return et.TAG,!1;if(!et.needRunTask())return et.TAG,tt.postTask(),!1;if(et.TAG,E.clearStyleCache(),!J.isContentReady()){et.TAG,J.startObserving();const t={resultCode:-1,errorMsg:"页面内容未就绪，等待内容加载",duration:0,report:"启动内容观察器，响应式等待"};return window.layoutConstraintResult=t,!1}return et.TAG,!0}static mainTask(){et.TAG;const t=performance.now();if(!et.taskinit())return void et.TAG;if(r.getInstance().checkRule()===e.outOfWhiteList)return s.w("检查不通过:Appid:"+r.getInstance().getAppID()+", Page:"+r.getInstance().getPage(),et.TAG),void nt.stop();if(r.getInstance().checkRule()===e.initial)return void et.TAG;et.TAG,X.intelligentLayout(document.body),et.TAG,_.flushAllStyles(),E.clearStyleCache();(performance.now()-t).toFixed(2);et.TAG,et.TAG}static recoverStyle(){et.TAG,X.recoverPopwinStyle()}static reInit(){et.TAG,R.isWideScreen()?(et.TAG,l.init(),E.clearAllCache(),et.TAG,et.TAG,b.reInit(),et.TAG,X.reInit(),et.TAG,tt.reInit(),et.TAG,et.stopFlag=!1,et.startTime=0,et.TAG):et.TAG}static configReady(){et.TAG,K.headReady(et.headReadyTask)}static headReadyTask(){et.TAG,K.bodyReady(et.reInit)}static needRunTask(){return et.TAG,et.cssIsComplete()?(et.TAG,!0):(s.w("⚠️ CSS样式表尚未加载完成，暂不执行任务",et.TAG),!1)}static cssIsComplete(){var t;et.TAG;const e=document.head;let n=[];for(let i=0;i<e.children.length;i++){const o=e.children[i];if(o.localName===u.link){const e=o,i=e.getAttribute(u.rel),s=e.getAttribute(u.href);if(i!==u.stylesheet||""===s||!s)continue;(null===(t=e.href)||void 0===t?void 0:t.startsWith("http"))&&!e.sheet?(et.TAG,n.push(s)):0}}const o=0===n.length;return et.TAG,o||(n.join(", "),et.TAG),o}}et.TAG=i.framework,et.stopFlag=!1;class nt{static start(t){r.getInstance().fromJson(t)&&nt.start_()}static start_(){R.isWideScreen()&&(nt.initFlag||(K.configReady(et.configReady),nt.initFlag=!0))}static stop(){et.stopFlag=!0}static restart(){et.stopFlag=!1,nt.start_()}}return nt.initFlag=!1,o})());
//# sourceMappingURL=autolayout.min.js.map